(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{1181:function(e,t,n){(e.exports=n(68)(!1)).push([e.i,".content-loading {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex: 1;\n}\n.content-loading svg {\n  width: 100%;\n  height: 100%;\n}\n.empty-wrapper {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n}\n.empty-wrapper span {\n  display: flex;\n  justify-content: center;\n  margin-top: 20px;\n  font-size: 14px;\n  letter-spacing: 0;\n  color: #8f9aaa;\n}\n.empty-wrapper img {\n  pointer-events: none;\n}\n",""])},1183:function(e,t,n){e.exports=n.p+"static/resource/06c2854ea89d97bfdb4f3037ceda1f91.png"},1184:function(e,t,n){"use strict";var a=n(0),i=n.n(a),s=n(32),o=n(48),r=n(1183),l=n.n(r);n(1186);t.a=({loading:e,emptyImg:t,emptyText:n})=>e?i.a.createElement("div",{className:"content-loading"},i.a.createElement(s.a,{type:"loading",style:{width:40,height:40},spin:!0})):i.a.createElement("div",{className:"empty-wrapper"},i.a.createElement("img",{src:t||l.a}),i.a.createElement("span",null,n||Object(o.b)({id:"SPRITE.SEARCH.EMAMPLE.TEXT"})))},1186:function(e,t,n){var a=n(1181);"string"==typeof a&&(a=[[e.i,a,""]]);var i={transform:void 0},s=n(88)(a,i);a.locals&&(e.exports=a.locals),a.locals||e.hot.accept(1181,(function(){var t=n(1181);"string"==typeof t&&(t=[[e.i,t,""]]),s(t)})),e.hot.dispose((function(){s()}))},1188:function(e,t,n){e.exports=n.p+"static/resource/4fc89289d3bcaf8d0c987f28e28b8e87.png"},1189:function(e,t,n){(e.exports=n(68)(!1)).push([e.i,".extension-update-wrapper.lastest,\n.extension-update-wrapper.toupdate,\n.extension-update-wrapper.newext,\n.extension-update-wrapper.updated {\n  align-items: center;\n}\n.extension-update-wrapper .ext-operation {\n  position: absolute;\n  top: 10px;\n  right: 10px;\n  display: inline-flex;\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  box-shadow: 0 2px 4px 0 rgba(37, 95, 134, 0.5);\n  justify-content: center;\n  align-items: center;\n  z-index: 10;\n  color: #fff;\n  cursor: pointer;\n}\n.extension-update-wrapper .ext-operation.lastest {\n  display: none;\n}\n.extension-update-wrapper .ext-operation.toupdate {\n  background: #62d669;\n}\n.extension-update-wrapper .ext-operation.newext {\n  background: var(--BTN-HOVER-COLOR);\n}\n.extension-update-wrapper .ext-operation:hover,\n.extension-update-wrapper .ext-operation:focus {\n  opacity: 0.8;\n}\n.extension-update-wrapper .item-inner {\n  width: 100%;\n  border-radius: 8px;\n  position: absolute;\n  left: 0;\n  top: 0;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  z-index: 10;\n  font-size: 14px;\n  color: #ffffff;\n}\n.extension-update-wrapper .item-inner .ext-update {\n  margin: 20px 0 10px;\n}\n.extension-update-wrapper .item-inner .ext-update > .ant-progress-inner {\n  width: 8vw !important;\n  height: 8vw !important;\n  min-width: 70px;\n  min-height: 70px;\n  max-width: 90px;\n  max-height: 90px;\n}\n.extension-update-wrapper .item-inner .ext-update .progress-content {\n  display: inline-block;\n  width: 24px;\n  height: 24px;\n  background: #fff;\n  line-height: 24px;\n  border-radius: 5px;\n}\n.extension-update-wrapper .item-inner .update-tip {\n  white-space: initial;\n  height: auto;\n  min-height: 30px;\n  padding: 2px;\n  background: #fdc02f;\n  width: 100%;\n  display: inline-flex;\n  justify-content: center;\n  align-items: center;\n  border-radius: 8px 8px 0 0;\n  font-size: 12px;\n  color: #ffffff;\n  letter-spacing: 0;\n}\n.extension-update-wrapper .item-inner.shadow {\n  height: 100%;\n  background: rgba(0, 0, 0, 0.7);\n}\n",""])},1205:function(e,t,n){var a=n(1189);"string"==typeof a&&(a=[[e.i,a,""]]);var i={transform:void 0},s=n(88)(a,i);a.locals&&(e.exports=a.locals),a.locals||e.hot.accept(1189,(function(){var t=n(1189);"string"==typeof t&&(t=[[e.i,t,""]]),s(t)})),e.hot.dispose((function(){s()}))},1206:function(e,t,n){"use strict";var a=n(2),i=n.n(a),s=n(6),o=n.n(s),r=n(11),l=n.n(r),c=n(8),d=n.n(c),p=n(9),m=n.n(p),h=n(0),u=n(331),E=n(60),v=function(e){function t(){o()(this,t);var e=d()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.saveTooltip=function(t){e.tooltip=t},e}return m()(t,e),l()(t,[{key:"getPopupDomNode",value:function(){return this.tooltip.getPopupDomNode()}},{key:"getOverlay",value:function(){var e=this.props,t=e.title,n=e.prefixCls,a=e.content;return Object(E.a)(!("overlay"in this.props),"Popover[overlay] is removed, please use Popover[content] instead, see: https://u.ant.design/popover-content"),h.createElement("div",null,t&&h.createElement("div",{className:n+"-title"},t),h.createElement("div",{className:n+"-inner-content"},a))}},{key:"render",value:function(){var e=i()({},this.props);return delete e.title,h.createElement(u.a,i()({},e,{ref:this.saveTooltip,overlay:this.getOverlay()}))}}]),t}(h.Component);t.a=v,v.defaultProps={prefixCls:"ant-popover",placement:"top",transitionName:"zoom-big",trigger:"hover",mouseEnterDelay:.1,mouseLeaveDelay:.1,overlayStyle:{}}},1210:function(e,t,n){"use strict";var a=n(0),i=n.n(a),s=n(1163),o=n(67),r=n(26);class l extends a.PureComponent{render(){const{children:e,footerChildren:t,onCancel:n,onOk:a,loading:r,disableOk:l,closable:c=!1,intlr:d,title:p,width:m,className:h}=this.props;return e?i.a.createElement(s.a,{width:m||960,wrapClassName:"vertical-center-modal",className:`modal-tabs sprites-modal ${h||""} ${d.rtl?"rtl":""}`,visible:!0,keyboard:!0,title:p,closable:c,onCancel:n,footer:i.a.createElement("div",{className:"flex-jcsb"},i.a.createElement("div",null,t||null),i.a.createElement("span",null,n&&i.a.createElement(o.a,{type:"primary",ghost:!0,onClick:n},d.messages["BUTTON.CANCEL.TEXT"]),a&&i.a.createElement(o.a,{type:"primary",loading:r,disabled:l,onClick:a},d.messages["BUTTON.OK.TEXT"])))},e):null}}t.a=Object(r.connect)(e=>({intlr:e.intlr}))(l)},1222:function(e,t,n){(e.exports=n(68)(!1)).push([e.i,".device-modal-container {\n  display: flex;\n  flex-direction: column;\n}\n.device-modal {\n  height: 680px !important;\n}\n.device-modal .list > .item {\n  width: 20% !important;\n}\n.device-modal .ant-modal-header {\n  padding-bottom: 0 !important;\n}\n.device-list {\n  flex: 1;\n  list-style: none;\n  display: flex;\n  margin: 0;\n  padding: 0;\n  flex-wrap: wrap;\n  align-content: flex-start;\n  padding: 8px;\n  overflow: auto;\n}\n.device-list .item {\n  width: 20%;\n  padding: 10px;\n}\n.device-marker {\n  color: var(--PRIMARY-COLOR);\n}\n.device-marker-o {\n  color: var(--BTN-HOVER-COLOR);\n}\n.device-marker-o:hover {\n  color: var(--PRIMARY-COLOR);\n}\n",""])},1233:function(e,t,n){"use strict";var a=n(0),i=n.n(a),s=n(26),o=n(56),r=n(548),l=n(48),c=n(76),d=n(63);const p=e=>({type:"UPDATE_DOWNLOADING_EXTENSION_LIST",value:e}),m=(e,t,n,a,i)=>(s,r)=>{const{downloadingExtMap:l}=r().extensions;o.c.downloadExt(e,t,(e,r)=>{e?("abort"!==e&&d.a.error(i),l[t]=void 0):r&&r.downloadStatus===o.a.None&&r.updateStatus!==o.d.ToUpdate?(d.a.success(`${n} ${a}`),l[t]="done"):l[t]=(({downloadStatus:e=!1,progress:t,percent:n})=>{if(e===o.a.Downloading)return n||t||0})(r),s(p(l))})};var h=n(52);n(1205);function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class E extends i.a.Component{constructor(e){super(e),u(this,"handleStartDownload",e=>{e.preventDefault(),e.stopPropagation();const{id:t,type:n,originVersion:a,name:i,langKey:s}=this.props,o=Object(c.b)(i,s),r=a?"UPDATE":"INSTALL",d=Object(l.b)({id:`EXTENSION.${r}.SUCCESS`}),p=Object(l.b)({id:`DEVICE.${r}.STATUS.FAIL`,values:[o]});this.props.downloadExt(n,t,o,d,p)}),u(this,"handleCancelDownload",async()=>{const e=this.props.id;await o.c.abortDownloadExt(e)&&this.props.cancelDownload(e)})}render(){const{type:e,...t}=this.props,n=this.props.percent,a=void 0!==n&&"done"!==n;let s="",c="",d="";return t.updateStatus===o.d.Lastest?s="lastest":t.updateStatus===o.d.Updated?s="updated":t.originVersion?(s="toupdate",c="icon-gengxin",d="device"===e?"DEVICE.UPDATE.TEXT":"EXTENSION.UPDATE.TEXT"):(s="newext",c="icon-xinjianxiangmu",d="device"===e?"DEVICE.NEW.TEXT":"EXTENSION.NEW.TEXT"),i.a.createElement("div",{className:"extension-update-wrapper"},t.updateStatus===o.d.ToUpdate&&!a&&i.a.createElement("span",{className:`ext-operation ${s}`,title:Object(l.b)({id:d}),onClick:this.handleStartDownload},i.a.createElement(h.a,{type:c,width:"100%",height:"100%"})),a&&i.a.createElement("span",{className:"item-inner shadow",onClick:this.handleCancelDownload},i.a.createElement(r.a,{className:"ext-update",strokeWidth:12,type:"circle",strokeColor:"var(--BTN-HOVER-COLOR)",format:()=>i.a.createElement("div",{className:"progress-content"}),percent:n}),i.a.createElement("p",null,i.a.createElement(l.a,{id:"DEVICE.STATUS.DOWNLOADING"}))),t.updateStatus===o.d.Updated&&i.a.createElement("span",{className:"item-inner"},i.a.createElement("span",{className:"update-tip"},i.a.createElement(l.a,{id:"DEVICE.STATUS.REOPEN"}))))}}t.a=Object(s.connect)((e,t)=>({percent:e.extensions.downloadingExtMap[t.id]}),e=>({downloadExt:(t,n,a,i,s)=>e(m(t,n,a,i,s)),cancelDownload:t=>e((e=>(t,n)=>{const{downloadingExtMap:a}=n().extensions;a[e]=void 0,t(p(a))})(t))}))(E)},1257:function(e,t,n){var a=n(1222);"string"==typeof a&&(a=[[e.i,a,""]]);var i={transform:void 0},s=n(88)(a,i);a.locals&&(e.exports=a.locals),a.locals||e.hot.accept(1222,(function(){var t=n(1222);"string"==typeof t&&(t=[[e.i,t,""]]),s(t)})),e.hot.dispose((function(){s()}))},1294:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),s=n(4),o=n.n(s),r=n(26),l=n(63),c=n(7),d=n(22),p=n(78),m=n(13),h=n(1210),u=n(14),E=n(1188),v=n.n(E),f=n(1206),g=n(52),x=n(1233),b=n(56),w=n(76),O=n(332),y=n(15),N=n(48);function C(){return(C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const k=y.a.enablePreview;class D extends i.a.Component{constructor(...e){super(...e),T(this,"handleClick",()=>{const{id:e,onClick:t}=this.props;this.disableAdd(this.props)||t(e)}),T(this,"handleDoubleClick",()=>{const{id:e,onDoubleClick:t}=this.props;this.disableAdd(this.props)||t(e)}),T(this,"handleMarkerClick",e=>{const{id:t,onMarkClick:n}=this.props;e.stopPropagation(),e.preventDefault(),n(t),l.a.success(Object(N.b)({id:"DEVICE.DEFAULT.SET.SUCCESS"}))}),T(this,"goDeviceHomepage",e=>{e.stopPropagation();const{homepage:t}=this.props;t&&u.c.openLink(e,t)}),T(this,"getAuthor",(e,t)=>{const{userInfo:n}=this.props;if(n){const{userName:e}=n;if(k&&!t)return e||"mBlock"}return e||"mBlock"})}disableAdd(e){return e.updateStatus===b.d.ToUpdate&&!e.originVersion}render(){const{marked:e,langKey:t,selected:n,homepage:a,userCustom:s,originVersion:o,iconURL:r,coverURL:l,id:c,cover:d,...p}=this.props,m=Object(w.b)(p.name,t);let h;h=o||p.isDev?Object(w.a)(r,c):l,h=Object(O.a)(h);const u=!0===s;return i.a.createElement("li",{className:"item"},i.a.createElement("div",{className:`item-content-container device-container ${n?"selected":""}`,onClick:this.handleClick,onDoubleClick:this.handleDoubleClick},i.a.createElement("div",{className:"sprite-content"},i.a.createElement("span",{className:"device-img"},i.a.createElement("span",{className:"img-placeholder"},i.a.createElement("img",{src:h})),e&&i.a.createElement(f.a,{content:i.a.createElement(N.a,{id:"DEVICE.DEFAULT"}),placement:"bottomLeft",overlayClassName:"mblock-popover-no-arrow"},i.a.createElement(g.a,{type:"icon-star",className:"device-marker show"})),!e&&n&&i.a.createElement(f.a,{content:i.a.createElement(N.a,{id:"DEVICE.DEFAULT.SET"}),placement:"bottomLeft",overlayClassName:"mblock-popover-no-arrow"},i.a.createElement(g.a,{type:"icon-star-o",className:"device-marker device-marker-o",onClick:this.handleMarkerClick}))),i.a.createElement("div",{className:"device-name-wrapper"},a?i.a.createElement(f.a,{content:i.a.createElement(N.a,{id:"DEVICE.MOREINFO"}),placement:"rightTop",overlayClassName:"mblock-popover-no-arrow"},i.a.createElement("div",{className:"device-name-inner text-overflow"},i.a.createElement("a",{className:"device-name",onClick:this.goDeviceHomepage},m,u?i.a.createElement("small",null," (",p.version,")"):null))):i.a.createElement("div",{className:"device-name-inner text-overflow"},i.a.createElement("span",null,m,u?i.a.createElement("small",null," (",p.version,")"):null)),i.a.createElement(f.a,{content:i.a.createElement(N.a,{id:1===p.isOfficialDev||void 0===p.isOfficialDev?"EXTENSION.DEVELOPER.TIP.OFFICIAL":"EXTENSION.DEVELOPER.TIP.UNOFFICIAL"}),placement:"bottom",overlayClassName:"mblock-popover-no-arrow"},p.isDev&&!p.createdByName?null:i.a.createElement("div",{className:"text-overflow"},i.a.createElement("span",{className:"author"},i.a.createElement(N.a,{id:"EXTENSION.DEVELOPER"}),`: ${this.getAuthor(p.createdByName,p.isOfficialDev)}`)))),i.a.createElement(x.a,C({},this.props,{type:"device"})))))}}var S=Object(r.connect)(e=>({langKey:e.intlr.langKey,userInfo:e.passport.userInfo}))(D),I=n(1184),L=n(334),P=n(3),U=n(144);n(1257);function j(){return(j=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const A=y.a.enablePreview,V=["tello","raspberrypi_camera"];class M extends a.PureComponent{constructor(e){super(e),R(this,"fetchUserExts",async()=>{this.setState({previewListFetching:!0});const{userDevices:e}=await p.a.fetchUserExts();this.setState({previewList:e,previewListFetching:!1})}),R(this,"requestUpdateList",()=>{this.state.fetching||(this.setState({fetching:!0}),p.a.fetchDevices(e=>{if(!this.mounted)return;let t=e.list;(U.a.isChromeOS||U.a.isLinuxOS)&&(t=t.filter(e=>-1===o.a.indexOf(V,e.id))),this.setState({list:t,fetching:!1})}))}),R(this,"handleOk",()=>{const{selected:e,tabIndex:t}=this.state;A&&0===t?this.handlePreviewAdd(e):this.handleAdd(e)}),R(this,"handleCancel",()=>{m.a.replace("/")}),R(this,"goExtBuildHomePage",e=>{const t=y.a.isInternational?"en":"zh",n=c.b.link.extBuild_homePage[t];return u.c.openLink(e,n)}),R(this,"handleSelected",e=>{this.state.selected!==e&&this.setState({selected:e,disableOk:!1})}),R(this,"handleAdd",async e=>{const{startUpload:t,endUpload:n}=this.props,a=this.state.list.find(t=>t.id===e);this.setState({loading:!0}),t(),!await Object(d.h)(a)&&l.a.warn(Object(N.b)({id:"NETWORK.ERR.MSG"})),n(),this.setState({loading:!1}),this.handleCancel(),P.default.emit("LogDeviceExtension",e,!0),P.default.emit("LoadExtension",1===a.isOfficialDev,e)}),R(this,"handlePreviewAdd",async e=>{const{startUpload:t,endUpload:n}=this.props,a=this.state.previewList.find(t=>t.id===e);if(!a.main)return l.a.warn(Object(N.b)({id:"EXTENSION.INSTALL.FAIL"}));this.setState({loading:!0}),t(),!await Object(d.h)(a)&&l.a.warn(Object(N.b)({id:"NETWORK.ERR.MSG"})),n(),this.setState({loading:!1}),this.handleCancel(),P.default.emit("LogPreviewDeviceExtension",e,!0)}),R(this,"handleUpdateDefaultDevice",e=>{const{defaultDevice:t}=this.props;e!==t&&(c.a.updateDefaultExt(e),this.setState({defaultDevice:e}))}),R(this,"handleItemUpdated",()=>{this.requestUpdateList()}),R(this,"title",()=>{const{tabIndex:e}=this.state;return A?i.a.createElement("div",{className:"sprite-tabs extension-tabs"},["SPRITE.DEVICES.USER.TITLE","SPRITE.DEVICES.TITLE"].map((t,n)=>i.a.createElement("div",{key:n,className:`sprite-tab-name ${e===n?"actived":""}`,onClick:()=>this.handleTabChange(n)},i.a.createElement(N.a,{id:t})))):i.a.createElement(N.a,{id:"SPRITE.DEVICES.TITLE"})}),R(this,"previewListRender",()=>{const{previewList:e,selected:t,previewListFetching:n}=this.state;return i.a.createElement("section",{className:"modal-body-container device-modal-container"},e&&e.length?i.a.createElement("ul",{className:"device-list"},e.map(e=>i.a.createElement(S,j({},e,{key:e.id+e.originId,selected:t===e.id,onClick:this.handleSelected,onDoubleClick:this.handlePreviewAdd})))):i.a.createElement(I.a,{loading:n,emptyText:i.a.createElement(N.a,{id:"EXTENSION.EMPTY"}),emptyImg:v.a}))}),R(this,"extListRender",()=>{const{selected:e,fetching:t,list:n,defaultDevice:a}=this.state;return i.a.createElement("section",{className:"modal-body-container device-modal-container"},n.length?i.a.createElement("ul",{className:"device-list"},n.map(t=>i.a.createElement(S,j({},t,{key:t.id,marked:a===t.id,selected:e===t.id,onClick:this.handleSelected,onDoubleClick:this.handleAdd,onMarkClick:this.handleUpdateDefaultDevice})))):i.a.createElement(I.a,{loading:t,emptyText:i.a.createElement(N.a,{id:"EXTENSION.EMPTY"}),emptyImg:v.a}))}),R(this,"handleTabChange",e=>{this.setState({tabIndex:e,selected:null,disableOk:!0})}),this.state={selected:null,defaultDevice:c.b.defaultExts[0],fetching:!1,loading:!1,list:[],previewListFetching:!1,previewList:null,tabIndex:0,disableOk:!0}}componentDidMount(){A&&this.fetchUserExts(),this.mounted=!0,this.requestUpdateList(),this.unlistenListUpdate=p.a.onListUpdate(this.requestUpdateList)}componentWillUnmount(){delete this.mounted,this.unlistenListUpdate&&this.unlistenListUpdate()}render(){const{loading:e,tabIndex:t,disableOk:n}=this.state;return i.a.createElement(h.a,{onOk:this.handleOk,onCancel:this.handleCancel,disabled:!1,loading:e,disableOk:n,title:this.title(),className:"device-modal",footerChildren:i.a.createElement("a",{className:"to-develop",onClick:this.goExtBuildHomePage},i.a.createElement(N.a,{id:"EXTENSION.BECOME.DEVELOPER"}))},A&&0===t?this.previewListRender():this.extListRender())}}t.default=Object(r.connect)(null,e=>({startUpload:()=>e(Object(L.c)()),endUpload:()=>e(Object(L.b)())}))(M)}}]);