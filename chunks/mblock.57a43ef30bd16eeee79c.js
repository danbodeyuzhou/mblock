(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1020:function(t){t.exports=JSON.parse('{"name":"mscratch-vm","version":"0.7.0-202006091540","description":"Virtual Machine for Scratch 3.0","author":"Massachusetts Institute of Technology","license":"BSD-3-Clause","homepage":"https://github.com/LLK/scratch-vm#readme","repository":{"type":"git","url":"git+ssh://git@github.com/LLK/scratch-vm.git","sha":"bdf928402deffd94191ebb37e7dc73df5420c213"},"main":"./dist/node/scratch-vm.js","browser":"./src/index.js","scripts":{"build":"npm run docs && webpack --progress --colors --bail","coverage":"tap ./test/{unit,integration}/*.js --coverage --coverage-report=lcov","deploy":"touch playground/.nojekyll && gh-pages -t -d playground -m \\"Build for $(git log --pretty=format:%H -n1)\\"","docs":"jsdoc -c .jsdoc.json","i18n:src":"mkdirp translations/core && format-message extract --out-file translations/core/en.json src/extensions/**/index.js","i18n:push":"tx-push-src scratch-editor extensions translations/core/en.json","lint":"eslint . && format-message lint src/**/*.js","start":"webpack-dev-server","tap":"tap ./test/{unit,integration}/*.js","tap:unit":"tap ./test/unit/*.js","tap:integration":"tap ./test/integration/*.js","test":"npm run lint && npm run docs && npm run tap","watch":"webpack --progress --colors --watch","version":"json -f package.json -I -e \\"this.repository.sha = \'$(git log -n1 --pretty=format:%H)\'\\"","ext":"webpack --config webpack.extension.js","cp":"cp -rf ./src/ ../mscratch/node_modules/mscratch-vm/src/","cp2web":"cp -rf ./src/ ../mblock-web/node_modules/mscratch-vm/src/"},"dependencies":{"@vernier/godirect":"1.5.0","arraybuffer-loader":"^1.0.6","atob":"2.1.2","btoa":"1.2.1","canvas-toBlob":"1.0.0","decode-html":"2.0.0","diff-match-patch":"1.0.4","format-message":"6.2.1","htmlparser2":"3.10.0","immutable":"3.8.1","jszip":"^3.1.5","minilog":"3.1.0","nets":"3.2.0","scratch-parser":"5.0.0","scratch-sb1-converter":"0.2.7","scratch-translate-extension-languages":"0.0.20191118205314","socket.io-client":"2.0.4","text-encoding":"0.7.0","worker-loader":"^1.1.1"},"devDependencies":{"@babel/core":"^7.1.2","@babel/preset-env":"^7.1.0","adm-zip":"0.4.11","babel-eslint":"^10.0.1","babel-loader":"^8.0.4","copy-webpack-plugin":"^4.5.4","docdash":"^1.0.0","eslint":"^5.3.0","eslint-config-scratch":"^5.0.0","expose-loader":"0.7.5","file-loader":"^2.0.0","format-message-cli":"6.2.0","gh-pages":"^1.2.0","jsdoc":"^3.5.5","json":"^9.0.4","lodash.defaultsdeep":"4.6.1","pngjs":"^3.3.2","scratch-audio":"latest","scratch-blocks":"latest","scratch-l10n":"^3.1.20181129221712","scratch-render":"latest","scratch-storage":"^1.1.0","scratch-svg-renderer":"latest","script-loader":"0.7.2","stats.js":"^0.17.0","tap":"^12.0.1","tiny-worker":"^2.1.1","uglifyjs-webpack-plugin":"1.2.7","webpack":"^4.16.5","webpack-cli":"^3.1.0","webpack-dev-server":"^3.1.5"}}')},1021:function(t,e,r){const i=r(123),n={"forward:":{opcode:"motion_movesteps",argMap:[{type:"input",inputOp:"math_number",inputName:"STEPS"}]},"turnRight:":{opcode:"motion_turnright",argMap:[{type:"input",inputOp:"math_number",inputName:"DEGREES"}]},"turnLeft:":{opcode:"motion_turnleft",argMap:[{type:"input",inputOp:"math_number",inputName:"DEGREES"}]},"heading:":{opcode:"motion_pointindirection",argMap:[{type:"input",inputOp:"math_angle",inputName:"DIRECTION"}]},"pointTowards:":{opcode:"motion_pointtowards",argMap:[{type:"input",inputOp:"motion_pointtowards_menu",inputName:"TOWARDS"}]},"gotoX:y:":{opcode:"motion_gotoxy",argMap:[{type:"input",inputOp:"math_number",inputName:"X"},{type:"input",inputOp:"math_number",inputName:"Y"}]},"gotoSpriteOrMouse:":{opcode:"motion_goto",argMap:[{type:"input",inputOp:"motion_goto_menu",inputName:"TO"}]},"glideSecs:toX:y:elapsed:from:":{opcode:"motion_glidesecstoxy",argMap:[{type:"input",inputOp:"math_number",inputName:"SECS"},{type:"input",inputOp:"math_number",inputName:"X"},{type:"input",inputOp:"math_number",inputName:"Y"}]},"changeXposBy:":{opcode:"motion_changexby",argMap:[{type:"input",inputOp:"math_number",inputName:"DX"}]},"xpos:":{opcode:"motion_setx",argMap:[{type:"input",inputOp:"math_number",inputName:"X"}]},"changeYposBy:":{opcode:"motion_changeyby",argMap:[{type:"input",inputOp:"math_number",inputName:"DY"}]},"ypos:":{opcode:"motion_sety",argMap:[{type:"input",inputOp:"math_number",inputName:"Y"}]},bounceOffEdge:{opcode:"motion_ifonedgebounce",argMap:[]},setRotationStyle:{opcode:"motion_setrotationstyle",argMap:[{type:"field",fieldName:"STYLE"}]},xpos:{opcode:"motion_xposition",argMap:[]},ypos:{opcode:"motion_yposition",argMap:[]},heading:{opcode:"motion_direction",argMap:[]},scrollRight:{opcode:"motion_scroll_right",argMap:[{type:"input",inputOp:"math_number",inputName:"DISTANCE"}]},scrollUp:{opcode:"motion_scroll_up",argMap:[{type:"input",inputOp:"math_number",inputName:"DISTANCE"}]},scrollAlign:{opcode:"motion_align_scene",argMap:[{type:"field",fieldName:"ALIGNMENT"}]},xScroll:{opcode:"motion_xscroll",argMap:[]},yScroll:{opcode:"motion_yscroll",argMap:[]},"say:duration:elapsed:from:":{opcode:"looks_sayforsecs",argMap:[{type:"input",inputOp:"text",inputName:"MESSAGE"},{type:"input",inputOp:"math_number",inputName:"SECS"}]},"say:":{opcode:"looks_say",argMap:[{type:"input",inputOp:"text",inputName:"MESSAGE"}]},"think:duration:elapsed:from:":{opcode:"looks_thinkforsecs",argMap:[{type:"input",inputOp:"text",inputName:"MESSAGE"},{type:"input",inputOp:"math_number",inputName:"SECS"}]},"think:":{opcode:"looks_think",argMap:[{type:"input",inputOp:"text",inputName:"MESSAGE"}]},show:{opcode:"looks_show",argMap:[]},hide:{opcode:"looks_hide",argMap:[]},hideAll:{opcode:"looks_hideallsprites",argMap:[]},"lookLike:":{opcode:"looks_switchcostumeto",argMap:[{type:"input",inputOp:"looks_costume",inputName:"COSTUME"}]},nextCostume:{opcode:"looks_nextcostume",argMap:[]},startScene:{opcode:"looks_switchbackdropto",argMap:[{type:"input",inputOp:"looks_backdrops",inputName:"BACKDROP"}]},"changeGraphicEffect:by:":{opcode:"looks_changeeffectby",argMap:[{type:"field",fieldName:"EFFECT"},{type:"input",inputOp:"math_number",inputName:"CHANGE"}]},"setGraphicEffect:to:":{opcode:"looks_seteffectto",argMap:[{type:"field",fieldName:"EFFECT"},{type:"input",inputOp:"math_number",inputName:"VALUE"}]},filterReset:{opcode:"looks_cleargraphiceffects",argMap:[]},"changeSizeBy:":{opcode:"looks_changesizeby",argMap:[{type:"input",inputOp:"math_number",inputName:"CHANGE"}]},"setSizeTo:":{opcode:"looks_setsizeto",argMap:[{type:"input",inputOp:"math_number",inputName:"SIZE"}]},"changeStretchBy:":{opcode:"looks_changestretchby",argMap:[{type:"input",inputOp:"math_number",inputName:"CHANGE"}]},"setStretchTo:":{opcode:"looks_setstretchto",argMap:[{type:"input",inputOp:"math_number",inputName:"STRETCH"}]},comeToFront:{opcode:"looks_gotofrontback",argMap:[]},"goBackByLayers:":{opcode:"looks_goforwardbackwardlayers",argMap:[{type:"input",inputOp:"math_integer",inputName:"NUM"}]},costumeIndex:{opcode:"looks_costumenumbername",argMap:[]},costumeName:{opcode:"looks_costumenumbername",argMap:[]},sceneName:{opcode:"looks_backdropnumbername",argMap:[]},scale:{opcode:"looks_size",argMap:[]},startSceneAndWait:{opcode:"looks_switchbackdroptoandwait",argMap:[{type:"input",inputOp:"looks_backdrops",inputName:"BACKDROP"}]},nextScene:{opcode:"looks_nextbackdrop",argMap:[]},backgroundIndex:{opcode:"looks_backdropnumbername",argMap:[]},"playSound:":{opcode:"sound_play",argMap:[{type:"input",inputOp:"sound_sounds_menu",inputName:"SOUND_MENU"}]},doPlaySoundAndWait:{opcode:"sound_playuntildone",argMap:[{type:"input",inputOp:"sound_sounds_menu",inputName:"SOUND_MENU"}]},stopAllSounds:{opcode:"sound_stopallsounds",argMap:[]},playDrum:{opcode:"music_playDrumForBeats",argMap:[{type:"input",inputOp:"music_menu_DRUM",inputName:"DRUM"},{type:"input",inputOp:"math_number",inputName:"BEATS"}]},"drum:duration:elapsed:from:":{opcode:"music_midiPlayDrumForBeats",argMap:[{type:"input",inputOp:"math_number",inputName:"DRUM"},{type:"input",inputOp:"math_number",inputName:"BEATS"}]},"rest:elapsed:from:":{opcode:"music_restForBeats",argMap:[{type:"input",inputOp:"math_number",inputName:"BEATS"}]},"noteOn:duration:elapsed:from:":{opcode:"music_playNoteForBeats",argMap:[{type:"input",inputOp:"note",inputName:"NOTE"},{type:"input",inputOp:"math_number",inputName:"BEATS"}]},"instrument:":{opcode:"music_setInstrument",argMap:[{type:"input",inputOp:"music_menu_INSTRUMENT",inputName:"INSTRUMENT"}]},"midiInstrument:":{opcode:"music_midiSetInstrument",argMap:[{type:"input",inputOp:"math_number",inputName:"INSTRUMENT"}]},"changeVolumeBy:":{opcode:"sound_changevolumeby",argMap:[{type:"input",inputOp:"math_number",inputName:"VOLUME"}]},"setVolumeTo:":{opcode:"sound_setvolumeto",argMap:[{type:"input",inputOp:"math_number",inputName:"VOLUME"}]},volume:{opcode:"sound_volume",argMap:[]},"changeTempoBy:":{opcode:"music_changeTempo",argMap:[{type:"input",inputOp:"math_number",inputName:"TEMPO"}]},"setTempoTo:":{opcode:"music_setTempo",argMap:[{type:"input",inputOp:"math_number",inputName:"TEMPO"}]},tempo:{opcode:"music_getTempo",argMap:[]},clearPenTrails:{opcode:"pen_clear",argMap:[]},stampCostume:{opcode:"pen_stamp",argMap:[]},putPenDown:{opcode:"pen_penDown",argMap:[]},putPenUp:{opcode:"pen_penUp",argMap:[]},"penColor:":{opcode:"pen_setPenColorToColor",argMap:[{type:"input",inputOp:"colour_picker",inputName:"COLOR"}]},"changePenHueBy:":{opcode:"pen_changePenHueBy",argMap:[{type:"input",inputOp:"math_number",inputName:"HUE"}]},"setPenHueTo:":{opcode:"pen_setPenHueToNumber",argMap:[{type:"input",inputOp:"math_number",inputName:"HUE"}]},"changePenShadeBy:":{opcode:"pen_changePenShadeBy",argMap:[{type:"input",inputOp:"math_number",inputName:"SHADE"}]},"setPenShadeTo:":{opcode:"pen_setPenShadeToNumber",argMap:[{type:"input",inputOp:"math_number",inputName:"SHADE"}]},"changePenSizeBy:":{opcode:"pen_changePenSizeBy",argMap:[{type:"input",inputOp:"math_number",inputName:"SIZE"}]},"penSize:":{opcode:"pen_setPenSizeTo",argMap:[{type:"input",inputOp:"math_number",inputName:"SIZE"}]},senseVideoMotion:{opcode:"videoSensing_videoOn",argMap:[{type:"input",inputOp:"videoSensing_menu_ATTRIBUTE",inputName:"ATTRIBUTE"},{type:"input",inputOp:"videoSensing_menu_SUBJECT",inputName:"SUBJECT"}]},whenGreenFlag:{opcode:"event_whenflagclicked",argMap:[]},whenKeyPressed:{opcode:"event_whenkeypressed",argMap:[{type:"field",fieldName:"KEY_OPTION"}]},whenClicked:{opcode:"event_whenthisspriteclicked",argMap:[]},whenSceneStarts:{opcode:"event_whenbackdropswitchesto",argMap:[{type:"field",fieldName:"BACKDROP"}]},whenSensorGreaterThan:([,t])=>"video motion"===t?{opcode:"videoSensing_whenMotionGreaterThan",argMap:[{},{type:"input",inputOp:"math_number",inputName:"REFERENCE"}]}:{opcode:"event_whengreaterthan",argMap:[{type:"field",fieldName:"WHENGREATERTHANMENU"},{type:"input",inputOp:"math_number",inputName:"VALUE"}]},whenIReceive:{opcode:"event_whenbroadcastreceived",argMap:[{type:"field",fieldName:"BROADCAST_OPTION",variableType:i.BROADCAST_MESSAGE_TYPE}]},"broadcast:":{opcode:"event_broadcast",argMap:[{type:"input",inputOp:"event_broadcast_menu",inputName:"BROADCAST_INPUT",variableType:i.BROADCAST_MESSAGE_TYPE}]},doBroadcastAndWait:{opcode:"event_broadcastandwait",argMap:[{type:"input",inputOp:"event_broadcast_menu",inputName:"BROADCAST_INPUT",variableType:i.BROADCAST_MESSAGE_TYPE}]},"wait:elapsed:from:":{opcode:"control_wait",argMap:[{type:"input",inputOp:"math_positive_number",inputName:"DURATION"}]},doRepeat:{opcode:"control_repeat",argMap:[{type:"input",inputOp:"math_whole_number",inputName:"TIMES"},{type:"input",inputOp:"substack",inputName:"SUBSTACK"}]},doForever:{opcode:"control_forever",argMap:[{type:"input",inputOp:"substack",inputName:"SUBSTACK"}]},doIf:{opcode:"control_if",argMap:[{type:"input",inputOp:"boolean",inputName:"CONDITION"},{type:"input",inputOp:"substack",inputName:"SUBSTACK"}]},doIfElse:{opcode:"control_if_else",argMap:[{type:"input",inputOp:"boolean",inputName:"CONDITION"},{type:"input",inputOp:"substack",inputName:"SUBSTACK"},{type:"input",inputOp:"substack",inputName:"SUBSTACK2"}]},doWaitUntil:{opcode:"control_wait_until",argMap:[{type:"input",inputOp:"boolean",inputName:"CONDITION"}]},doUntil:{opcode:"control_repeat_until",argMap:[{type:"input",inputOp:"boolean",inputName:"CONDITION"},{type:"input",inputOp:"substack",inputName:"SUBSTACK"}]},doWhile:{opcode:"control_while",argMap:[{type:"input",inputOp:"boolean",inputName:"CONDITION"},{type:"input",inputOp:"substack",inputName:"SUBSTACK"}]},doForLoop:{opcode:"control_for_each",argMap:[{type:"field",fieldName:"VARIABLE"},{type:"input",inputOp:"text",inputName:"VALUE"},{type:"input",inputOp:"substack",inputName:"SUBSTACK"}]},stopScripts:{opcode:"control_stop",argMap:[{type:"field",fieldName:"STOP_OPTION"}]},whenCloned:{opcode:"control_start_as_clone",argMap:[]},createCloneOf:{opcode:"control_create_clone_of",argMap:[{type:"input",inputOp:"control_create_clone_of_menu",inputName:"CLONE_OPTION"}]},deleteClone:{opcode:"control_delete_this_clone",argMap:[]},COUNT:{opcode:"control_get_counter",argMap:[]},INCR_COUNT:{opcode:"control_incr_counter",argMap:[]},CLR_COUNT:{opcode:"control_clear_counter",argMap:[]},warpSpeed:{opcode:"control_all_at_once",argMap:[{type:"input",inputOp:"substack",inputName:"SUBSTACK"}]},"touching:":{opcode:"sensing_touchingobject",argMap:[{type:"input",inputOp:"sensing_touchingobjectmenu",inputName:"TOUCHINGOBJECTMENU"}]},"touchingColor:":{opcode:"sensing_touchingcolor",argMap:[{type:"input",inputOp:"colour_picker",inputName:"COLOR"}]},"color:sees:":{opcode:"sensing_coloristouchingcolor",argMap:[{type:"input",inputOp:"colour_picker",inputName:"COLOR"},{type:"input",inputOp:"colour_picker",inputName:"COLOR2"}]},"distanceTo:":{opcode:"sensing_distanceto",argMap:[{type:"input",inputOp:"sensing_distancetomenu",inputName:"DISTANCETOMENU"}]},doAsk:{opcode:"sensing_askandwait",argMap:[{type:"input",inputOp:"text",inputName:"QUESTION"}]},answer:{opcode:"sensing_answer",argMap:[]},"keyPressed:":{opcode:"sensing_keypressed",argMap:[{type:"input",inputOp:"sensing_keyoptions",inputName:"KEY_OPTION"}]},mousePressed:{opcode:"sensing_mousedown",argMap:[]},mouseX:{opcode:"sensing_mousex",argMap:[]},mouseY:{opcode:"sensing_mousey",argMap:[]},soundLevel:{opcode:"sensing_loudness",argMap:[]},isLoud:{opcode:"sensing_loud",argMap:[]},setVideoState:{opcode:"videoSensing_videoToggle",argMap:[{type:"input",inputOp:"videoSensing_menu_VIDEO_STATE",inputName:"VIDEO_STATE"}]},setVideoTransparency:{opcode:"videoSensing_setVideoTransparency",argMap:[{type:"input",inputOp:"math_number",inputName:"TRANSPARENCY"}]},timer:{opcode:"sensing_timer",argMap:[]},timerReset:{opcode:"sensing_resettimer",argMap:[]},"getAttribute:of:":{opcode:"sensing_of",argMap:[{type:"field",fieldName:"PROPERTY"},{type:"input",inputOp:"sensing_of_object_menu",inputName:"OBJECT"}]},timeAndDate:{opcode:"sensing_current",argMap:[{type:"field",fieldName:"CURRENTMENU"}]},timestamp:{opcode:"sensing_dayssince2000",argMap:[]},getUserName:{opcode:"sensing_username",argMap:[]},getUserId:{opcode:"sensing_userid",argMap:[]},"+":{opcode:"operator_add",argMap:[{type:"input",inputOp:"math_number",inputName:"NUM1"},{type:"input",inputOp:"math_number",inputName:"NUM2"}]},"-":{opcode:"operator_subtract",argMap:[{type:"input",inputOp:"math_number",inputName:"NUM1"},{type:"input",inputOp:"math_number",inputName:"NUM2"}]},"*":{opcode:"operator_multiply",argMap:[{type:"input",inputOp:"math_number",inputName:"NUM1"},{type:"input",inputOp:"math_number",inputName:"NUM2"}]},"/":{opcode:"operator_divide",argMap:[{type:"input",inputOp:"math_number",inputName:"NUM1"},{type:"input",inputOp:"math_number",inputName:"NUM2"}]},"randomFrom:to:":{opcode:"operator_random",argMap:[{type:"input",inputOp:"math_number",inputName:"FROM"},{type:"input",inputOp:"math_number",inputName:"TO"}]},"<":{opcode:"operator_lt",argMap:[{type:"input",inputOp:"text",inputName:"OPERAND1"},{type:"input",inputOp:"text",inputName:"OPERAND2"}]},"=":{opcode:"operator_equals",argMap:[{type:"input",inputOp:"text",inputName:"OPERAND1"},{type:"input",inputOp:"text",inputName:"OPERAND2"}]},">":{opcode:"operator_gt",argMap:[{type:"input",inputOp:"text",inputName:"OPERAND1"},{type:"input",inputOp:"text",inputName:"OPERAND2"}]},"&":{opcode:"operator_and",argMap:[{type:"input",inputOp:"boolean",inputName:"OPERAND1"},{type:"input",inputOp:"boolean",inputName:"OPERAND2"}]},"|":{opcode:"operator_or",argMap:[{type:"input",inputOp:"boolean",inputName:"OPERAND1"},{type:"input",inputOp:"boolean",inputName:"OPERAND2"}]},not:{opcode:"operator_not",argMap:[{type:"input",inputOp:"boolean",inputName:"OPERAND"}]},"concatenate:with:":{opcode:"operator_join",argMap:[{type:"input",inputOp:"text",inputName:"STRING1"},{type:"input",inputOp:"text",inputName:"STRING2"}]},"letter:of:":{opcode:"operator_letter_of",argMap:[{type:"input",inputOp:"math_whole_number",inputName:"LETTER"},{type:"input",inputOp:"text",inputName:"STRING"}]},"stringLength:":{opcode:"operator_length",argMap:[{type:"input",inputOp:"text",inputName:"STRING"}]},"%":{opcode:"operator_mod",argMap:[{type:"input",inputOp:"math_number",inputName:"NUM1"},{type:"input",inputOp:"math_number",inputName:"NUM2"}]},rounded:{opcode:"operator_round",argMap:[{type:"input",inputOp:"math_number",inputName:"NUM"}]},"computeFunction:of:":{opcode:"operator_mathop",argMap:[{type:"field",fieldName:"OPERATOR"},{type:"input",inputOp:"math_number",inputName:"NUM"}]},readVariable:{opcode:"data_variable",argMap:[{type:"field",fieldName:"VARIABLE",variableType:i.SCALAR_TYPE}]},"getVar:":{opcode:"data_variable",argMap:[{type:"field",fieldName:"VARIABLE",variableType:i.SCALAR_TYPE}]},"setVar:to:":{opcode:"data_setvariableto",argMap:[{type:"field",fieldName:"VARIABLE",variableType:i.SCALAR_TYPE},{type:"input",inputOp:"text",inputName:"VALUE"}]},"changeVar:by:":{opcode:"data_changevariableby",argMap:[{type:"field",fieldName:"VARIABLE",variableType:i.SCALAR_TYPE},{type:"input",inputOp:"math_number",inputName:"VALUE"}]},"showVariable:":{opcode:"data_showvariable",argMap:[{type:"field",fieldName:"VARIABLE",variableType:i.SCALAR_TYPE}]},"hideVariable:":{opcode:"data_hidevariable",argMap:[{type:"field",fieldName:"VARIABLE",variableType:i.SCALAR_TYPE}]},"contentsOfList:":{opcode:"data_listcontents",argMap:[{type:"field",fieldName:"LIST",variableType:i.LIST_TYPE}]},"append:toList:":{opcode:"data_addtolist",argMap:[{type:"input",inputOp:"text",inputName:"ITEM"},{type:"field",fieldName:"LIST",variableType:i.LIST_TYPE}]},"deleteLine:ofList:":{opcode:"data_deleteoflist",argMap:[{type:"input",inputOp:"math_integer",inputName:"INDEX"},{type:"field",fieldName:"LIST",variableType:i.LIST_TYPE}]},"insert:at:ofList:":{opcode:"data_insertatlist",argMap:[{type:"input",inputOp:"text",inputName:"ITEM"},{type:"input",inputOp:"math_integer",inputName:"INDEX"},{type:"field",fieldName:"LIST",variableType:i.LIST_TYPE}]},"setLine:ofList:to:":{opcode:"data_replaceitemoflist",argMap:[{type:"input",inputOp:"math_integer",inputName:"INDEX"},{type:"field",fieldName:"LIST",variableType:i.LIST_TYPE},{type:"input",inputOp:"text",inputName:"ITEM"}]},"getLine:ofList:":{opcode:"data_itemoflist",argMap:[{type:"input",inputOp:"math_integer",inputName:"INDEX"},{type:"field",fieldName:"LIST",variableType:i.LIST_TYPE}]},"lineCountOfList:":{opcode:"data_lengthoflist",argMap:[{type:"field",fieldName:"LIST",variableType:i.LIST_TYPE}]},"list:contains:":{opcode:"data_listcontainsitem",argMap:[{type:"field",fieldName:"LIST",variableType:i.LIST_TYPE},{type:"input",inputOp:"text",inputName:"ITEM"}]},"showList:":{opcode:"data_showlist",argMap:[{type:"field",fieldName:"LIST",variableType:i.LIST_TYPE}]},"hideList:":{opcode:"data_hidelist",argMap:[{type:"field",fieldName:"LIST",variableType:i.LIST_TYPE}]},procDef:{opcode:"procedures_definition",argMap:[]},getParam:{opcode:"argument_reporter_string_number",argMap:[{type:"field",fieldName:"VALUE"}]},call:{opcode:"procedures_call",argMap:[]}},s=function(t,e,r){n[`${t}${e}`]=r,n[`${t}.${e}`]=r},o="LEGO WeDo 2.0";s(o,"motorOnFor",{opcode:"wedo2_motorOnFor",argMap:[{type:"input",inputOp:"wedo2_menu_MOTOR_ID",inputName:"MOTOR_ID"},{type:"input",inputOp:"math_number",inputName:"DURATION"}]}),s(o,"motorOn",{opcode:"wedo2_motorOn",argMap:[{type:"input",inputOp:"wedo2_menu_MOTOR_ID",inputName:"MOTOR_ID"}]}),s(o,"motorOff",{opcode:"wedo2_motorOff",argMap:[{type:"input",inputOp:"wedo2_menu_MOTOR_ID",inputName:"MOTOR_ID"}]}),s(o,"startMotorPower",{opcode:"wedo2_startMotorPower",argMap:[{type:"input",inputOp:"wedo2_menu_MOTOR_ID",inputName:"MOTOR_ID"},{type:"input",inputOp:"math_number",inputName:"POWER"}]}),s(o,"setMotorDirection",{opcode:"wedo2_setMotorDirection",argMap:[{type:"input",inputOp:"wedo2_menu_MOTOR_ID",inputName:"MOTOR_ID"},{type:"input",inputOp:"wedo2_menu_MOTOR_DIRECTION",inputName:"MOTOR_DIRECTION"}]}),s(o,"setLED",{opcode:"wedo2_setLightHue",argMap:[{type:"input",inputOp:"math_number",inputName:"HUE"}]}),s(o,"playNote",{opcode:"wedo2_playNoteFor",argMap:[{type:"input",inputOp:"math_number",inputName:"NOTE"},{type:"input",inputOp:"math_number",inputName:"DURATION"}]}),s(o,"whenDistance",{opcode:"wedo2_whenDistance",argMap:[{type:"input",inputOp:"wedo2_menu_OP",inputName:"OP"},{type:"input",inputOp:"math_number",inputName:"REFERENCE"}]}),s(o,"whenTilted",{opcode:"wedo2_whenTilted",argMap:[{type:"input",inputOp:"wedo2_menu_TILT_DIRECTION_ANY",inputName:"TILT_DIRECTION_ANY"}]}),s(o,"getDistance",{opcode:"wedo2_getDistance",argMap:[]}),s(o,"isTilted",{opcode:"wedo2_isTilted",argMap:[{type:"input",inputOp:"wedo2_menu_TILT_DIRECTION_ANY",inputName:"TILT_DIRECTION_ANY"}]}),s(o,"getTilt",{opcode:"wedo2_getTiltAngle",argMap:[{type:"input",inputOp:"wedo2_menu_TILT_DIRECTION",inputName:"TILT_DIRECTION"}]}),t.exports=n},123:function(t,e,r){const i=r(98),n=r(207);class s{constructor(t,e,r,n){switch(this.id=t||i(),this.name=e,this.type=r,this.isCloud=n,this.type){case s.SCALAR_TYPE:this.value=0;break;case s.LIST_TYPE:this.value=[];break;case s.BROADCAST_MESSAGE_TYPE:this.value=this.name;break;default:throw new Error(`Invalid variable type: ${this.type}`)}}toXML(t){return t=!0===t,`<variable type="${this.type}" id="${this.id}" islocal="${t}" iscloud="${this.isCloud}">${n(this.name)}</variable>`}static get SCALAR_TYPE(){return""}static get LIST_TYPE(){return"list"}static get BROADCAST_MESSAGE_TYPE(){return"broadcast_msg"}}t.exports=s},135:function(t,e,r){const i=r(887),n=r(446),s=r(207),o=r(291),a=r(208),{Map:u}=r(175),c=r(455),h=r(456),l=r(59),p=r(123),d=r(98),m=r(292);class _{constructor(t,e){this.runtime=t,this._blocks={},this._scripts=[],Object.defineProperty(this,"_cache",{writable:!0,enumerable:!1}),this._cache={inputs:{},procedureParamNames:{},procedureDefinitions:{},_executeCached:{},_monitored:null,scripts:{}},this.forceNoGlow=e||!1}static get BRANCH_INPUT_PREFIX(){return"SUBSTACK"}getBlock(t){return this._blocks[t]}getScripts(){return this._scripts}getNextBlock(t){const e=this._blocks[t];return void 0===e?null:e.next}getBranch(t,e){const r=this._blocks[t];if(void 0===r)return null;e||(e=1);let i=_.BRANCH_INPUT_PREFIX;e>1&&(i+=e);const n=r.inputs[i];return void 0===n?null:n.block}getOpcode(t){return void 0===t?null:t.opcode}getFields(t){return void 0===t?null:t.fields}getInputs(t){if(void 0===t)return null;let e=this._cache.inputs[t.id];if(void 0!==e)return e;e={};for(const r in t.inputs)r.substring(0,_.BRANCH_INPUT_PREFIX.length)!==_.BRANCH_INPUT_PREFIX&&(e[r]=t.inputs[r]);return this._cache.inputs[t.id]=e,e}getMutation(t){return void 0===t?null:t.mutation}getTopLevelScript(t){let e=this._blocks[t];if(void 0===e)return null;for(;null!==e.parent;)e=this._blocks[e.parent];return e.id}getProcedureDefinition(t){const e=this._cache.procedureDefinitions[t];if(void 0!==e)return e;for(const e in this._blocks){if(!this._blocks.hasOwnProperty(e))continue;const r=this._blocks[e];if("procedures_definition"===r.opcode){const i=this._getCustomBlockInternal(r);if(i&&i.mutation.proccode===t)return this._cache.procedureDefinitions[t]=e,e}}return this._cache.procedureDefinitions[t]=null,null}getProcedureParamNamesAndIds(t){return this.getProcedureParamNamesIdsAndDefaults(t).slice(0,2)}getProcedureParamNamesIdsAndDefaults(t){const e=this._cache.procedureParamNames[t];if(void 0!==e)return e;for(const e in this._blocks){if(!this._blocks.hasOwnProperty(e))continue;const r=this._blocks[e];if("procedures_prototype"===r.opcode&&r.mutation.proccode===t){const e=JSON.parse(r.mutation.argumentnames),i=JSON.parse(r.mutation.argumentids),n=JSON.parse(r.mutation.argumentdefaults);return this._cache.procedureParamNames[t]=[e,i,n],this._cache.procedureParamNames[t]}}return this._cache.procedureParamNames[t]=null,null}duplicate(){const t=new _(this.runtime,this.forceNoGlow);return t._blocks=a.simple(this._blocks),t._scripts=a.simple(this._scripts),this.resetBlockIDs(t),t}resetBlockIDs(t){const e={},r=t._blocks,i={},n=[];for(const t in r){const r=d();e[t]=r}for(const t in r){const n=r[t];n.id=e[t],n.next&&(n.next=e[n.next]),n.parent&&(n.parent=e[n.parent]);const s=n.inputs;if(s)for(const t in s){const r=s[t];r.block&&(r.block=e[r.block]),r.shadow&&(r.shadow=e[r.shadow])}i[n.id]=n}t._blocks=i;for(const r of t._scripts)n.push(e[r]);t._scripts=n}blocklyListen(t){if("object"!=typeof t)return;if("string"!=typeof t.blockId&&"string"!=typeof t.varId&&"string"!=typeof t.commentId)return;const e=this.runtime.getTargetForStage(),r=this.runtime.getEditingTarget();if("stackclick"!==t.element)switch(t.type){case"create":{const e=i(t);for(let t=0;t<e.length;t++)this.createBlock(e[t]);break}case"change":this.changeBlock({id:t.blockId,element:t.element,name:t.name,value:t.newValue});break;case"move":this.moveBlock({id:t.blockId,oldParent:t.oldParentId,oldInput:t.oldInputName,newParent:t.newParentId,newInput:t.newInputName,newCoordinate:t.newCoordinate});break;case"dragOutside":this.runtime.emitBlockDragUpdate(t.isOutside);break;case"endDrag":if(this.runtime.emitBlockDragUpdate(!1),t.isOutside){const e=i(t);this.runtime.emitBlockEndDrag(e,t.blockId)}break;case"delete":if(!this._blocks.hasOwnProperty(t.blockId)||this._blocks[t.blockId].shadow)return;this._blocks[t.blockId].topLevel&&this.runtime.quietGlow(t.blockId),this.deleteBlock(t.blockId);break;case"var_create":if(t.isLocal&&r&&!r.isStage&&!t.isCloud)r.lookupVariableById(t.varId)||(r.createVariable(t.varId,t.varName,t.varType),this.emitProjectChanged());else{if(e.lookupVariableById(t.varId))return;const r=this.runtime.targets.filter(t=>t.isOriginal);for(const e of r)if(e.lookupVariableByNameAndType(t.varName,t.varType,!0))return;e.createVariable(t.varId,t.varName,t.varType,t.isCloud),this.emitProjectChanged()}break;case"var_rename":if(r&&r.variables.hasOwnProperty(t.varId))r.renameVariable(t.varId,t.newName),r.blocks.updateBlocksAfterVarRename(t.varId,t.newName);else{e.renameVariable(t.varId,t.newName);const r=this.runtime.targets;for(let e=0;e<r.length;e++){r[e].blocks.updateBlocksAfterVarRename(t.varId,t.newName)}}this.emitProjectChanged();break;case"var_delete":(r&&r.variables.hasOwnProperty(t.varId)?r:e).deleteVariable(t.varId),this.emitProjectChanged();break;case"comment_create":if(this.runtime.getEditingTarget()){const e=this.runtime.getEditingTarget();e.createComment(t.commentId,t.blockId,t.text,t.xy.x,t.xy.y,t.width,t.height,t.minimized),null===e.comments[t.commentId].x&&null===e.comments[t.commentId].y&&(e.comments[t.commentId].x=t.xy.x,e.comments[t.commentId].y=t.xy.y)}this.emitProjectChanged();break;case"comment_change":if(this.runtime.getEditingTarget()){const e=this.runtime.getEditingTarget();if(!e.comments.hasOwnProperty(t.commentId))return void l.warn(`Cannot change comment with id ${t.commentId} because it does not exist.`);const r=e.comments[t.commentId],i=t.newContents_;i.hasOwnProperty("minimized")&&(r.minimized=i.minimized),i.hasOwnProperty("width")&&i.hasOwnProperty("height")&&(r.width=i.width,r.height=i.height),i.hasOwnProperty("text")&&(r.text=i.text),this.emitProjectChanged()}break;case"comment_move":if(this.runtime.getEditingTarget()){const e=this.runtime.getEditingTarget();if(e&&!e.comments.hasOwnProperty(t.commentId))return void l.warn(`Cannot change comment with id ${t.commentId} because it does not exist.`);const r=e.comments[t.commentId],i=t.newCoordinate_;r.x=i.x,r.y=i.y,this.emitProjectChanged()}break;case"comment_delete":if(this.runtime.getEditingTarget()){const e=this.runtime.getEditingTarget();if(!e.comments.hasOwnProperty(t.commentId))return;if(delete e.comments[t.commentId],t.blockId){const r=e.blocks.getBlock(t.blockId);if(!r)return void l.warn(`Could not find block referenced by comment with id: ${t.commentId}`);delete r.comment}this.emitProjectChanged()}}else this.runtime.toggleScript(t.blockId,{stackClick:!0})}resetCache(){this._cache.inputs={},this._cache.procedureParamNames={},this._cache.procedureDefinitions={},this._cache._executeCached={},this._cache._monitored=null,this._cache.scripts={}}emitProjectChanged(){this.forceNoGlow||this.runtime.emitProjectChanged()}createBlock(t){this._blocks.hasOwnProperty(t.id)||(this._blocks[t.id]=t,t.topLevel&&this._addScript(t.id),this.resetCache(),this.emitProjectChanged())}changeBlock(t){if(-1===["field","mutation","checkbox"].indexOf(t.element))return;let e=this._blocks[t.id];if(void 0!==e){switch(t.element){case"field":if(!e.fields[t.name])return;if("VARIABLE"===t.name||"LIST"===t.name||"BROADCAST_OPTION"===t.name){const r=this.runtime.getEditingTarget().lookupVariableById(t.value);r&&(e.fields[t.name].value=r.name,e.fields[t.name].id=t.value)}else{let r,i;if(e.fields[t.name].value=t.value,"sensing_of_object_menu"===e.opcode&&("_stage_"===e.fields.OBJECT.value?this._blocks[e.parent].fields.PROPERTY.value="backdrop #":this._blocks[e.parent].fields.PROPERTY.value="x position",this.runtime.flyoutBlocks!==this&&this.runtime.requestBlocksUpdate()),e.shadow&&e.parent){r=this._blocks[e.parent];const t=this.runtime.monitorBlockInfo[r.opcode];t&&t.isSpriteSpecific&&t.getId&&(r.targetId=r.targetId||this.runtime.getEditingTarget().id,i=t.getId(r.targetId,this._getBlockParams(r)),this.runtime._monitorState.has(i)||(i=null))}else e.isMonitored&&(r=e,i=e.id);i&&this.runtime.requestUpdateMonitor(u({id:i,params:this._getBlockParams(r)}))}break;case"mutation":e.mutation=n(t.value);break;case"checkbox":{const r=this._getBlockParams(e);if(r&&Object.keys(r).length>0&&"data_variable"!==e.opcode&&"data_listcontents"!==e.opcode){const i=m(e.id,r);let n=this.runtime.monitorBlocks.getBlock(i);if(!n){if(!t.value)return;n=JSON.parse(JSON.stringify(e));try{for(const t in r)void 0===n.fields[t]&&(n.fields[t]={name:t,value:Object.values(r[t])[0]});n.inputs={}}catch(t){}n.id=i,this.runtime.monitorBlocks.createBlock(n)}e=n}const i=e.isMonitored;e.isMonitored=t.value;let n=!1;"data_variable"===e.opcode?n=!this.runtime.getTargetForStage().variables[e.fields.VARIABLE.id]:"data_listcontents"===e.opcode&&(n=!this.runtime.getTargetForStage().variables[e.fields.LIST.id]);let s=this.runtime.monitorBlockInfo.hasOwnProperty(e.opcode)&&this.runtime.monitorBlockInfo[e.opcode].isSpriteSpecific;s&&this.runtime.monitorBlockInfo[e.opcode].hasOwnProperty("deviceId")&&(s=!!this.runtime.monitorBlockInfo[e.opcode].deviceId),"function"==typeof s&&(s=s(e));const a=n||s;e.targetId=a?e.targetId||this.runtime.getEditingTarget().id:null,i&&!e.isMonitored?this.runtime.requestHideMonitor(e.id):!i&&e.isMonitored&&(this.runtime.requestShowMonitor(e.id)||this.runtime.requestAddMonitor(o({id:e.id,targetId:e.targetId,spriteName:e.targetId?this.runtime.getTargetById(e.targetId).getName():null,opcode:e.opcode,params:this._getBlockParams(e),value:"",mode:"data_listcontents"===e.opcode?"list":"default"})));break}}this.emitProjectChanged(),this.resetCache()}}moveBlock(t){if(!this._blocks.hasOwnProperty(t.id))return;const e=this._blocks[t.id];let r=!1;if(t.newCoordinate&&(r=e.x!==t.newCoordinate.x||e.y!==t.newCoordinate.y,e.x=t.newCoordinate.x,e.y=t.newCoordinate.y),void 0!==t.oldParent){const e=this._blocks[t.oldParent];void 0!==t.oldInput&&e.inputs[t.oldInput].block===t.id?e.inputs[t.oldInput].block=null:e.next===t.id&&(e.next=null),this._blocks[t.id].parent=null,r=!0}if(void 0===t.newParent)this._addScript(t.id);else{if(this._deleteScript(t.id),void 0===t.newInput)this._blocks[t.newParent].next=t.id;else{let e=null;this._blocks[t.newParent].inputs.hasOwnProperty(t.newInput)&&(e=this._blocks[t.newParent].inputs[t.newInput].shadow),this._blocks[t.id].shadow&&(e=t.id),this._blocks[t.newParent].inputs[t.newInput]={name:t.newInput,block:t.id,shadow:e}}this._blocks[t.id].parent=t.newParent,r=!0}this.resetCache(),r&&this.emitProjectChanged()}runAllMonitored(t){null===this._cache._monitored&&(this._cache._monitored=Object.keys(this._blocks).filter(t=>this.getBlock(t).isMonitored).map(e=>{const r=this.getBlock(e).targetId;return{blockId:e,target:r?t.getTargetById(r):null}}));const e=this._cache._monitored;for(let r=0;r<e.length;r++){const{blockId:i,target:n}=e[r];t.addMonitorScript(i,n)}}deleteBlock(t){const e=this._blocks[t];if(e){null!==e.next&&this.deleteBlock(e.next);for(const t in e.inputs)null!==e.inputs[t].block&&this.deleteBlock(e.inputs[t].block),null!==e.inputs[t].shadow&&e.inputs[t].shadow!==e.inputs[t].block&&this.deleteBlock(e.inputs[t].shadow);this._deleteScript(t),delete this._blocks[t],this.resetCache(),this.emitProjectChanged()}}getAllVariableAndListReferences(t,e){const r=t||this._blocks,i=Object.create(null);for(const t in r){let n=null,s=null;if(r[t].fields.VARIABLE?(n=r[t].fields.VARIABLE,s=p.SCALAR_TYPE):r[t].fields.LIST?(n=r[t].fields.LIST,s=p.LIST_TYPE):e&&r[t].fields.BROADCAST_OPTION&&(n=r[t].fields.BROADCAST_OPTION,s=p.BROADCAST_MESSAGE_TYPE),n){const t=n.id;i[t]?i[t].push({referencingField:n,type:s}):i[t]=[{referencingField:n,type:s}]}}return i}updateBlocksAfterVarRename(t,e){const r=this._blocks;for(const i in r){let n=null;if(r[i].fields.VARIABLE?n=r[i].fields.VARIABLE:r[i].fields.LIST&&(n=r[i].fields.LIST),n){t===n.id&&(n.value=e)}}}updateTargetSpecificBlocks(t){const e=this._blocks;for(const r in e)t&&"event_whenthisspriteclicked"===e[r].opcode?e[r].opcode="event_whenstageclicked":t||"event_whenstageclicked"!==e[r].opcode||(e[r].opcode="event_whenthisspriteclicked")}updateAssetName(t,e,r){let i;if("costume"===r)i=this._getCostumeField.bind(this);else if("sound"===r)i=this._getSoundField.bind(this);else if("backdrop"===r)i=this._getBackdropField.bind(this);else{if("sprite"!==r)return;i=this._getSpriteField.bind(this)}const n=this._blocks;for(const r in n){const n=i(r);n&&n.value===t&&(n.value=e)}}_getCostumeField(t){const e=this.getBlock(t);return e&&e.fields.hasOwnProperty("COSTUME")?e.fields.COSTUME:null}_getSoundField(t){const e=this.getBlock(t);return e&&e.fields.hasOwnProperty("SOUND_MENU")?e.fields.SOUND_MENU:null}_getBackdropField(t){const e=this.getBlock(t);return e&&e.fields.hasOwnProperty("BACKDROP")?e.fields.BACKDROP:null}_getSpriteField(t){const e=this.getBlock(t);if(!e)return null;const r=["TOWARDS","TO","OBJECT","VIDEOONMENU2","DISTANCETOMENU","TOUCHINGOBJECTMENU","CLONE_OPTION"];for(let t=0;t<r.length;t++){const i=r[t];if(e.fields.hasOwnProperty(i))return e.fields[i]}return null}toXML(t){return this._scripts.map(e=>this.blockToXML(e,t)).join()}blockToXML(t,e){const r=this._blocks[t];if(!r)return;const i=r.shadow?"shadow":"block";let n=`<${i}\n                id="${r.id}"\n                type="${r.opcode}"\n                ${r.topLevel?`x="${r.x}" y="${r.y}"`:""}\n            >`;const o=r.comment;o&&(e?e.hasOwnProperty(o)?n+=e[o].toXML():l.warn(`Could not find comment with id: ${o} in provided comment descriptions.`):l.warn(`Cannot serialize comment with id: ${o}; no comment descriptions provided.`)),r.mutation&&(n+=this.mutationToXML(r.mutation));for(const t in r.inputs){if(!r.inputs.hasOwnProperty(t))continue;const i=r.inputs[t];(i.block||i.shadow)&&(n+=`<value name="${i.name}">`,i.block&&(n+=this.blockToXML(i.block,e)),i.shadow&&i.shadow!==i.block&&(n+=this.blockToXML(i.shadow,e)),n+="</value>")}for(const t in r.fields){if(!r.fields.hasOwnProperty(t))continue;const e=r.fields[t];n+=`<field name="${e.name}"`;const i=e.id;i&&(n+=` id="${i}"`);const o=e.variableType;"string"==typeof o&&(n+=` variabletype="${o}"`);let a=e.value;"string"==typeof a&&(a=s(e.value)),n+=`>${a}</field>`}return r.next&&(n+=`<next>${this.blockToXML(r.next,e)}</next>`),n+=`</${i}>`,n}mutationToXML(t){let e=`<${t.tagName}`;for(const r in t){if("children"===r||"tagName"===r)continue;let i="string"==typeof t[r]?s(t[r]):t[r];"blockInfo"===r&&(i=s(JSON.stringify(t[r]))),e+=` ${r}="${i}"`}e+=">";for(let r=0;r<t.children.length;r++)e+=this.mutationToXML(t.children[r]);return e+=`</${t.tagName}>`,e}_getBlockParams(t){const e={};for(const r in t.fields)e[r]=t.fields[r].value;for(const r in t.inputs){const i=t.inputs[r].block,n=this.runtime.flyoutBlocks.getBlock(i)||this.getBlock(i);if(n){e[r]={};for(const t in n.fields)e[r][t]=n.fields[t].value}}return e}_getCustomBlockInternal(t){if(t.inputs&&t.inputs.custom_block)return this._blocks[t.inputs.custom_block.block]}_addScript(t){this._scripts.indexOf(t)>-1||(this._scripts.push(t),this._blocks[t].topLevel=!0)}_deleteScript(t){const e=this._scripts.indexOf(t);e>-1&&this._scripts.splice(e,1),this._blocks[t]&&(this._blocks[t].topLevel=!1)}}c.getCached=function(t,e,r){let i=t._cache._executeCached[e];if(void 0!==i)return i;const n=t.getBlock(e);return void 0===n?null:(i=void 0===r?{id:e,opcode:t.getOpcode(n),fields:t.getFields(n),inputs:t.getInputs(n),mutation:t.getMutation(n)}:new r(t,{id:e,opcode:t.getOpcode(n),fields:t.getFields(n),inputs:t.getInputs(n),mutation:t.getMutation(n)}),t._cache._executeCached[e]=i,i)};const f=h._RuntimeScriptCache;h.getScripts=function(t,e){let r=t._cache.scripts[e];if(!r){r=t._cache.scripts[e]=[];const i=t._scripts;for(let n=0;n<i.length;n++){const s=i[n];t.getBlock(s).opcode===e&&r.push(new f(t,s))}}return r},t.exports=_},136:function(t,e){class r{static get BACKGROUND_LAYER(){return"background"}static get VIDEO_LAYER(){return"video"}static get PEN_LAYER(){return"pen"}static get SPRITE_LAYER(){return"sprite"}static get LAYER_GROUPS(){return[r.BACKGROUND_LAYER,r.VIDEO_LAYER,r.PEN_LAYER,r.SPRITE_LAYER]}}t.exports=r},156:function(t,e,r){var i=r(447),n=r(893);function s(e,r){return delete t.exports[e],t.exports[e]=r,r}t.exports={Parser:i,Tokenizer:r(448),ElementType:r(176),DomHandler:n,get FeedHandler(){return s("FeedHandler",r(895))},get Stream(){return s("Stream",r(896))},get WritableStream(){return s("WritableStream",r(450))},get ProxyHandler(){return s("ProxyHandler",r(898))},get DomUtils(){return s("DomUtils",r(899))},get CollectingHandler(){return s("CollectingHandler",r(913))},DefaultHandler:n,get RssHandler(){return s("RssHandler",this.FeedHandler)},parseDOM:function(t,e){var r=new n(e);return new i(r,e).end(t),r.dom},parseFeed:function(e,r){var n=new t.exports.FeedHandler(r);return new i(n,r).end(e),n.dom},createDomStream:function(t,e,r){var s=new n(t,e,r);return new i(s,e)},EVENTS:{attribute:2,cdatastart:0,cdataend:0,text:1,processinginstruction:2,comment:1,commentend:0,closetag:1,opentag:2,opentagname:1,error:1,end:0}}},175:function(t,e,r){t.exports=function(){"use strict";var t=Array.prototype.slice;function e(t,e){e&&(t.prototype=Object.create(e.prototype)),t.prototype.constructor=t}function r(t){return o(t)?t:$(t)}function i(t){return a(t)?t:H(t)}function n(t){return u(t)?t:W(t)}function s(t){return o(t)&&!c(t)?t:K(t)}function o(t){return!(!t||!t[l])}function a(t){return!(!t||!t[p])}function u(t){return!(!t||!t[d])}function c(t){return a(t)||u(t)}function h(t){return!(!t||!t[m])}e(i,r),e(n,r),e(s,r),r.isIterable=o,r.isKeyed=a,r.isIndexed=u,r.isAssociative=c,r.isOrdered=h,r.Keyed=i,r.Indexed=n,r.Set=s;var l="@@__IMMUTABLE_ITERABLE__@@",p="@@__IMMUTABLE_KEYED__@@",d="@@__IMMUTABLE_INDEXED__@@",m="@@__IMMUTABLE_ORDERED__@@",_=5,f=1<<_,g=f-1,b={},y={value:!1},T={value:!1};function v(t){return t.value=!1,t}function S(t){t&&(t.value=!0)}function E(){}function O(t,e){e=e||0;for(var r=Math.max(0,t.length-e),i=new Array(r),n=0;n<r;n++)i[n]=t[n+e];return i}function I(t){return void 0===t.size&&(t.size=t.__iterate(w)),t.size}function k(t,e){if("number"!=typeof e){var r=e>>>0;if(""+r!==e||4294967295===r)return NaN;e=r}return e<0?I(t)+e:e}function w(){return!0}function N(t,e,r){return(0===t||void 0!==r&&t<=-r)&&(void 0===e||void 0!==r&&e>=r)}function A(t,e){return C(t,e,0)}function x(t,e){return C(t,e,e)}function C(t,e,r){return void 0===t?r:t<0?Math.max(0,e+t):void 0===e?t:Math.min(e,t)}var M=0,P=1,R=2,D="function"==typeof Symbol&&Symbol.iterator,B="@@iterator",L=D||B;function U(t){this.next=t}function F(t,e,r,i){var n=0===t?e:1===t?r:[e,r];return i?i.value=n:i={value:n,done:!1},i}function V(){return{value:void 0,done:!0}}function z(t){return!!Y(t)}function j(t){return t&&"function"==typeof t.next}function G(t){var e=Y(t);return e&&e.call(t)}function Y(t){var e=t&&(D&&t[D]||t[B]);if("function"==typeof e)return e}function q(t){return t&&"number"==typeof t.length}function $(t){return null==t?st():o(t)?t.toSeq():function(t){var e=ut(t)||"object"==typeof t&&new et(t);if(!e)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+t);return e}(t)}function H(t){return null==t?st().toKeyedSeq():o(t)?a(t)?t.toSeq():t.fromEntrySeq():ot(t)}function W(t){return null==t?st():o(t)?a(t)?t.entrySeq():t.toIndexedSeq():at(t)}function K(t){return(null==t?st():o(t)?a(t)?t.entrySeq():t:at(t)).toSetSeq()}U.prototype.toString=function(){return"[Iterator]"},U.KEYS=M,U.VALUES=P,U.ENTRIES=R,U.prototype.inspect=U.prototype.toSource=function(){return this.toString()},U.prototype[L]=function(){return this},e($,r),$.of=function(){return $(arguments)},$.prototype.toSeq=function(){return this},$.prototype.toString=function(){return this.__toString("Seq {","}")},$.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},$.prototype.__iterate=function(t,e){return ct(this,t,e,!0)},$.prototype.__iterator=function(t,e){return ht(this,t,e,!0)},e(H,$),H.prototype.toKeyedSeq=function(){return this},e(W,$),W.of=function(){return W(arguments)},W.prototype.toIndexedSeq=function(){return this},W.prototype.toString=function(){return this.__toString("Seq [","]")},W.prototype.__iterate=function(t,e){return ct(this,t,e,!1)},W.prototype.__iterator=function(t,e){return ht(this,t,e,!1)},e(K,$),K.of=function(){return K(arguments)},K.prototype.toSetSeq=function(){return this},$.isSeq=nt,$.Keyed=H,$.Set=K,$.Indexed=W;var X,J,Q,Z="@@__IMMUTABLE_SEQ__@@";function tt(t){this._array=t,this.size=t.length}function et(t){var e=Object.keys(t);this._object=t,this._keys=e,this.size=e.length}function rt(t){this._iterable=t,this.size=t.length||t.size}function it(t){this._iterator=t,this._iteratorCache=[]}function nt(t){return!(!t||!t[Z])}function st(){return X||(X=new tt([]))}function ot(t){var e=Array.isArray(t)?new tt(t).fromEntrySeq():j(t)?new it(t).fromEntrySeq():z(t)?new rt(t).fromEntrySeq():"object"==typeof t?new et(t):void 0;if(!e)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+t);return e}function at(t){var e=ut(t);if(!e)throw new TypeError("Expected Array or iterable object of values: "+t);return e}function ut(t){return q(t)?new tt(t):j(t)?new it(t):z(t)?new rt(t):void 0}function ct(t,e,r,i){var n=t._cache;if(n){for(var s=n.length-1,o=0;o<=s;o++){var a=n[r?s-o:o];if(!1===e(a[1],i?a[0]:o,t))return o+1}return o}return t.__iterateUncached(e,r)}function ht(t,e,r,i){var n=t._cache;if(n){var s=n.length-1,o=0;return new U((function(){var t=n[r?s-o:o];return o++>s?{value:void 0,done:!0}:F(e,i?t[0]:o-1,t[1])}))}return t.__iteratorUncached(e,r)}function lt(t,e){return e?function t(e,r,i,n){return Array.isArray(r)?e.call(n,i,W(r).map((function(i,n){return t(e,i,n,r)}))):dt(r)?e.call(n,i,H(r).map((function(i,n){return t(e,i,n,r)}))):r}(e,t,"",{"":t}):pt(t)}function pt(t){return Array.isArray(t)?W(t).map(pt).toList():dt(t)?H(t).map(pt).toMap():t}function dt(t){return t&&(t.constructor===Object||void 0===t.constructor)}function mt(t,e){if(t===e||t!=t&&e!=e)return!0;if(!t||!e)return!1;if("function"==typeof t.valueOf&&"function"==typeof e.valueOf){if((t=t.valueOf())===(e=e.valueOf())||t!=t&&e!=e)return!0;if(!t||!e)return!1}return!("function"!=typeof t.equals||"function"!=typeof e.equals||!t.equals(e))}function _t(t,e){if(t===e)return!0;if(!o(e)||void 0!==t.size&&void 0!==e.size&&t.size!==e.size||void 0!==t.__hash&&void 0!==e.__hash&&t.__hash!==e.__hash||a(t)!==a(e)||u(t)!==u(e)||h(t)!==h(e))return!1;if(0===t.size&&0===e.size)return!0;var r=!c(t);if(h(t)){var i=t.entries();return e.every((function(t,e){var n=i.next().value;return n&&mt(n[1],t)&&(r||mt(n[0],e))}))&&i.next().done}var n=!1;if(void 0===t.size)if(void 0===e.size)"function"==typeof t.cacheResult&&t.cacheResult();else{n=!0;var s=t;t=e,e=s}var l=!0,p=e.__iterate((function(e,i){if(r?!t.has(e):n?!mt(e,t.get(i,b)):!mt(t.get(i,b),e))return l=!1,!1}));return l&&t.size===p}function ft(t,e){if(!(this instanceof ft))return new ft(t,e);if(this._value=t,this.size=void 0===e?1/0:Math.max(0,e),0===this.size){if(J)return J;J=this}}function gt(t,e){if(!t)throw new Error(e)}function bt(t,e,r){if(!(this instanceof bt))return new bt(t,e,r);if(gt(0!==r,"Cannot step a Range by 0"),t=t||0,void 0===e&&(e=1/0),r=void 0===r?1:Math.abs(r),e<t&&(r=-r),this._start=t,this._end=e,this._step=r,this.size=Math.max(0,Math.ceil((e-t)/r-1)+1),0===this.size){if(Q)return Q;Q=this}}function yt(){throw TypeError("Abstract")}function Tt(){}function vt(){}function St(){}$.prototype[Z]=!0,e(tt,W),tt.prototype.get=function(t,e){return this.has(t)?this._array[k(this,t)]:e},tt.prototype.__iterate=function(t,e){for(var r=this._array,i=r.length-1,n=0;n<=i;n++)if(!1===t(r[e?i-n:n],n,this))return n+1;return n},tt.prototype.__iterator=function(t,e){var r=this._array,i=r.length-1,n=0;return new U((function(){return n>i?{value:void 0,done:!0}:F(t,n,r[e?i-n++:n++])}))},e(et,H),et.prototype.get=function(t,e){return void 0===e||this.has(t)?this._object[t]:e},et.prototype.has=function(t){return this._object.hasOwnProperty(t)},et.prototype.__iterate=function(t,e){for(var r=this._object,i=this._keys,n=i.length-1,s=0;s<=n;s++){var o=i[e?n-s:s];if(!1===t(r[o],o,this))return s+1}return s},et.prototype.__iterator=function(t,e){var r=this._object,i=this._keys,n=i.length-1,s=0;return new U((function(){var o=i[e?n-s:s];return s++>n?{value:void 0,done:!0}:F(t,o,r[o])}))},et.prototype[m]=!0,e(rt,W),rt.prototype.__iterateUncached=function(t,e){if(e)return this.cacheResult().__iterate(t,e);var r=G(this._iterable),i=0;if(j(r))for(var n;!(n=r.next()).done&&!1!==t(n.value,i++,this););return i},rt.prototype.__iteratorUncached=function(t,e){if(e)return this.cacheResult().__iterator(t,e);var r=G(this._iterable);if(!j(r))return new U(V);var i=0;return new U((function(){var e=r.next();return e.done?e:F(t,i++,e.value)}))},e(it,W),it.prototype.__iterateUncached=function(t,e){if(e)return this.cacheResult().__iterate(t,e);for(var r,i=this._iterator,n=this._iteratorCache,s=0;s<n.length;)if(!1===t(n[s],s++,this))return s;for(;!(r=i.next()).done;){var o=r.value;if(n[s]=o,!1===t(o,s++,this))break}return s},it.prototype.__iteratorUncached=function(t,e){if(e)return this.cacheResult().__iterator(t,e);var r=this._iterator,i=this._iteratorCache,n=0;return new U((function(){if(n>=i.length){var e=r.next();if(e.done)return e;i[n]=e.value}return F(t,n,i[n++])}))},e(ft,W),ft.prototype.toString=function(){return 0===this.size?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},ft.prototype.get=function(t,e){return this.has(t)?this._value:e},ft.prototype.includes=function(t){return mt(this._value,t)},ft.prototype.slice=function(t,e){var r=this.size;return N(t,e,r)?this:new ft(this._value,x(e,r)-A(t,r))},ft.prototype.reverse=function(){return this},ft.prototype.indexOf=function(t){return mt(this._value,t)?0:-1},ft.prototype.lastIndexOf=function(t){return mt(this._value,t)?this.size:-1},ft.prototype.__iterate=function(t,e){for(var r=0;r<this.size;r++)if(!1===t(this._value,r,this))return r+1;return r},ft.prototype.__iterator=function(t,e){var r=this,i=0;return new U((function(){return i<r.size?F(t,i++,r._value):{value:void 0,done:!0}}))},ft.prototype.equals=function(t){return t instanceof ft?mt(this._value,t._value):_t(t)},e(bt,W),bt.prototype.toString=function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(1!==this._step?" by "+this._step:"")+" ]"},bt.prototype.get=function(t,e){return this.has(t)?this._start+k(this,t)*this._step:e},bt.prototype.includes=function(t){var e=(t-this._start)/this._step;return e>=0&&e<this.size&&e===Math.floor(e)},bt.prototype.slice=function(t,e){return N(t,e,this.size)?this:(t=A(t,this.size),(e=x(e,this.size))<=t?new bt(0,0):new bt(this.get(t,this._end),this.get(e,this._end),this._step))},bt.prototype.indexOf=function(t){var e=t-this._start;if(e%this._step==0){var r=e/this._step;if(r>=0&&r<this.size)return r}return-1},bt.prototype.lastIndexOf=function(t){return this.indexOf(t)},bt.prototype.__iterate=function(t,e){for(var r=this.size-1,i=this._step,n=e?this._start+r*i:this._start,s=0;s<=r;s++){if(!1===t(n,s,this))return s+1;n+=e?-i:i}return s},bt.prototype.__iterator=function(t,e){var r=this.size-1,i=this._step,n=e?this._start+r*i:this._start,s=0;return new U((function(){var o=n;return n+=e?-i:i,s>r?{value:void 0,done:!0}:F(t,s++,o)}))},bt.prototype.equals=function(t){return t instanceof bt?this._start===t._start&&this._end===t._end&&this._step===t._step:_t(this,t)},e(yt,r),e(Tt,yt),e(vt,yt),e(St,yt),yt.Keyed=Tt,yt.Indexed=vt,yt.Set=St;var Et="function"==typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function(t,e){var r=65535&(t|=0),i=65535&(e|=0);return r*i+((t>>>16)*i+r*(e>>>16)<<16>>>0)|0};function Ot(t){return t>>>1&1073741824|3221225471&t}function It(t){if(!1===t||null==t)return 0;if("function"==typeof t.valueOf&&(!1===(t=t.valueOf())||null==t))return 0;if(!0===t)return 1;var e=typeof t;if("number"===e){if(t!=t||t===1/0)return 0;var r=0|t;for(r!==t&&(r^=4294967295*t);t>4294967295;)r^=t/=4294967295;return Ot(r)}if("string"===e)return t.length>Pt?function(t){var e=Bt[t];return void 0===e&&(e=kt(t),Dt===Rt&&(Dt=0,Bt={}),Dt++,Bt[t]=e),e}(t):kt(t);if("function"==typeof t.hashCode)return t.hashCode();if("object"===e)return function(t){var e;if(xt&&void 0!==(e=wt.get(t)))return e;if(void 0!==(e=t[Mt]))return e;if(!At){if(void 0!==(e=t.propertyIsEnumerable&&t.propertyIsEnumerable[Mt]))return e;if(void 0!==(e=function(t){if(t&&t.nodeType>0)switch(t.nodeType){case 1:return t.uniqueID;case 9:return t.documentElement&&t.documentElement.uniqueID}}(t)))return e}if(e=++Ct,1073741824&Ct&&(Ct=0),xt)wt.set(t,e);else{if(void 0!==Nt&&!1===Nt(t))throw new Error("Non-extensible objects are not allowed as keys.");if(At)Object.defineProperty(t,Mt,{enumerable:!1,configurable:!1,writable:!1,value:e});else if(void 0!==t.propertyIsEnumerable&&t.propertyIsEnumerable===t.constructor.prototype.propertyIsEnumerable)t.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},t.propertyIsEnumerable[Mt]=e;else{if(void 0===t.nodeType)throw new Error("Unable to set a non-enumerable property on object.");t[Mt]=e}}return e}(t);if("function"==typeof t.toString)return kt(t.toString());throw new Error("Value type "+e+" cannot be hashed.")}function kt(t){for(var e=0,r=0;r<t.length;r++)e=31*e+t.charCodeAt(r)|0;return Ot(e)}var wt,Nt=Object.isExtensible,At=function(){try{return Object.defineProperty({},"@",{}),!0}catch(t){return!1}}(),xt="function"==typeof WeakMap;xt&&(wt=new WeakMap);var Ct=0,Mt="__immutablehash__";"function"==typeof Symbol&&(Mt=Symbol(Mt));var Pt=16,Rt=255,Dt=0,Bt={};function Lt(t){gt(t!==1/0,"Cannot perform this action with an infinite size.")}function Ut(t){return null==t?Qt():Ft(t)&&!h(t)?t:Qt().withMutations((function(e){var r=i(t);Lt(r.size),r.forEach((function(t,r){return e.set(r,t)}))}))}function Ft(t){return!(!t||!t[zt])}e(Ut,Tt),Ut.of=function(){var e=t.call(arguments,0);return Qt().withMutations((function(t){for(var r=0;r<e.length;r+=2){if(r+1>=e.length)throw new Error("Missing value for key: "+e[r]);t.set(e[r],e[r+1])}}))},Ut.prototype.toString=function(){return this.__toString("Map {","}")},Ut.prototype.get=function(t,e){return this._root?this._root.get(0,void 0,t,e):e},Ut.prototype.set=function(t,e){return Zt(this,t,e)},Ut.prototype.setIn=function(t,e){return this.updateIn(t,b,(function(){return e}))},Ut.prototype.remove=function(t){return Zt(this,t,b)},Ut.prototype.deleteIn=function(t){return this.updateIn(t,(function(){return b}))},Ut.prototype.update=function(t,e,r){return 1===arguments.length?t(this):this.updateIn([t],e,r)},Ut.prototype.updateIn=function(t,e,r){r||(r=e,e=void 0);var i=function t(e,r,i,n){var s=e===b,o=r.next();if(o.done){var a=s?i:e,u=n(a);return u===a?e:u}gt(s||e&&e.set,"invalid keyPath");var c=o.value,h=s?b:e.get(c,b),l=t(h,r,i,n);return l===h?e:l===b?e.remove(c):(s?Qt():e).set(c,l)}(this,ir(t),e,r);return i===b?void 0:i},Ut.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Qt()},Ut.prototype.merge=function(){return ie(this,void 0,arguments)},Ut.prototype.mergeWith=function(e){var r=t.call(arguments,1);return ie(this,e,r)},Ut.prototype.mergeIn=function(e){var r=t.call(arguments,1);return this.updateIn(e,Qt(),(function(t){return"function"==typeof t.merge?t.merge.apply(t,r):r[r.length-1]}))},Ut.prototype.mergeDeep=function(){return ie(this,ne,arguments)},Ut.prototype.mergeDeepWith=function(e){var r=t.call(arguments,1);return ie(this,se(e),r)},Ut.prototype.mergeDeepIn=function(e){var r=t.call(arguments,1);return this.updateIn(e,Qt(),(function(t){return"function"==typeof t.mergeDeep?t.mergeDeep.apply(t,r):r[r.length-1]}))},Ut.prototype.sort=function(t){return Ae($e(this,t))},Ut.prototype.sortBy=function(t,e){return Ae($e(this,e,t))},Ut.prototype.withMutations=function(t){var e=this.asMutable();return t(e),e.wasAltered()?e.__ensureOwner(this.__ownerID):this},Ut.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new E)},Ut.prototype.asImmutable=function(){return this.__ensureOwner()},Ut.prototype.wasAltered=function(){return this.__altered},Ut.prototype.__iterator=function(t,e){return new Wt(this,t,e)},Ut.prototype.__iterate=function(t,e){var r=this,i=0;return this._root&&this._root.iterate((function(e){return i++,t(e[1],e[0],r)}),e),i},Ut.prototype.__ensureOwner=function(t){return t===this.__ownerID?this:t?Jt(this.size,this._root,t,this.__hash):(this.__ownerID=t,this.__altered=!1,this)},Ut.isMap=Ft;var Vt,zt="@@__IMMUTABLE_MAP__@@",jt=Ut.prototype;function Gt(t,e){this.ownerID=t,this.entries=e}function Yt(t,e,r){this.ownerID=t,this.bitmap=e,this.nodes=r}function qt(t,e,r){this.ownerID=t,this.count=e,this.nodes=r}function $t(t,e,r){this.ownerID=t,this.keyHash=e,this.entries=r}function Ht(t,e,r){this.ownerID=t,this.keyHash=e,this.entry=r}function Wt(t,e,r){this._type=e,this._reverse=r,this._stack=t._root&&Xt(t._root)}function Kt(t,e){return F(t,e[0],e[1])}function Xt(t,e){return{node:t,index:0,__prev:e}}function Jt(t,e,r,i){var n=Object.create(jt);return n.size=t,n._root=e,n.__ownerID=r,n.__hash=i,n.__altered=!1,n}function Qt(){return Vt||(Vt=Jt(0))}function Zt(t,e,r){var i,n;if(t._root){var s=v(y),o=v(T);if(i=te(t._root,t.__ownerID,0,void 0,e,r,s,o),!o.value)return t;n=t.size+(s.value?r===b?-1:1:0)}else{if(r===b)return t;n=1,i=new Gt(t.__ownerID,[[e,r]])}return t.__ownerID?(t.size=n,t._root=i,t.__hash=void 0,t.__altered=!0,t):i?Jt(n,i):Qt()}function te(t,e,r,i,n,s,o,a){return t?t.update(e,r,i,n,s,o,a):s===b?t:(S(a),S(o),new Ht(e,i,[n,s]))}function ee(t){return t.constructor===Ht||t.constructor===$t}function re(t,e,r,i,n){if(t.keyHash===i)return new $t(e,i,[t.entry,n]);var s,o=(0===r?t.keyHash:t.keyHash>>>r)&g,a=(0===r?i:i>>>r)&g;return new Yt(e,1<<o|1<<a,o===a?[re(t,e,r+_,i,n)]:(s=new Ht(e,i,n),o<a?[t,s]:[s,t]))}function ie(t,e,r){for(var n=[],s=0;s<r.length;s++){var a=r[s],u=i(a);o(a)||(u=u.map((function(t){return lt(t)}))),n.push(u)}return oe(t,e,n)}function ne(t,e,r){return t&&t.mergeDeep&&o(e)?t.mergeDeep(e):mt(t,e)?t:e}function se(t){return function(e,r,i){if(e&&e.mergeDeepWith&&o(r))return e.mergeDeepWith(t,r);var n=t(e,r,i);return mt(e,n)?e:n}}function oe(t,e,r){return 0===(r=r.filter((function(t){return 0!==t.size}))).length?t:0!==t.size||t.__ownerID||1!==r.length?t.withMutations((function(t){for(var i=e?function(r,i){t.update(i,b,(function(t){return t===b?r:e(t,r,i)}))}:function(e,r){t.set(r,e)},n=0;n<r.length;n++)r[n].forEach(i)})):t.constructor(r[0])}function ae(t){return t=(t=(858993459&(t-=t>>1&1431655765))+(t>>2&858993459))+(t>>4)&252645135,t+=t>>8,127&(t+=t>>16)}function ue(t,e,r,i){var n=i?t:O(t);return n[e]=r,n}jt[zt]=!0,jt.delete=jt.remove,jt.removeIn=jt.deleteIn,Gt.prototype.get=function(t,e,r,i){for(var n=this.entries,s=0,o=n.length;s<o;s++)if(mt(r,n[s][0]))return n[s][1];return i},Gt.prototype.update=function(t,e,r,i,n,s,o){for(var a=n===b,u=this.entries,c=0,h=u.length;c<h&&!mt(i,u[c][0]);c++);var l=c<h;if(l?u[c][1]===n:a)return this;if(S(o),(a||!l)&&S(s),!a||1!==u.length){if(!l&&!a&&u.length>=ce)return function(t,e,r,i){t||(t=new E);for(var n=new Ht(t,It(r),[r,i]),s=0;s<e.length;s++){var o=e[s];n=n.update(t,0,void 0,o[0],o[1])}return n}(t,u,i,n);var p=t&&t===this.ownerID,d=p?u:O(u);return l?a?c===h-1?d.pop():d[c]=d.pop():d[c]=[i,n]:d.push([i,n]),p?(this.entries=d,this):new Gt(t,d)}},Yt.prototype.get=function(t,e,r,i){void 0===e&&(e=It(r));var n=1<<((0===t?e:e>>>t)&g),s=this.bitmap;return 0==(s&n)?i:this.nodes[ae(s&n-1)].get(t+_,e,r,i)},Yt.prototype.update=function(t,e,r,i,n,s,o){void 0===r&&(r=It(i));var a=(0===e?r:r>>>e)&g,u=1<<a,c=this.bitmap,h=0!=(c&u);if(!h&&n===b)return this;var l=ae(c&u-1),p=this.nodes,d=h?p[l]:void 0,m=te(d,t,e+_,r,i,n,s,o);if(m===d)return this;if(!h&&m&&p.length>=he)return function(t,e,r,i,n){for(var s=0,o=new Array(f),a=0;0!==r;a++,r>>>=1)o[a]=1&r?e[s++]:void 0;return o[i]=n,new qt(t,s+1,o)}(t,p,c,a,m);if(h&&!m&&2===p.length&&ee(p[1^l]))return p[1^l];if(h&&m&&1===p.length&&ee(m))return m;var y=t&&t===this.ownerID,T=h?m?c:c^u:c|u,v=h?m?ue(p,l,m,y):function(t,e,r){var i=t.length-1;if(r&&e===i)return t.pop(),t;for(var n=new Array(i),s=0,o=0;o<i;o++)o===e&&(s=1),n[o]=t[o+s];return n}(p,l,y):function(t,e,r,i){var n=t.length+1;if(i&&e+1===n)return t[e]=r,t;for(var s=new Array(n),o=0,a=0;a<n;a++)a===e?(s[a]=r,o=-1):s[a]=t[a+o];return s}(p,l,m,y);return y?(this.bitmap=T,this.nodes=v,this):new Yt(t,T,v)},qt.prototype.get=function(t,e,r,i){void 0===e&&(e=It(r));var n=(0===t?e:e>>>t)&g,s=this.nodes[n];return s?s.get(t+_,e,r,i):i},qt.prototype.update=function(t,e,r,i,n,s,o){void 0===r&&(r=It(i));var a=(0===e?r:r>>>e)&g,u=n===b,c=this.nodes,h=c[a];if(u&&!h)return this;var l=te(h,t,e+_,r,i,n,s,o);if(l===h)return this;var p=this.count;if(h){if(!l&&--p<le)return function(t,e,r,i){for(var n=0,s=0,o=new Array(r),a=0,u=1,c=e.length;a<c;a++,u<<=1){var h=e[a];void 0!==h&&a!==i&&(n|=u,o[s++]=h)}return new Yt(t,n,o)}(t,c,p,a)}else p++;var d=t&&t===this.ownerID,m=ue(c,a,l,d);return d?(this.count=p,this.nodes=m,this):new qt(t,p,m)},$t.prototype.get=function(t,e,r,i){for(var n=this.entries,s=0,o=n.length;s<o;s++)if(mt(r,n[s][0]))return n[s][1];return i},$t.prototype.update=function(t,e,r,i,n,s,o){void 0===r&&(r=It(i));var a=n===b;if(r!==this.keyHash)return a?this:(S(o),S(s),re(this,t,e,r,[i,n]));for(var u=this.entries,c=0,h=u.length;c<h&&!mt(i,u[c][0]);c++);var l=c<h;if(l?u[c][1]===n:a)return this;if(S(o),(a||!l)&&S(s),a&&2===h)return new Ht(t,this.keyHash,u[1^c]);var p=t&&t===this.ownerID,d=p?u:O(u);return l?a?c===h-1?d.pop():d[c]=d.pop():d[c]=[i,n]:d.push([i,n]),p?(this.entries=d,this):new $t(t,this.keyHash,d)},Ht.prototype.get=function(t,e,r,i){return mt(r,this.entry[0])?this.entry[1]:i},Ht.prototype.update=function(t,e,r,i,n,s,o){var a=n===b,u=mt(i,this.entry[0]);return(u?n===this.entry[1]:a)?this:(S(o),a?void S(s):u?t&&t===this.ownerID?(this.entry[1]=n,this):new Ht(t,this.keyHash,[i,n]):(S(s),re(this,t,e,It(i),[i,n])))},Gt.prototype.iterate=$t.prototype.iterate=function(t,e){for(var r=this.entries,i=0,n=r.length-1;i<=n;i++)if(!1===t(r[e?n-i:i]))return!1},Yt.prototype.iterate=qt.prototype.iterate=function(t,e){for(var r=this.nodes,i=0,n=r.length-1;i<=n;i++){var s=r[e?n-i:i];if(s&&!1===s.iterate(t,e))return!1}},Ht.prototype.iterate=function(t,e){return t(this.entry)},e(Wt,U),Wt.prototype.next=function(){for(var t=this._type,e=this._stack;e;){var r,i=e.node,n=e.index++;if(i.entry){if(0===n)return Kt(t,i.entry)}else if(i.entries){if(n<=(r=i.entries.length-1))return Kt(t,i.entries[this._reverse?r-n:n])}else if(n<=(r=i.nodes.length-1)){var s=i.nodes[this._reverse?r-n:n];if(s){if(s.entry)return Kt(t,s.entry);e=this._stack=Xt(s,e)}continue}e=this._stack=this._stack.__prev}return{value:void 0,done:!0}};var ce=f/4,he=f/2,le=f/4;function pe(t){var e=Se();if(null==t)return e;if(de(t))return t;var r=n(t),i=r.size;return 0===i?e:(Lt(i),i>0&&i<f?ve(0,i,_,null,new fe(r.toArray())):e.withMutations((function(t){t.setSize(i),r.forEach((function(e,r){return t.set(r,e)}))})))}function de(t){return!(!t||!t[me])}e(pe,vt),pe.of=function(){return this(arguments)},pe.prototype.toString=function(){return this.__toString("List [","]")},pe.prototype.get=function(t,e){if((t=k(this,t))>=0&&t<this.size){var r=Ie(this,t+=this._origin);return r&&r.array[t&g]}return e},pe.prototype.set=function(t,e){return function(t,e,r){if((e=k(t,e))!=e)return t;if(e>=t.size||e<0)return t.withMutations((function(t){e<0?ke(t,e).set(0,r):ke(t,0,e+1).set(e,r)}));e+=t._origin;var i=t._tail,n=t._root,s=v(T);return e>=Ne(t._capacity)?i=Ee(i,t.__ownerID,0,e,r,s):n=Ee(n,t.__ownerID,t._level,e,r,s),s.value?t.__ownerID?(t._root=n,t._tail=i,t.__hash=void 0,t.__altered=!0,t):ve(t._origin,t._capacity,t._level,n,i):t}(this,t,e)},pe.prototype.remove=function(t){return this.has(t)?0===t?this.shift():t===this.size-1?this.pop():this.splice(t,1):this},pe.prototype.insert=function(t,e){return this.splice(t,0,e)},pe.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=_,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):Se()},pe.prototype.push=function(){var t=arguments,e=this.size;return this.withMutations((function(r){ke(r,0,e+t.length);for(var i=0;i<t.length;i++)r.set(e+i,t[i])}))},pe.prototype.pop=function(){return ke(this,0,-1)},pe.prototype.unshift=function(){var t=arguments;return this.withMutations((function(e){ke(e,-t.length);for(var r=0;r<t.length;r++)e.set(r,t[r])}))},pe.prototype.shift=function(){return ke(this,1)},pe.prototype.merge=function(){return we(this,void 0,arguments)},pe.prototype.mergeWith=function(e){var r=t.call(arguments,1);return we(this,e,r)},pe.prototype.mergeDeep=function(){return we(this,ne,arguments)},pe.prototype.mergeDeepWith=function(e){var r=t.call(arguments,1);return we(this,se(e),r)},pe.prototype.setSize=function(t){return ke(this,0,t)},pe.prototype.slice=function(t,e){var r=this.size;return N(t,e,r)?this:ke(this,A(t,r),x(e,r))},pe.prototype.__iterator=function(t,e){var r=0,i=Te(this,e);return new U((function(){var e=i();return e===ye?{value:void 0,done:!0}:F(t,r++,e)}))},pe.prototype.__iterate=function(t,e){for(var r,i=0,n=Te(this,e);(r=n())!==ye&&!1!==t(r,i++,this););return i},pe.prototype.__ensureOwner=function(t){return t===this.__ownerID?this:t?ve(this._origin,this._capacity,this._level,this._root,this._tail,t,this.__hash):(this.__ownerID=t,this)},pe.isList=de;var me="@@__IMMUTABLE_LIST__@@",_e=pe.prototype;function fe(t,e){this.array=t,this.ownerID=e}_e[me]=!0,_e.delete=_e.remove,_e.setIn=jt.setIn,_e.deleteIn=_e.removeIn=jt.removeIn,_e.update=jt.update,_e.updateIn=jt.updateIn,_e.mergeIn=jt.mergeIn,_e.mergeDeepIn=jt.mergeDeepIn,_e.withMutations=jt.withMutations,_e.asMutable=jt.asMutable,_e.asImmutable=jt.asImmutable,_e.wasAltered=jt.wasAltered,fe.prototype.removeBefore=function(t,e,r){if(r===e?1<<e:0===this.array.length)return this;var i=r>>>e&g;if(i>=this.array.length)return new fe([],t);var n,s=0===i;if(e>0){var o=this.array[i];if((n=o&&o.removeBefore(t,e-_,r))===o&&s)return this}if(s&&!n)return this;var a=Oe(this,t);if(!s)for(var u=0;u<i;u++)a.array[u]=void 0;return n&&(a.array[i]=n),a},fe.prototype.removeAfter=function(t,e,r){if(r===(e?1<<e:0)||0===this.array.length)return this;var i,n=r-1>>>e&g;if(n>=this.array.length)return this;if(e>0){var s=this.array[n];if((i=s&&s.removeAfter(t,e-_,r))===s&&n===this.array.length-1)return this}var o=Oe(this,t);return o.array.splice(n+1),i&&(o.array[n]=i),o};var ge,be,ye={};function Te(t,e){var r=t._origin,i=t._capacity,n=Ne(i),s=t._tail;return o(t._root,t._level,0);function o(t,a,u){return 0===a?function(t,o){var a=o===n?s&&s.array:t&&t.array,u=o>r?0:r-o,c=i-o;return c>f&&(c=f),function(){if(u===c)return ye;var t=e?--c:u++;return a&&a[t]}}(t,u):function(t,n,s){var a,u=t&&t.array,c=s>r?0:r-s>>n,h=1+(i-s>>n);return h>f&&(h=f),function(){for(;;){if(a){var t=a();if(t!==ye)return t;a=null}if(c===h)return ye;var r=e?--h:c++;a=o(u&&u[r],n-_,s+(r<<n))}}}(t,a,u)}}function ve(t,e,r,i,n,s,o){var a=Object.create(_e);return a.size=e-t,a._origin=t,a._capacity=e,a._level=r,a._root=i,a._tail=n,a.__ownerID=s,a.__hash=o,a.__altered=!1,a}function Se(){return ge||(ge=ve(0,0,_))}function Ee(t,e,r,i,n,s){var o,a=i>>>r&g,u=t&&a<t.array.length;if(!u&&void 0===n)return t;if(r>0){var c=t&&t.array[a],h=Ee(c,e,r-_,i,n,s);return h===c?t:((o=Oe(t,e)).array[a]=h,o)}return u&&t.array[a]===n?t:(S(s),o=Oe(t,e),void 0===n&&a===o.array.length-1?o.array.pop():o.array[a]=n,o)}function Oe(t,e){return e&&t&&e===t.ownerID?t:new fe(t?t.array.slice():[],e)}function Ie(t,e){if(e>=Ne(t._capacity))return t._tail;if(e<1<<t._level+_){for(var r=t._root,i=t._level;r&&i>0;)r=r.array[e>>>i&g],i-=_;return r}}function ke(t,e,r){void 0!==e&&(e|=0),void 0!==r&&(r|=0);var i=t.__ownerID||new E,n=t._origin,s=t._capacity,o=n+e,a=void 0===r?s:r<0?s+r:n+r;if(o===n&&a===s)return t;if(o>=a)return t.clear();for(var u=t._level,c=t._root,h=0;o+h<0;)c=new fe(c&&c.array.length?[void 0,c]:[],i),h+=1<<(u+=_);h&&(o+=h,n+=h,a+=h,s+=h);for(var l=Ne(s),p=Ne(a);p>=1<<u+_;)c=new fe(c&&c.array.length?[c]:[],i),u+=_;var d=t._tail,m=p<l?Ie(t,a-1):p>l?new fe([],i):d;if(d&&p>l&&o<s&&d.array.length){for(var f=c=Oe(c,i),b=u;b>_;b-=_){var y=l>>>b&g;f=f.array[y]=Oe(f.array[y],i)}f.array[l>>>_&g]=d}if(a<s&&(m=m&&m.removeAfter(i,0,a)),o>=p)o-=p,a-=p,u=_,c=null,m=m&&m.removeBefore(i,0,o);else if(o>n||p<l){for(h=0;c;){var T=o>>>u&g;if(T!==p>>>u&g)break;T&&(h+=(1<<u)*T),u-=_,c=c.array[T]}c&&o>n&&(c=c.removeBefore(i,u,o-h)),c&&p<l&&(c=c.removeAfter(i,u,p-h)),h&&(o-=h,a-=h)}return t.__ownerID?(t.size=a-o,t._origin=o,t._capacity=a,t._level=u,t._root=c,t._tail=m,t.__hash=void 0,t.__altered=!0,t):ve(o,a,u,c,m)}function we(t,e,r){for(var i=[],s=0,a=0;a<r.length;a++){var u=r[a],c=n(u);c.size>s&&(s=c.size),o(u)||(c=c.map((function(t){return lt(t)}))),i.push(c)}return s>t.size&&(t=t.setSize(s)),oe(t,e,i)}function Ne(t){return t<f?0:t-1>>>_<<_}function Ae(t){return null==t?Me():xe(t)?t:Me().withMutations((function(e){var r=i(t);Lt(r.size),r.forEach((function(t,r){return e.set(r,t)}))}))}function xe(t){return Ft(t)&&h(t)}function Ce(t,e,r,i){var n=Object.create(Ae.prototype);return n.size=t?t.size:0,n._map=t,n._list=e,n.__ownerID=r,n.__hash=i,n}function Me(){return be||(be=Ce(Qt(),Se()))}function Pe(t,e,r){var i,n,s=t._map,o=t._list,a=s.get(e),u=void 0!==a;if(r===b){if(!u)return t;o.size>=f&&o.size>=2*s.size?(i=(n=o.filter((function(t,e){return void 0!==t&&a!==e}))).toKeyedSeq().map((function(t){return t[0]})).flip().toMap(),t.__ownerID&&(i.__ownerID=n.__ownerID=t.__ownerID)):(i=s.remove(e),n=a===o.size-1?o.pop():o.set(a,void 0))}else if(u){if(r===o.get(a)[1])return t;i=s,n=o.set(a,[e,r])}else i=s.set(e,o.size),n=o.set(o.size,[e,r]);return t.__ownerID?(t.size=i.size,t._map=i,t._list=n,t.__hash=void 0,t):Ce(i,n)}function Re(t,e){this._iter=t,this._useKeys=e,this.size=t.size}function De(t){this._iter=t,this.size=t.size}function Be(t){this._iter=t,this.size=t.size}function Le(t){this._iter=t,this.size=t.size}function Ue(t){var e=tr(t);return e._iter=t,e.size=t.size,e.flip=function(){return t},e.reverse=function(){var e=t.reverse.apply(this);return e.flip=function(){return t.reverse()},e},e.has=function(e){return t.includes(e)},e.includes=function(e){return t.has(e)},e.cacheResult=er,e.__iterateUncached=function(e,r){var i=this;return t.__iterate((function(t,r){return!1!==e(r,t,i)}),r)},e.__iteratorUncached=function(e,r){if(e===R){var i=t.__iterator(e,r);return new U((function(){var t=i.next();if(!t.done){var e=t.value[0];t.value[0]=t.value[1],t.value[1]=e}return t}))}return t.__iterator(e===P?M:P,r)},e}function Fe(t,e,r){var i=tr(t);return i.size=t.size,i.has=function(e){return t.has(e)},i.get=function(i,n){var s=t.get(i,b);return s===b?n:e.call(r,s,i,t)},i.__iterateUncached=function(i,n){var s=this;return t.__iterate((function(t,n,o){return!1!==i(e.call(r,t,n,o),n,s)}),n)},i.__iteratorUncached=function(i,n){var s=t.__iterator(R,n);return new U((function(){var n=s.next();if(n.done)return n;var o=n.value,a=o[0];return F(i,a,e.call(r,o[1],a,t),n)}))},i}function Ve(t,e){var r=tr(t);return r._iter=t,r.size=t.size,r.reverse=function(){return t},t.flip&&(r.flip=function(){var e=Ue(t);return e.reverse=function(){return t.flip()},e}),r.get=function(r,i){return t.get(e?r:-1-r,i)},r.has=function(r){return t.has(e?r:-1-r)},r.includes=function(e){return t.includes(e)},r.cacheResult=er,r.__iterate=function(e,r){var i=this;return t.__iterate((function(t,r){return e(t,r,i)}),!r)},r.__iterator=function(e,r){return t.__iterator(e,!r)},r}function ze(t,e,r,i){var n=tr(t);return i&&(n.has=function(i){var n=t.get(i,b);return n!==b&&!!e.call(r,n,i,t)},n.get=function(i,n){var s=t.get(i,b);return s!==b&&e.call(r,s,i,t)?s:n}),n.__iterateUncached=function(n,s){var o=this,a=0;return t.__iterate((function(t,s,u){if(e.call(r,t,s,u))return a++,n(t,i?s:a-1,o)}),s),a},n.__iteratorUncached=function(n,s){var o=t.__iterator(R,s),a=0;return new U((function(){for(;;){var s=o.next();if(s.done)return s;var u=s.value,c=u[0],h=u[1];if(e.call(r,h,c,t))return F(n,i?c:a++,h,s)}}))},n}function je(t,e,r,i){var n=t.size;if(void 0!==e&&(e|=0),void 0!==r&&(r===1/0?r=n:r|=0),N(e,r,n))return t;var s=A(e,n),o=x(r,n);if(s!=s||o!=o)return je(t.toSeq().cacheResult(),e,r,i);var a,u=o-s;u==u&&(a=u<0?0:u);var c=tr(t);return c.size=0===a?a:t.size&&a||void 0,!i&&nt(t)&&a>=0&&(c.get=function(e,r){return(e=k(this,e))>=0&&e<a?t.get(e+s,r):r}),c.__iterateUncached=function(e,r){var n=this;if(0===a)return 0;if(r)return this.cacheResult().__iterate(e,r);var o=0,u=!0,c=0;return t.__iterate((function(t,r){if(!u||!(u=o++<s))return c++,!1!==e(t,i?r:c-1,n)&&c!==a})),c},c.__iteratorUncached=function(e,r){if(0!==a&&r)return this.cacheResult().__iterator(e,r);var n=0!==a&&t.__iterator(e,r),o=0,u=0;return new U((function(){for(;o++<s;)n.next();if(++u>a)return{value:void 0,done:!0};var t=n.next();return i||e===P?t:F(e,u-1,e===M?void 0:t.value[1],t)}))},c}function Ge(t,e,r,i){var n=tr(t);return n.__iterateUncached=function(n,s){var o=this;if(s)return this.cacheResult().__iterate(n,s);var a=!0,u=0;return t.__iterate((function(t,s,c){if(!a||!(a=e.call(r,t,s,c)))return u++,n(t,i?s:u-1,o)})),u},n.__iteratorUncached=function(n,s){var o=this;if(s)return this.cacheResult().__iterator(n,s);var a=t.__iterator(R,s),u=!0,c=0;return new U((function(){var t,s,h;do{if((t=a.next()).done)return i||n===P?t:F(n,c++,n===M?void 0:t.value[1],t);var l=t.value;s=l[0],h=l[1],u&&(u=e.call(r,h,s,o))}while(u);return n===R?t:F(n,s,h,t)}))},n}function Ye(t,e){var r=a(t),n=[t].concat(e).map((function(t){return o(t)?r&&(t=i(t)):t=r?ot(t):at(Array.isArray(t)?t:[t]),t})).filter((function(t){return 0!==t.size}));if(0===n.length)return t;if(1===n.length){var s=n[0];if(s===t||r&&a(s)||u(t)&&u(s))return s}var c=new tt(n);return r?c=c.toKeyedSeq():u(t)||(c=c.toSetSeq()),(c=c.flatten(!0)).size=n.reduce((function(t,e){if(void 0!==t){var r=e.size;if(void 0!==r)return t+r}}),0),c}function qe(t,e,r){var i=tr(t);return i.__iterateUncached=function(i,n){var s=0,a=!1;return function t(u,c){var h=this;u.__iterate((function(n,u){return(!e||c<e)&&o(n)?t(n,c+1):!1===i(n,r?u:s++,h)&&(a=!0),!a}),n)}(t,0),s},i.__iteratorUncached=function(i,n){var s=t.__iterator(i,n),a=[],u=0;return new U((function(){for(;s;){var t=s.next();if(!1===t.done){var c=t.value;if(i===R&&(c=c[1]),e&&!(a.length<e)||!o(c))return r?t:F(i,u++,c,t);a.push(s),s=c.__iterator(i,n)}else s=a.pop()}return{value:void 0,done:!0}}))},i}function $e(t,e,r){e||(e=rr);var i=a(t),n=0,s=t.toSeq().map((function(e,i){return[i,e,n++,r?r(e,i,t):e]})).toArray();return s.sort((function(t,r){return e(t[3],r[3])||t[2]-r[2]})).forEach(i?function(t,e){s[e].length=2}:function(t,e){s[e]=t[1]}),i?H(s):u(t)?W(s):K(s)}function He(t,e,r){if(e||(e=rr),r){var i=t.toSeq().map((function(e,i){return[e,r(e,i,t)]})).reduce((function(t,r){return We(e,t[1],r[1])?r:t}));return i&&i[0]}return t.reduce((function(t,r){return We(e,t,r)?r:t}))}function We(t,e,r){var i=t(r,e);return 0===i&&r!==e&&(null==r||r!=r)||i>0}function Ke(t,e,i){var n=tr(t);return n.size=new tt(i).map((function(t){return t.size})).min(),n.__iterate=function(t,e){for(var r,i=this.__iterator(P,e),n=0;!(r=i.next()).done&&!1!==t(r.value,n++,this););return n},n.__iteratorUncached=function(t,n){var s=i.map((function(t){return t=r(t),G(n?t.reverse():t)})),o=0,a=!1;return new U((function(){var r;return a||(r=s.map((function(t){return t.next()})),a=r.some((function(t){return t.done}))),a?{value:void 0,done:!0}:F(t,o++,e.apply(null,r.map((function(t){return t.value}))))}))},n}function Xe(t,e){return nt(t)?e:t.constructor(e)}function Je(t){if(t!==Object(t))throw new TypeError("Expected [K, V] tuple: "+t)}function Qe(t){return Lt(t.size),I(t)}function Ze(t){return a(t)?i:u(t)?n:s}function tr(t){return Object.create((a(t)?H:u(t)?W:K).prototype)}function er(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):$.prototype.cacheResult.call(this)}function rr(t,e){return t>e?1:t<e?-1:0}function ir(t){var e=G(t);if(!e){if(!q(t))throw new TypeError("Expected iterable or array-like: "+t);e=G(r(t))}return e}function nr(t,e){var r,i=function(s){if(s instanceof i)return s;if(!(this instanceof i))return new i(s);if(!r){r=!0;var o=Object.keys(t);!function(t,e){try{e.forEach(ur.bind(void 0,t))}catch(t){}}(n,o),n.size=o.length,n._name=e,n._keys=o,n._defaultValues=t}this._map=Ut(s)},n=i.prototype=Object.create(sr);return n.constructor=i,i}e(Ae,Ut),Ae.of=function(){return this(arguments)},Ae.prototype.toString=function(){return this.__toString("OrderedMap {","}")},Ae.prototype.get=function(t,e){var r=this._map.get(t);return void 0!==r?this._list.get(r)[1]:e},Ae.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):Me()},Ae.prototype.set=function(t,e){return Pe(this,t,e)},Ae.prototype.remove=function(t){return Pe(this,t,b)},Ae.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},Ae.prototype.__iterate=function(t,e){var r=this;return this._list.__iterate((function(e){return e&&t(e[1],e[0],r)}),e)},Ae.prototype.__iterator=function(t,e){return this._list.fromEntrySeq().__iterator(t,e)},Ae.prototype.__ensureOwner=function(t){if(t===this.__ownerID)return this;var e=this._map.__ensureOwner(t),r=this._list.__ensureOwner(t);return t?Ce(e,r,t,this.__hash):(this.__ownerID=t,this._map=e,this._list=r,this)},Ae.isOrderedMap=xe,Ae.prototype[m]=!0,Ae.prototype.delete=Ae.prototype.remove,e(Re,H),Re.prototype.get=function(t,e){return this._iter.get(t,e)},Re.prototype.has=function(t){return this._iter.has(t)},Re.prototype.valueSeq=function(){return this._iter.valueSeq()},Re.prototype.reverse=function(){var t=this,e=Ve(this,!0);return this._useKeys||(e.valueSeq=function(){return t._iter.toSeq().reverse()}),e},Re.prototype.map=function(t,e){var r=this,i=Fe(this,t,e);return this._useKeys||(i.valueSeq=function(){return r._iter.toSeq().map(t,e)}),i},Re.prototype.__iterate=function(t,e){var r,i=this;return this._iter.__iterate(this._useKeys?function(e,r){return t(e,r,i)}:(r=e?Qe(this):0,function(n){return t(n,e?--r:r++,i)}),e)},Re.prototype.__iterator=function(t,e){if(this._useKeys)return this._iter.__iterator(t,e);var r=this._iter.__iterator(P,e),i=e?Qe(this):0;return new U((function(){var n=r.next();return n.done?n:F(t,e?--i:i++,n.value,n)}))},Re.prototype[m]=!0,e(De,W),De.prototype.includes=function(t){return this._iter.includes(t)},De.prototype.__iterate=function(t,e){var r=this,i=0;return this._iter.__iterate((function(e){return t(e,i++,r)}),e)},De.prototype.__iterator=function(t,e){var r=this._iter.__iterator(P,e),i=0;return new U((function(){var e=r.next();return e.done?e:F(t,i++,e.value,e)}))},e(Be,K),Be.prototype.has=function(t){return this._iter.includes(t)},Be.prototype.__iterate=function(t,e){var r=this;return this._iter.__iterate((function(e){return t(e,e,r)}),e)},Be.prototype.__iterator=function(t,e){var r=this._iter.__iterator(P,e);return new U((function(){var e=r.next();return e.done?e:F(t,e.value,e.value,e)}))},e(Le,H),Le.prototype.entrySeq=function(){return this._iter.toSeq()},Le.prototype.__iterate=function(t,e){var r=this;return this._iter.__iterate((function(e){if(e){Je(e);var i=o(e);return t(i?e.get(1):e[1],i?e.get(0):e[0],r)}}),e)},Le.prototype.__iterator=function(t,e){var r=this._iter.__iterator(P,e);return new U((function(){for(;;){var e=r.next();if(e.done)return e;var i=e.value;if(i){Je(i);var n=o(i);return F(t,n?i.get(0):i[0],n?i.get(1):i[1],e)}}}))},De.prototype.cacheResult=Re.prototype.cacheResult=Be.prototype.cacheResult=Le.prototype.cacheResult=er,e(nr,Tt),nr.prototype.toString=function(){return this.__toString(ar(this)+" {","}")},nr.prototype.has=function(t){return this._defaultValues.hasOwnProperty(t)},nr.prototype.get=function(t,e){if(!this.has(t))return e;var r=this._defaultValues[t];return this._map?this._map.get(t,r):r},nr.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var t=this.constructor;return t._empty||(t._empty=or(this,Qt()))},nr.prototype.set=function(t,e){if(!this.has(t))throw new Error('Cannot set unknown key "'+t+'" on '+ar(this));if(this._map&&!this._map.has(t)&&e===this._defaultValues[t])return this;var r=this._map&&this._map.set(t,e);return this.__ownerID||r===this._map?this:or(this,r)},nr.prototype.remove=function(t){if(!this.has(t))return this;var e=this._map&&this._map.remove(t);return this.__ownerID||e===this._map?this:or(this,e)},nr.prototype.wasAltered=function(){return this._map.wasAltered()},nr.prototype.__iterator=function(t,e){var r=this;return i(this._defaultValues).map((function(t,e){return r.get(e)})).__iterator(t,e)},nr.prototype.__iterate=function(t,e){var r=this;return i(this._defaultValues).map((function(t,e){return r.get(e)})).__iterate(t,e)},nr.prototype.__ensureOwner=function(t){if(t===this.__ownerID)return this;var e=this._map&&this._map.__ensureOwner(t);return t?or(this,e,t):(this.__ownerID=t,this._map=e,this)};var sr=nr.prototype;function or(t,e,r){var i=Object.create(Object.getPrototypeOf(t));return i._map=e,i.__ownerID=r,i}function ar(t){return t._name||t.constructor.name||"Record"}function ur(t,e){Object.defineProperty(t,e,{get:function(){return this.get(e)},set:function(t){gt(this.__ownerID,"Cannot set on an immutable record."),this.set(e,t)}})}function cr(t){return null==t?fr():hr(t)&&!h(t)?t:fr().withMutations((function(e){var r=s(t);Lt(r.size),r.forEach((function(t){return e.add(t)}))}))}function hr(t){return!(!t||!t[pr])}sr.delete=sr.remove,sr.deleteIn=sr.removeIn=jt.removeIn,sr.merge=jt.merge,sr.mergeWith=jt.mergeWith,sr.mergeIn=jt.mergeIn,sr.mergeDeep=jt.mergeDeep,sr.mergeDeepWith=jt.mergeDeepWith,sr.mergeDeepIn=jt.mergeDeepIn,sr.setIn=jt.setIn,sr.update=jt.update,sr.updateIn=jt.updateIn,sr.withMutations=jt.withMutations,sr.asMutable=jt.asMutable,sr.asImmutable=jt.asImmutable,e(cr,St),cr.of=function(){return this(arguments)},cr.fromKeys=function(t){return this(i(t).keySeq())},cr.prototype.toString=function(){return this.__toString("Set {","}")},cr.prototype.has=function(t){return this._map.has(t)},cr.prototype.add=function(t){return mr(this,this._map.set(t,!0))},cr.prototype.remove=function(t){return mr(this,this._map.remove(t))},cr.prototype.clear=function(){return mr(this,this._map.clear())},cr.prototype.union=function(){var e=t.call(arguments,0);return 0===(e=e.filter((function(t){return 0!==t.size}))).length?this:0!==this.size||this.__ownerID||1!==e.length?this.withMutations((function(t){for(var r=0;r<e.length;r++)s(e[r]).forEach((function(e){return t.add(e)}))})):this.constructor(e[0])},cr.prototype.intersect=function(){var e=t.call(arguments,0);if(0===e.length)return this;e=e.map((function(t){return s(t)}));var r=this;return this.withMutations((function(t){r.forEach((function(r){e.every((function(t){return t.includes(r)}))||t.remove(r)}))}))},cr.prototype.subtract=function(){var e=t.call(arguments,0);if(0===e.length)return this;e=e.map((function(t){return s(t)}));var r=this;return this.withMutations((function(t){r.forEach((function(r){e.some((function(t){return t.includes(r)}))&&t.remove(r)}))}))},cr.prototype.merge=function(){return this.union.apply(this,arguments)},cr.prototype.mergeWith=function(e){var r=t.call(arguments,1);return this.union.apply(this,r)},cr.prototype.sort=function(t){return gr($e(this,t))},cr.prototype.sortBy=function(t,e){return gr($e(this,e,t))},cr.prototype.wasAltered=function(){return this._map.wasAltered()},cr.prototype.__iterate=function(t,e){var r=this;return this._map.__iterate((function(e,i){return t(i,i,r)}),e)},cr.prototype.__iterator=function(t,e){return this._map.map((function(t,e){return e})).__iterator(t,e)},cr.prototype.__ensureOwner=function(t){if(t===this.__ownerID)return this;var e=this._map.__ensureOwner(t);return t?this.__make(e,t):(this.__ownerID=t,this._map=e,this)},cr.isSet=hr;var lr,pr="@@__IMMUTABLE_SET__@@",dr=cr.prototype;function mr(t,e){return t.__ownerID?(t.size=e.size,t._map=e,t):e===t._map?t:0===e.size?t.__empty():t.__make(e)}function _r(t,e){var r=Object.create(dr);return r.size=t?t.size:0,r._map=t,r.__ownerID=e,r}function fr(){return lr||(lr=_r(Qt()))}function gr(t){return null==t?Sr():br(t)?t:Sr().withMutations((function(e){var r=s(t);Lt(r.size),r.forEach((function(t){return e.add(t)}))}))}function br(t){return hr(t)&&h(t)}dr[pr]=!0,dr.delete=dr.remove,dr.mergeDeep=dr.merge,dr.mergeDeepWith=dr.mergeWith,dr.withMutations=jt.withMutations,dr.asMutable=jt.asMutable,dr.asImmutable=jt.asImmutable,dr.__empty=fr,dr.__make=_r,e(gr,cr),gr.of=function(){return this(arguments)},gr.fromKeys=function(t){return this(i(t).keySeq())},gr.prototype.toString=function(){return this.__toString("OrderedSet {","}")},gr.isOrderedSet=br;var yr,Tr=gr.prototype;function vr(t,e){var r=Object.create(Tr);return r.size=t?t.size:0,r._map=t,r.__ownerID=e,r}function Sr(){return yr||(yr=vr(Me()))}function Er(t){return null==t?Ar():Or(t)?t:Ar().unshiftAll(t)}function Or(t){return!(!t||!t[kr])}Tr[m]=!0,Tr.__empty=Sr,Tr.__make=vr,e(Er,vt),Er.of=function(){return this(arguments)},Er.prototype.toString=function(){return this.__toString("Stack [","]")},Er.prototype.get=function(t,e){var r=this._head;for(t=k(this,t);r&&t--;)r=r.next;return r?r.value:e},Er.prototype.peek=function(){return this._head&&this._head.value},Er.prototype.push=function(){if(0===arguments.length)return this;for(var t=this.size+arguments.length,e=this._head,r=arguments.length-1;r>=0;r--)e={value:arguments[r],next:e};return this.__ownerID?(this.size=t,this._head=e,this.__hash=void 0,this.__altered=!0,this):Nr(t,e)},Er.prototype.pushAll=function(t){if(0===(t=n(t)).size)return this;Lt(t.size);var e=this.size,r=this._head;return t.reverse().forEach((function(t){e++,r={value:t,next:r}})),this.__ownerID?(this.size=e,this._head=r,this.__hash=void 0,this.__altered=!0,this):Nr(e,r)},Er.prototype.pop=function(){return this.slice(1)},Er.prototype.unshift=function(){return this.push.apply(this,arguments)},Er.prototype.unshiftAll=function(t){return this.pushAll(t)},Er.prototype.shift=function(){return this.pop.apply(this,arguments)},Er.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):Ar()},Er.prototype.slice=function(t,e){if(N(t,e,this.size))return this;var r=A(t,this.size);if(x(e,this.size)!==this.size)return vt.prototype.slice.call(this,t,e);for(var i=this.size-r,n=this._head;r--;)n=n.next;return this.__ownerID?(this.size=i,this._head=n,this.__hash=void 0,this.__altered=!0,this):Nr(i,n)},Er.prototype.__ensureOwner=function(t){return t===this.__ownerID?this:t?Nr(this.size,this._head,t,this.__hash):(this.__ownerID=t,this.__altered=!1,this)},Er.prototype.__iterate=function(t,e){if(e)return this.reverse().__iterate(t);for(var r=0,i=this._head;i&&!1!==t(i.value,r++,this);)i=i.next;return r},Er.prototype.__iterator=function(t,e){if(e)return this.reverse().__iterator(t);var r=0,i=this._head;return new U((function(){if(i){var e=i.value;return i=i.next,F(t,r++,e)}return{value:void 0,done:!0}}))},Er.isStack=Or;var Ir,kr="@@__IMMUTABLE_STACK__@@",wr=Er.prototype;function Nr(t,e,r,i){var n=Object.create(wr);return n.size=t,n._head=e,n.__ownerID=r,n.__hash=i,n.__altered=!1,n}function Ar(){return Ir||(Ir=Nr(0))}function xr(t,e){var r=function(r){t.prototype[r]=e[r]};return Object.keys(e).forEach(r),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(e).forEach(r),t}wr[kr]=!0,wr.withMutations=jt.withMutations,wr.asMutable=jt.asMutable,wr.asImmutable=jt.asImmutable,wr.wasAltered=jt.wasAltered,r.Iterator=U,xr(r,{toArray:function(){Lt(this.size);var t=new Array(this.size||0);return this.valueSeq().__iterate((function(e,r){t[r]=e})),t},toIndexedSeq:function(){return new De(this)},toJS:function(){return this.toSeq().map((function(t){return t&&"function"==typeof t.toJS?t.toJS():t})).__toJS()},toJSON:function(){return this.toSeq().map((function(t){return t&&"function"==typeof t.toJSON?t.toJSON():t})).__toJS()},toKeyedSeq:function(){return new Re(this,!0)},toMap:function(){return Ut(this.toKeyedSeq())},toObject:function(){Lt(this.size);var t={};return this.__iterate((function(e,r){t[r]=e})),t},toOrderedMap:function(){return Ae(this.toKeyedSeq())},toOrderedSet:function(){return gr(a(this)?this.valueSeq():this)},toSet:function(){return cr(a(this)?this.valueSeq():this)},toSetSeq:function(){return new Be(this)},toSeq:function(){return u(this)?this.toIndexedSeq():a(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Er(a(this)?this.valueSeq():this)},toList:function(){return pe(a(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(t,e){return 0===this.size?t+e:t+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+e},concat:function(){var e=t.call(arguments,0);return Xe(this,Ye(this,e))},includes:function(t){return this.some((function(e){return mt(e,t)}))},entries:function(){return this.__iterator(R)},every:function(t,e){Lt(this.size);var r=!0;return this.__iterate((function(i,n,s){if(!t.call(e,i,n,s))return r=!1,!1})),r},filter:function(t,e){return Xe(this,ze(this,t,e,!0))},find:function(t,e,r){var i=this.findEntry(t,e);return i?i[1]:r},forEach:function(t,e){return Lt(this.size),this.__iterate(e?t.bind(e):t)},join:function(t){Lt(this.size),t=void 0!==t?""+t:",";var e="",r=!0;return this.__iterate((function(i){r?r=!1:e+=t,e+=null!=i?i.toString():""})),e},keys:function(){return this.__iterator(M)},map:function(t,e){return Xe(this,Fe(this,t,e))},reduce:function(t,e,r){var i,n;return Lt(this.size),arguments.length<2?n=!0:i=e,this.__iterate((function(e,s,o){n?(n=!1,i=e):i=t.call(r,i,e,s,o)})),i},reduceRight:function(t,e,r){var i=this.toKeyedSeq().reverse();return i.reduce.apply(i,arguments)},reverse:function(){return Xe(this,Ve(this,!0))},slice:function(t,e){return Xe(this,je(this,t,e,!0))},some:function(t,e){return!this.every(Dr(t),e)},sort:function(t){return Xe(this,$e(this,t))},values:function(){return this.__iterator(P)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return void 0!==this.size?0===this.size:!this.some((function(){return!0}))},count:function(t,e){return I(t?this.toSeq().filter(t,e):this)},countBy:function(t,e){return function(t,e,r){var i=Ut().asMutable();return t.__iterate((function(n,s){i.update(e.call(r,n,s,t),0,(function(t){return t+1}))})),i.asImmutable()}(this,t,e)},equals:function(t){return _t(this,t)},entrySeq:function(){var t=this;if(t._cache)return new tt(t._cache);var e=t.toSeq().map(Rr).toIndexedSeq();return e.fromEntrySeq=function(){return t.toSeq()},e},filterNot:function(t,e){return this.filter(Dr(t),e)},findEntry:function(t,e,r){var i=r;return this.__iterate((function(r,n,s){if(t.call(e,r,n,s))return i=[n,r],!1})),i},findKey:function(t,e){var r=this.findEntry(t,e);return r&&r[0]},findLast:function(t,e,r){return this.toKeyedSeq().reverse().find(t,e,r)},findLastEntry:function(t,e,r){return this.toKeyedSeq().reverse().findEntry(t,e,r)},findLastKey:function(t,e){return this.toKeyedSeq().reverse().findKey(t,e)},first:function(){return this.find(w)},flatMap:function(t,e){return Xe(this,function(t,e,r){var i=Ze(t);return t.toSeq().map((function(n,s){return i(e.call(r,n,s,t))})).flatten(!0)}(this,t,e))},flatten:function(t){return Xe(this,qe(this,t,!0))},fromEntrySeq:function(){return new Le(this)},get:function(t,e){return this.find((function(e,r){return mt(r,t)}),void 0,e)},getIn:function(t,e){for(var r,i=this,n=ir(t);!(r=n.next()).done;){var s=r.value;if((i=i&&i.get?i.get(s,b):b)===b)return e}return i},groupBy:function(t,e){return function(t,e,r){var i=a(t),n=(h(t)?Ae():Ut()).asMutable();t.__iterate((function(s,o){n.update(e.call(r,s,o,t),(function(t){return(t=t||[]).push(i?[o,s]:s),t}))}));var s=Ze(t);return n.map((function(e){return Xe(t,s(e))}))}(this,t,e)},has:function(t){return this.get(t,b)!==b},hasIn:function(t){return this.getIn(t,b)!==b},isSubset:function(t){return t="function"==typeof t.includes?t:r(t),this.every((function(e){return t.includes(e)}))},isSuperset:function(t){return(t="function"==typeof t.isSubset?t:r(t)).isSubset(this)},keyOf:function(t){return this.findKey((function(e){return mt(e,t)}))},keySeq:function(){return this.toSeq().map(Pr).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},lastKeyOf:function(t){return this.toKeyedSeq().reverse().keyOf(t)},max:function(t){return He(this,t)},maxBy:function(t,e){return He(this,e,t)},min:function(t){return He(this,t?Br(t):Fr)},minBy:function(t,e){return He(this,e?Br(e):Fr,t)},rest:function(){return this.slice(1)},skip:function(t){return this.slice(Math.max(0,t))},skipLast:function(t){return Xe(this,this.toSeq().reverse().skip(t).reverse())},skipWhile:function(t,e){return Xe(this,Ge(this,t,e,!0))},skipUntil:function(t,e){return this.skipWhile(Dr(t),e)},sortBy:function(t,e){return Xe(this,$e(this,e,t))},take:function(t){return this.slice(0,Math.max(0,t))},takeLast:function(t){return Xe(this,this.toSeq().reverse().take(t).reverse())},takeWhile:function(t,e){return Xe(this,function(t,e,r){var i=tr(t);return i.__iterateUncached=function(i,n){var s=this;if(n)return this.cacheResult().__iterate(i,n);var o=0;return t.__iterate((function(t,n,a){return e.call(r,t,n,a)&&++o&&i(t,n,s)})),o},i.__iteratorUncached=function(i,n){var s=this;if(n)return this.cacheResult().__iterator(i,n);var o=t.__iterator(R,n),a=!0;return new U((function(){if(!a)return{value:void 0,done:!0};var t=o.next();if(t.done)return t;var n=t.value,u=n[0],c=n[1];return e.call(r,c,u,s)?i===R?t:F(i,u,c,t):(a=!1,{value:void 0,done:!0})}))},i}(this,t,e))},takeUntil:function(t,e){return this.takeWhile(Dr(t),e)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=function(t){if(t.size===1/0)return 0;var e=h(t),r=a(t),i=e?1:0;return function(t,e){return e=Et(e,3432918353),e=Et(e<<15|e>>>-15,461845907),e=Et(e<<13|e>>>-13,5),e=Et((e=(e+3864292196|0)^t)^e>>>16,2246822507),e=Ot((e=Et(e^e>>>13,3266489909))^e>>>16)}(t.__iterate(r?e?function(t,e){i=31*i+Vr(It(t),It(e))|0}:function(t,e){i=i+Vr(It(t),It(e))|0}:e?function(t){i=31*i+It(t)|0}:function(t){i=i+It(t)|0}),i)}(this))}});var Cr=r.prototype;Cr[l]=!0,Cr[L]=Cr.values,Cr.__toJS=Cr.toArray,Cr.__toStringMapper=Lr,Cr.inspect=Cr.toSource=function(){return this.toString()},Cr.chain=Cr.flatMap,Cr.contains=Cr.includes,xr(i,{flip:function(){return Xe(this,Ue(this))},mapEntries:function(t,e){var r=this,i=0;return Xe(this,this.toSeq().map((function(n,s){return t.call(e,[s,n],i++,r)})).fromEntrySeq())},mapKeys:function(t,e){var r=this;return Xe(this,this.toSeq().flip().map((function(i,n){return t.call(e,i,n,r)})).flip())}});var Mr=i.prototype;function Pr(t,e){return e}function Rr(t,e){return[e,t]}function Dr(t){return function(){return!t.apply(this,arguments)}}function Br(t){return function(){return-t.apply(this,arguments)}}function Lr(t){return"string"==typeof t?JSON.stringify(t):String(t)}function Ur(){return O(arguments)}function Fr(t,e){return t<e?1:t>e?-1:0}function Vr(t,e){return t^e+2654435769+(t<<6)+(t>>2)|0}return Mr[p]=!0,Mr[L]=Cr.entries,Mr.__toJS=Cr.toObject,Mr.__toStringMapper=function(t,e){return JSON.stringify(e)+": "+Lr(t)},xr(n,{toKeyedSeq:function(){return new Re(this,!1)},filter:function(t,e){return Xe(this,ze(this,t,e,!1))},findIndex:function(t,e){var r=this.findEntry(t,e);return r?r[0]:-1},indexOf:function(t){var e=this.keyOf(t);return void 0===e?-1:e},lastIndexOf:function(t){var e=this.lastKeyOf(t);return void 0===e?-1:e},reverse:function(){return Xe(this,Ve(this,!1))},slice:function(t,e){return Xe(this,je(this,t,e,!1))},splice:function(t,e){var r=arguments.length;if(e=Math.max(0|e,0),0===r||2===r&&!e)return this;t=A(t,t<0?this.count():this.size);var i=this.slice(0,t);return Xe(this,1===r?i:i.concat(O(arguments,2),this.slice(t+e)))},findLastIndex:function(t,e){var r=this.findLastEntry(t,e);return r?r[0]:-1},first:function(){return this.get(0)},flatten:function(t){return Xe(this,qe(this,t,!1))},get:function(t,e){return(t=k(this,t))<0||this.size===1/0||void 0!==this.size&&t>this.size?e:this.find((function(e,r){return r===t}),void 0,e)},has:function(t){return(t=k(this,t))>=0&&(void 0!==this.size?this.size===1/0||t<this.size:-1!==this.indexOf(t))},interpose:function(t){return Xe(this,function(t,e){var r=tr(t);return r.size=t.size&&2*t.size-1,r.__iterateUncached=function(r,i){var n=this,s=0;return t.__iterate((function(t,i){return(!s||!1!==r(e,s++,n))&&!1!==r(t,s++,n)}),i),s},r.__iteratorUncached=function(r,i){var n,s=t.__iterator(P,i),o=0;return new U((function(){return(!n||o%2)&&(n=s.next()).done?n:o%2?F(r,o++,e):F(r,o++,n.value,n)}))},r}(this,t))},interleave:function(){var t=[this].concat(O(arguments)),e=Ke(this.toSeq(),W.of,t),r=e.flatten(!0);return e.size&&(r.size=e.size*t.length),Xe(this,r)},keySeq:function(){return bt(0,this.size)},last:function(){return this.get(-1)},skipWhile:function(t,e){return Xe(this,Ge(this,t,e,!1))},zip:function(){var t=[this].concat(O(arguments));return Xe(this,Ke(this,Ur,t))},zipWith:function(t){var e=O(arguments);return e[0]=this,Xe(this,Ke(this,t,e))}}),n.prototype[d]=!0,n.prototype[m]=!0,xr(s,{get:function(t,e){return this.has(t)?t:e},includes:function(t){return this.has(t)},keySeq:function(){return this.valueSeq()}}),s.prototype.has=Cr.includes,s.prototype.contains=s.prototype.includes,xr(H,i.prototype),xr(W,n.prototype),xr(K,s.prototype),xr(Tt,i.prototype),xr(vt,n.prototype),xr(St,s.prototype),{Iterable:r,Seq:$,Collection:yt,Map:Ut,OrderedMap:Ae,List:pe,Stack:Er,Set:cr,OrderedSet:gr,Record:nr,Range:bt,Repeat:ft,is:mt,fromJS:lt}}()},179:function(t,e,r){const i=r(1020),n=r(135),s=r(486),o=r(123),a=r(294),u=r(291),c=r(136),h=r(59),l=r(98),p=r(109),d=r(110),m=r(459),{loadCostume:_}=r(210),{loadSound:f}=r(211),{deserializeCostume:g,deserializeSound:b}=r(487),y=Object.prototype.hasOwnProperty,T=["argument","colour","control","data","event","looks","math","motion","operator","procedures","sensing","sound"],v=12,S=13,E={math_number:[4,"NUM"],math_positive_number:[5,"NUM"],math_whole_number:[6,"NUM"],math_integer:[7,"NUM"],math_angle:[8,"NUM"],colour_picker:[9,"COLOUR"],text:[10,"TEXT"],event_broadcast_menu:[11,"BROADCAST_OPTION"],data_variable:[v,"VARIABLE"],data_listcontents:[S,"LIST"]},O=function(t){const e=function(t){if(y.call(E,t.opcode)){const e=E[t.opcode],r=e[0],i=e[1],n=t.fields[i],s=[r,n.value];return"event_broadcast_menu"===t.opcode?s.push(n.id):"data_variable"!==t.opcode&&"data_listcontents"!==t.opcode||(s.push(n.id),t.topLevel&&(s.push(t.x?Math.round(t.x):0),s.push(t.y?Math.round(t.y):0))),s}return null}(t);if(e)return e;const r=Object.create(null);return r.opcode=t.opcode,r.next=t.next,r.parent=t.parent,r.inputs=function(t){const e=Object.create(null);for(const r in t)y.call(t,r)&&(t[r].block===t[r].shadow?e[r]=[1,t[r].block]:null===t[r].shadow?e[r]=[2,t[r].block]:e[r]=[3,t[r].block,t[r].shadow]);return e}(t.inputs),r.fields=function(t){const e=Object.create(null);for(const r in t)y.call(t,r)&&(e[r]=[t[r].value],t[r].hasOwnProperty("id")&&e[r].push(t[r].id));return e}(t.fields),r.shadow=t.shadow,t.topLevel?(r.topLevel=!0,r.x=t.x?Math.round(t.x):0,r.y=t.y?Math.round(t.y):0):r.topLevel=!1,t.mutation&&(r.mutation=t.mutation),t.comment&&(r.comment=t.comment),r},I=function(t,e){const r=t.inputs;for(const t in r){const i=r[t];for(let t=1;t<i.length;t++){if(!i[t])continue;const r=i[t],n=e[r];Array.isArray(n)&&(i[t]=n,delete e[r])}}return t},k=function(t){const e=t.indexOf("_"),r=t.substring(0,e);if(-1===T.indexOf(r)&&""!==r)return r},w=function(t){const e=Object.create(null),r=new Set;for(const i in t){if(!t.hasOwnProperty(i))continue;e[i]=O(t[i]);const n=k(t[i].opcode);n&&r.add(n)}for(const t in e){const r=e[t];e[t]=I(r,e)}for(const t in e){const r=e[t];Array.isArray(r)&&[v,S].indexOf(r[0])<0&&(h.warn(`Found an unexpected top level primitive with block ID: ${t}; deleting it from serialized blocks.`),delete e[t])}return[e,Array.from(r)]},N=function(t){const e=Object.create(null);return e.assetId=t.assetId,e.name=t.name,e.bitmapResolution=t.bitmapResolution,e.md5ext=t.md5,e.dataFormat=t.dataFormat.toLowerCase(),e.rotationCenterX=t.rotationCenterX,e.rotationCenterY=t.rotationCenterY,e},A=function(t){const e=Object.create(null);return e.assetId=t.assetId,e.name=t.name,e.dataFormat=t.dataFormat.toLowerCase(),e.format=t.format,e.rate=t.rate,e.sampleCount=t.sampleCount,e.md5ext=t.md5,e},x=function(t,e){const r=Object.create(null);let i=[];r.isStage=t.isStage,r.name=r.isStage?"Stage":t.name;const n=function(t){const e=Object.create(null);e.variables=Object.create(null),e.lists=Object.create(null),e.broadcasts=Object.create(null);for(const r in t){const i=t[r];i.type!==o.BROADCAST_MESSAGE_TYPE?i.type!==o.LIST_TYPE?(e.variables[r]=[i.name,i.value],i.isCloud&&e.variables[r].push(!0)):e.lists[r]=[i.name,i.value]:e.broadcasts[r]=i.value}return e}(t.variables);return r.variables=n.variables,r.lists=n.lists,r.broadcasts=n.broadcasts,[r.blocks,i]=w(t.blocks),r.comments=function(t){const e=Object.create(null);for(const r in t){if(!t.hasOwnProperty(r))continue;const i=t[r],n=Object.create(null);n.blockId=i.blockId,n.x=i.x,n.y=i.y,n.width=i.width,n.height=i.height,n.minimized=i.minimized,n.text=i.text,e[r]=n}return e}(t.comments),(t.currentCostume<0||t.currentCostume>=t.costumes.length)&&(h.warn(`currentCostume property for target ${t.name} is out of range`),t.currentCostume=p.clamp(t.currentCostume,0,t.costumes.length-1)),r.currentCostume=t.currentCostume,r.costumes=t.costumes.map(N),r.sounds=t.sounds.map(A),t.hasOwnProperty("volume")&&(r.volume=t.volume),t.hasOwnProperty("layerOrder")&&(r.layerOrder=t.layerOrder),r.isStage?(t.hasOwnProperty("tempo")&&(r.tempo=t.tempo),t.hasOwnProperty("videoTransparency")&&(r.videoTransparency=t.videoTransparency),t.hasOwnProperty("videoState")&&(r.videoState=t.videoState),t.hasOwnProperty("textToSpeechLanguage")&&(r.textToSpeechLanguage=t.textToSpeechLanguage)):(r.visible=t.visible,r.x=t.x,r.y=t.y,r.size=t.size,r.direction=t.direction,r.draggable=t.draggable,r.rotationStyle=t.rotationStyle),i.forEach(t=>{e.add(t)}),r},C=function(t,e){let r=[];const i=e.monitorBlocks.getBlock(t);if(i&&(r.push(i),i.inputs))for(const t in i.inputs){const n=i.inputs[t].block;n&&(r=r.concat(C(n,e)))}return r},M=function(t,e,r,i){if(!Array.isArray(t))return t;const n=Object.create(null),s=l();switch(n.id=s,n.next=null,n.parent=e,n.shadow=r,n.inputs=Object.create(null),t[0]){case 4:n.opcode="math_number",n.fields={NUM:{name:"NUM",value:t[1]}},n.topLevel=!1;break;case 5:n.opcode="math_positive_number",n.fields={NUM:{name:"NUM",value:t[1]}},n.topLevel=!1;break;case 6:n.opcode="math_whole_number",n.fields={NUM:{name:"NUM",value:t[1]}},n.topLevel=!1;break;case 7:n.opcode="math_integer",n.fields={NUM:{name:"NUM",value:t[1]}},n.topLevel=!1;break;case 8:n.opcode="math_angle",n.fields={NUM:{name:"NUM",value:t[1]}},n.topLevel=!1;break;case 9:n.opcode="colour_picker",n.fields={COLOUR:{name:"COLOUR",value:t[1]}},n.topLevel=!1;break;case 10:n.opcode="text",n.fields={TEXT:{name:"TEXT",value:t[1]}},n.topLevel=!1;break;case 11:n.opcode="event_broadcast_menu",n.fields={BROADCAST_OPTION:{name:"BROADCAST_OPTION",value:t[1],id:t[2],variableType:o.BROADCAST_MESSAGE_TYPE}},n.topLevel=!1;break;case v:n.opcode="data_variable",n.fields={VARIABLE:{name:"VARIABLE",value:t[1],id:t[2],variableType:o.SCALAR_TYPE}},t.length>3&&(n.topLevel=!0,n.x=t[3],n.y=t[4]);break;case S:n.opcode="data_listcontents",n.fields={LIST:{name:"LIST",value:t[1],id:t[2],variableType:o.LIST_TYPE}},t.length>3&&(n.topLevel=!0,n.x=t[3],n.y=t[4]);break;default:return h.error(`Found unknown primitive type during deserialization: ${JSON.stringify(t)}`),null}return i[s]=n,s},P=function(t,e,r){const i={};for(const n in t){if(!y.call(t,n))continue;const s=t[n];if(!Array.isArray(s))continue;let o=null,a=null;const u=s[0];1===u?o=a=M(s[1],e,!0,r):2===u?o=M(s[1],e,!1,r):(o=M(s[1],e,!1,r),a=M(s[2],e,!0,r)),i[n]={name:n,block:o,shadow:a}}return i},R=function(t){const e={};for(const r in t){if(!y.call(t,r))continue;const i=t[r];Array.isArray(i)&&(e[r]={name:r,value:i[0]},i.length>1&&(e[r].id=i[1]),"BROADCAST_OPTION"===r?e[r].variableType=o.BROADCAST_MESSAGE_TYPE:"VARIABLE"===r?e[r].variableType=o.SCALAR_TYPE:"LIST"===r&&(e[r].variableType=o.LIST_TYPE))}return e},D=function(t){for(const e in t){if(!Object.prototype.hasOwnProperty.call(t,e))continue;const r=t[e];Array.isArray(r)?(delete t[e],M(r,null,!1,t)):(r.topLevel?(r.topLevel=!0,r.x=r.x?Math.round(r.x):0,r.y=r.y?Math.round(r.y):0):r.topLevel=!1,r.id=e,r.inputs=P(r.inputs,e,t),r.fields=R(r.fields))}return t};t.exports={serialize:function(t,e){const r=Object.create(null),n=new Set,s=e?[t.getTargetById(e)]:t.targets.filter(t=>t.isOriginal),o=function(t){const e=t.map(t=>t.getLayerOrder());return p.reducedSortOrdering(e)}(s),a=s.map(t=>t.toJSON());t.renderer&&!e&&a.forEach((t,e)=>{t.layerOrder=o[e]});const u=a.map(t=>x(t,n));if(e)return u[0];r.targets=u,r.monitors=function(t,e){return t.valueSeq().map(t=>{const r=C(t.id,e),i={id:t.id,mode:t.mode,opcode:t.opcode,params:t.params,spriteName:t.spriteName,value:t.value,width:t.width,height:t.height,x:t.x,y:t.y,visible:t.visible,blocksInfo:r};return"list"!==t.mode&&(i.sliderMin=t.sliderMin,i.sliderMax=t.sliderMax,i.isDiscrete=t.isDiscrete),i})}(t.getMonitorState(),t),r.extensions=Array.from(n);const c=Object.create(null);return c.semver="3.0.0",c.vm=i.version,c.agent="none","undefined"!=typeof navigator&&(c.agent=navigator.userAgent),r.meta=c,r},deserialize:function(t,e,r,i){const l={extensionIDs:new Set,extensionURLs:new Map},y=((i?[t]:t.targets)||[]).map((t,e)=>Object.assign(t,{targetPaneOrder:e})).sort((t,e)=>t.layerOrder-e.layerOrder),T=t.monitors||[];return Promise.resolve(y.map(t=>(function(t,e,r){if(!t.hasOwnProperty("name"))return Promise.resolve(null);const i={costumePromises:null,soundPromises:null,soundBank:e.audioEngine&&e.audioEngine.createBank()};return i.costumePromises=(t.costumes||[]).map(i=>{const n={asset:i.asset,assetId:i.assetId,skinId:null,name:i.name,bitmapResolution:i.bitmapResolution,rotationCenterX:i.rotationCenterX,rotationCenterY:i.rotationCenterY},s=i.dataFormat||i.assetType&&i.assetType.runtimeFormat||"png",o=i.hasOwnProperty("md5ext")?i.md5ext:`${i.assetId}.${s}`;return n.md5=o,n.dataFormat=s,g(n,e,r).then(()=>_(o,n,e,t._storeId))}),i.soundPromises=(t.sounds||[]).map(n=>{const s={assetId:n.assetId,format:n.format,rate:n.rate,sampleCount:n.sampleCount,name:n.name,md5:n.md5ext,dataFormat:n.dataFormat,data:null};return b(s,e,r).then(()=>f(s,e,i.soundBank,t._storeId))}),i})(t,e,r))).then(t=>Promise.resolve(t)).then(t=>Promise.all(y.map((r,i)=>(function(t,e,r,i,u){if(!t.hasOwnProperty("name"))return Promise.resolve(null);const h=new n(e),l=new s(h,e);if(t.hasOwnProperty("name")&&(l.name=t.name),t.hasOwnProperty("blocks")){D(t.blocks);for(const e in t.blocks){if(!t.blocks.hasOwnProperty(e))continue;const i=t.blocks[e];h.createBlock(i);const n=k(i.opcode);n&&r.extensionIDs.add(n)}}const{costumePromises:d}=u,{soundBank:m,soundPromises:_}=u,f=l.createClone(t.isStage?c.BACKGROUND_LAYER:c.SPRITE_LAYER);if(t.hasOwnProperty("tempo")&&(f.tempo=t.tempo),t.hasOwnProperty("volume")&&(f.volume=t.volume),t.hasOwnProperty("videoTransparency")&&(f.videoTransparency=t.videoTransparency),t.hasOwnProperty("videoState")&&(f.videoState=t.videoState),t.hasOwnProperty("textToSpeechLanguage")&&(f.textToSpeechLanguage=t.textToSpeechLanguage),t.hasOwnProperty("variables"))for(const r in t.variables){const i=t.variables[r],n=3===i.length&&i[2]&&t.isStage&&e.canAddCloudVariable(),s=new o(r,i[0],o.SCALAR_TYPE,n);n&&e.addCloudVariable(),s.value=i[1],f.variables[s.id]=s}if(t.hasOwnProperty("lists"))for(const e in t.lists){const r=t.lists[e],i=new o(e,r[0],o.LIST_TYPE,!1);i.value=r[1],f.variables[i.id]=i}if(t.hasOwnProperty("broadcasts"))for(const e in t.broadcasts){const r=t.broadcasts[e],i=new o(e,r,o.BROADCAST_MESSAGE_TYPE,!1);f.variables[i.id]=i}if(t.hasOwnProperty("comments"))for(const e in t.comments){const r=t.comments[e],i=new a(e,r.text,r.x,r.y,r.width,r.height,r.minimized);r.blockId&&(i.blockId=r.blockId),f.comments[i.id]=i}return t.hasOwnProperty("x")&&(f.x=t.x),t.hasOwnProperty("y")&&(f.y=t.y),t.hasOwnProperty("direction")&&(f.direction=t.direction),t.hasOwnProperty("size")&&(f.size=t.size),t.hasOwnProperty("visible")&&(f.visible=t.visible),t.hasOwnProperty("currentCostume")&&(f.currentCostume=p.clamp(t.currentCostume,0,t.costumes.length-1)),t.hasOwnProperty("rotationStyle")&&(f.rotationStyle=t.rotationStyle),t.hasOwnProperty("isStage")&&(f.isStage=t.isStage),t.hasOwnProperty("targetPaneOrder")&&(f.targetPaneOrder=t.targetPaneOrder),t.hasOwnProperty("draggable")&&(f.draggable=t.draggable),Promise.all(d).then(t=>{l.costumes=t}),Promise.all(_).then(t=>{l.sounds=t,l.soundBank=m||null}),Promise.all(d.concat(_)).then(()=>f)})(r,e,l,0,t[i])))).then(t=>t.map((t,e)=>(t.layerOrder=e,t)).sort((t,e)=>t.targetPaneOrder-e.targetPaneOrder).map(t=>(delete t.targetPaneOrder,t))).then(t=>(function(t){const e=m.getAllVarRefsForTargets(t,!0);t.forEach(t=>{Object.keys(t.variables).forEach(e=>{const r=d.replaceUnsafeChars(e);r!==e&&(t.variables[e].id=r,t.variables[r]=t.variables[e],delete t.variables[e])})});for(const t in e){const r=d.replaceUnsafeChars(t);t!==r&&m.updateVariableIdentifiers(e[t],r)}return t})(t)).then(t=>(T.map(r=>(function(t,e,r,i){if(t.spriteName){const e=r.filter(e=>e.sprite.name===t.spriteName);e&&e.length>0?t.targetId=e[0].id:h.warn(`Tried to deserialize sprite specific monitor ${t.opcode} but could not find sprite ${t.spriteName}.`)}const n=e.monitorBlockInfo[t.opcode],s={};for(const e in t.params){const r={name:e,value:t.params[e]};s[e]=r}if("data_variable"!==t.opcode&&"data_listcontents"!==t.opcode&&n&&n.isSpriteSpecific){if(!t.targetId){const e=r.find(t=>0===t.sprite.name.indexOf(n.deviceId));t.targetId=e?e.id:"",t.spriteName=e?e.sprite.name:""}t.id=n.getId(t.targetId,t.params)}else t.id=d.replaceUnsafeChars(t.id);const a=e.monitorBlocks._blocks[t.id];if(a)a.isMonitored=t.visible,a.targetId=t.targetId;else if(Array.isArray(t.blocksInfo))t.blocksInfo.forEach(r=>{r.opcode===t.opcode&&(r.id=t.id),r.targetId=t.targetId,e.monitorBlocks.createBlock(r)}),delete t.blocksInfo;else{const r={id:t.id,opcode:t.opcode,inputs:{},fields:s,topLevel:!0,next:null,parent:null,shadow:!1,x:0,y:0,isMonitored:t.visible,targetId:t.targetId};if("data_variable"===t.opcode){const e=r.fields.VARIABLE;e.id=t.id,e.variableType=o.SCALAR_TYPE}else if("data_listcontents"===t.opcode){const e=r.fields.LIST;e.id=t.id,e.variableType=o.LIST_TYPE}e.monitorBlocks.createBlock(r);const n=k(r.opcode);n&&i.extensionIDs.add(n)}e.requestAddMonitor(u(t))})(r,e,t,l)),t)).then(t=>({targets:t,extensions:l}))},deserializeBlocks:D,serializeBlocks:w,getExtensionIdForOpcode:k}},209:function(t,e){const r=[];class i{constructor(t){this.isLoop=!1,this.warpMode=t,this.justReported=null,this.reporting="",this.reported=null,this.waitingReporter=null,this.params=null,this.executionContext=null}reset(){return this.isLoop=!1,this.warpMode=!1,this.justReported=null,this.reported=null,this.waitingReporter=null,this.params=null,this.executionContext=null,this}reuse(t=this.warpMode){return this.reset(),this.warpMode=Boolean(t),this}static create(t){const e=r.pop();return void 0!==e?(e.warpMode=Boolean(t),e):new i(t)}static release(t){void 0!==t&&r.push(t.reset())}}class n{constructor(t){this.topBlock=t,this.stack=[],this.stackFrames=[],this.status=0,this.isKilled=!1,this.target=null,this.blockContainer=null,this.requestScriptGlowInFrame=!1,this.blockGlowInFrame=null,this.warpTimer=null,this.justReported=null}static get STATUS_RUNNING(){return 0}static get STATUS_PROMISE_WAIT(){return 1}static get STATUS_YIELD(){return 2}static get STATUS_YIELD_TICK(){return 3}static get STATUS_DONE(){return 4}pushStack(t){if(this.stack.push(t),this.stack.length>this.stackFrames.length){const t=this.stackFrames[this.stackFrames.length-1];this.stackFrames.push(i.create(void 0!==t&&t.warpMode))}}reuseStackForNextBlock(t){this.stack[this.stack.length-1]=t,this.stackFrames[this.stackFrames.length-1].reuse()}popStack(){return i.release(this.stackFrames.pop()),this.stack.pop()}stopThisScript(){let t=this.peekStack();for(;null!==t;){const e=this.target.blocks.getBlock(t);if(void 0!==e&&"procedures_call"===e.opcode)break;this.popStack(),t=this.peekStack()}0===this.stack.length&&(this.requestScriptGlowInFrame=!1,this.status=n.STATUS_DONE)}peekStack(){return this.stack.length>0?this.stack[this.stack.length-1]:null}peekStackFrame(){return this.stackFrames.length>0?this.stackFrames[this.stackFrames.length-1]:null}peekParentStackFrame(){return this.stackFrames.length>1?this.stackFrames[this.stackFrames.length-2]:null}pushReportedValue(t){this.justReported=void 0===t?null:t}initParams(){const t=this.peekStackFrame();null===t.params&&(t.params={})}pushParam(t,e){this.peekStackFrame().params[t]=e}getParam(t){for(let e=this.stackFrames.length-1;e>=0;e--){const r=this.stackFrames[e];if(null!==r.params)return r.params.hasOwnProperty(t)?r.params[t]:null}return null}atStackTop(){return this.peekStack()===this.topBlock}goToNextBlock(){const t=this.target.blocks.getNextBlock(this.peekStack());this.reuseStackForNextBlock(t)}isRecursiveCall(t){let e=5;for(let r=this.stack.length-1-1;r>=0;r--){const i=this.target.blocks.getBlock(this.stack[r]);if("procedures_call"===i.opcode&&i.mutation.proccode===t)return!0;if(--e<0)return!1}return!1}}t.exports=n},210:function(t,e,r){const i=r(110),n=r(59),s=function(t,e,r,i){return new Promise(s=>{let o=t.asset.decodeText();if(i&&2===i&&!e.v2SvgAdapter)n.error("No V2 SVG adapter present; SVGs may not render correctly.");else if(i&&2===i&&e.v2SvgAdapter){e.v2SvgAdapter.loadString(o,!0),o=e.v2SvgAdapter.toString();const r=e.storage;t.asset.encodeTextData(o,r.DataFormat.SVG,!1),t.assetId=t.asset.assetId,t.md5=`${t.assetId}.${t.dataFormat}`}t.skinId=e.renderer.createSVGSkin(o,r),t.size=e.renderer.getSkinSize(t.skinId),r||(r=e.renderer.getSkinRotationCenter(t.skinId),t.rotationCenterX=r[0],t.rotationCenterY=r[1],t.bitmapResolution=1),s(t)})},o=new class{constructor(){this.pool=[],this.clearSoon=null}clear(){this.clearSoon||(this.clearSoon=new Promise(t=>setTimeout(t,1e3)).then(()=>{this.pool.length=0,this.clearSoon=null}))}create(){return this.pool.pop()||document.createElement("canvas")}release(t){this.clear(),this.pool.push(t)}},a=function(t,e,r){return function(t,e,r){return t&&t.asset?e.v2BitmapAdapter?Promise.all([t.asset,t.textLayerAsset].map(t=>t?"undefined"!=typeof createImageBitmap?createImageBitmap(new Blob([t.data],{type:t.assetType.contentType})):new Promise((e,r)=>{const i=new Image;i.onload=function(){e(i),i.onload=null,i.onerror=null},i.onerror=function(){r("Costume load failed. Asset could not be read."),i.onload=null,i.onerror=null},i.src=t.encodeDataURI()}):null)).then(([i,n])=>{const s=o.create(),a=1===t.bitmapResolution?2:1;s.width=i.width,s.height=i.height;const u=s.getContext("2d");u.drawImage(i,0,0),n&&u.drawImage(n,0,0);let c=s;return 1!==a&&(c=e.v2BitmapAdapter.resize(s,c.width*a,c.height*a)),r&&(r[0]=r[0]*a,r[1]=r[1]*a,t.rotationCenterX=r[0],t.rotationCenterY=r[1]),t.bitmapResolution=2,delete t.textLayerMD5,delete t.textLayerAsset,{canvas:c,mergeCanvas:s,rotationCenter:r,assetMatchesBase:1===a&&!n}}).catch(()=>{delete t.textLayerMD5,delete t.textLayerAsset}):Promise.reject("No V2 Bitmap adapter present."):Promise.reject("Costume load failed. Assets were missing.")}(t,e,r).then(r=>{return r.assetMatchesBase||function(r){if(!e.v2BitmapAdapter)return Promise.reject("No V2 Bitmap adapter present.");const i=e.storage;t.asset=i.createAsset(i.AssetType.ImageBitmap,i.DataFormat.PNG,e.v2BitmapAdapter.convertDataURIToBinary(r),null,!0),t.dataFormat=i.DataFormat.PNG,t.assetId=t.asset.assetId,t.md5=`${t.assetId}.${t.dataFormat}`}(r.canvas.toDataURL()),r}).then(({canvas:r,mergeCanvas:i,rotationCenter:n})=>{t.skinId=e.renderer.createBitmapSkin(r,t.bitmapResolution,n),o.release(i);const s=e.renderer.getSkinSize(t.skinId);return t.size=[2*s[0],2*s[1]],n||(n=e.renderer.getSkinRotationCenter(t.skinId),t.rotationCenterX=2*n[0],t.rotationCenterY=2*n[1],t.bitmapResolution=2),t})},u=function(t,e,r){if(t.assetId=t.asset.assetId,!e.renderer)return n.error("No rendering module present; cannot load costume: ",t.name),Promise.resolve(t);const i=e.storage.AssetType;let o;return"number"!=typeof t.rotationCenterX||isNaN(t.rotationCenterX)||"number"!=typeof t.rotationCenterY||isNaN(t.rotationCenterY)||(o=[t.rotationCenterX,t.rotationCenterY]),t.asset.assetType.runtimeFormat===i.ImageVector.runtimeFormat?s(t,e,o,r).catch(r=>(n.warn(`Error loading vector image: ${r.name}: ${r.message}`),t.assetId=e.storage.defaultAssetId.ImageVector,t.asset=e.storage.get(t.assetId),t.md5=`${t.assetId}.${i.ImageVector.runtimeFormat}`,s(t,e))):a(t,e,o)};t.exports={loadCostume:function(t,e,r,s,o){const a=i.splitFirst(t,"."),c=a[0],h=a[1].toLowerCase();if(e.dataFormat=h,e.asset)return u(e,r,s);if(!r.storage)return n.error("No storage module present; cannot load costume asset: ",t),Promise.resolve(e);if(!r.storage.defaultAssetId)return n.error("No default assets found"),Promise.resolve(e);const l=r.storage.AssetType,p="svg"===h?l.ImageVector:l.ImageBitmap,d=r.storage.load(p,c,h,o);if(!d)return void n.error(`Couldn't fetch costume asset: ${t}`);let m;return m=e.textLayerMD5?r.storage.load(l.ImageBitmap,e.textLayerMD5,"png",o):Promise.resolve(null),Promise.all([d,m]).then(t=>(e.asset=t[0],t[1]&&(e.textLayerAsset=t[1]),u(e,r,s)))},loadCostumeFromAsset:u}},211:function(t,e,r){const i=r(110),n=r(59),s=function(t,e,r,i){return t.assetId=e.assetId,r.audioEngine?r.audioEngine.decodeSoundPlayer(Object.assign({},t,{data:e.data})).then(e=>{t.soundId=e.id;const r=e.buffer;return t.rate=r.sampleRate,t.sampleCount=r.length,i&&i.addSoundPlayer(e),t}):(n.error("No audio engine present; cannot load sound asset: ",t.md5),Promise.resolve(t))};t.exports={loadSound:function(t,e,r,o){if(!e.storage)return n.error("No storage module present; cannot load sound asset: ",t.md5),Promise.resolve(t);const a=i.splitFirst(t.md5,"."),u=a[0],c=a[1].toLowerCase();return t.dataFormat=c,(t.asset&&Promise.resolve(t.asset)||e.storage.load(e.storage.AssetType.Sound,u,c,o)).then(i=>(t.asset=i,s(t,i,e,r)))},loadSoundFromAsset:s}},290:function(t,e,r){"use strict";var i=r(882),n=r(883),s=r(444),o=r(443),a=r(442);function u(t,e){return Object.keys(e).forEach((function(r){t[r]=e[r]})),t}t.exports=function t(){var e=u({},a),r="en",c={},h=function(t){return t},l=null,p="warning",d={};function m(t,e,s){var o="string"==typeof t?t:t.default,a=g(o,"object"==typeof t&&t.id||h(o),s||r);return(a.format||(a.format=n(i(a.message),s||r,d)))(e)}m.rich=function(t,e,s){var o="string"==typeof t?t:t.default,a=g(o,"object"==typeof t&&t.id||h(o),s||r);return(a.toParts||(a.toParts=n.toParts(i(a.message,{tagsType:_}),s||r,d)))(e)};var _="<>";function f(t,e){var r=t[2];return function(t,e){var i="object"==typeof r?function(t,e){return Object.keys(t).reduce((function(r,i){return r[i]=t[i](e),r}),{})}(r,e):r;return"function"==typeof t?t(i):t}}function g(t,e,r){var i=o(r,c)||"en",n=c[i]||(c[i]={}),s=n[e];if("string"==typeof s&&(s=n[e]={message:s}),!s){if("warning"===p);else if("ignore"!==p)throw new Error('Translation for "'+e+'" in "'+i+'" is missing');var a="function"==typeof l?l(t,e,i)||t:l||t;s=n[e]={message:a}}return s}function b(t,e,i,n,a){"object"==typeof i&&"object"!=typeof n&&(a=n,n=i,i=0);var u=o(a||r,s),c=u&&s[u][t]||y;return n["="+ +e]||n[c(e-i)]||n.other}function y(){return"other"}return d[_]=f,m.setup=function(t){return(t=t||{}).locale&&(r=t.locale),"translations"in t&&(c=t.translations||{}),t.generateId&&(h=t.generateId),"missingReplacement"in t&&(l=t.missingReplacement),t.missingTranslation&&(p=t.missingTranslation),t.formats&&(t.formats.number&&u(e.number,t.formats.number),t.formats.date&&u(e.date,t.formats.date),t.formats.time&&u(e.time,t.formats.time)),t.types&&((d=t.types)[_]=f),{locale:r,translations:c,generateId:h,missingReplacement:l,missingTranslation:p,formats:e,types:d}},m.number=function(t,i,n){var s=i&&e.number[i]||e.parseNumberPattern(i)||e.number.default;return new Intl.NumberFormat(n||r,s).format(t)},m.date=function(t,i,n){var s=i&&e.date[i]||e.parseDatePattern(i)||e.date.default;return new Intl.DateTimeFormat(n||r,s).format(t)},m.time=function(t,i,n){var s=i&&e.time[i]||e.parseDatePattern(i)||e.time.default;return new Intl.DateTimeFormat(n||r,s).format(t)},m.select=function(t,e){return e[t]||e.other},m.custom=function(t,e,r,i){return t[1]in d?d[t[1]](t,e)(r,i):r},m.plural=b.bind(null,"cardinal"),m.selectordinal=b.bind(null,"ordinal"),m.namespace=t,m}()},291:function(t,e,r){const{Record:i}=r(175),n=i({id:null,spriteName:null,targetId:null,opcode:null,value:null,params:null,mode:"default",sliderMin:0,sliderMax:100,isDiscrete:!0,x:null,y:null,width:0,height:0,visible:!0});t.exports=n},293:function(t,e,r){const i=r(59),n=r(109),s=r(110),o=r(90),a=r(208),u=r(931),c=r(136);class h extends u{constructor(t,e){super(e,t.blocks),this.sprite=t,this.renderer=null,this.runtime&&(this.renderer=this.runtime.renderer),this.drawableID=null,this.dragging=!1,this.effects={color:0,fisheye:0,whirl:0,pixelate:0,mosaic:0,brightness:0,ghost:0},this.isOriginal=!0,this.isStage=!1,this.x=0,this.y=0,this.direction=90,this.draggable=!1,this.visible=!0,this.size=100,this.currentCostume=0,this.rotationStyle=h.ROTATION_STYLE_ALL_AROUND,this.volume=100,this.tempo=60,this.videoTransparency=50,this.videoState=h.VIDEO_STATE.ON,this.textToSpeechLanguage=null}initDrawable(t){this.renderer&&(this.drawableID=this.renderer.createDrawable(t)),this.isOriginal||this.runtime.startHats("control_start_as_clone",null,this)}get audioPlayer(){const t=this.sprite.soundBank,e={playSound:e=>t.play(this,e)};return Object.defineProperty(this,"audioPlayer",{configurable:!1,enumerable:!0,writable:!1,value:e}),e}initAudio(){}static get EVENT_TARGET_MOVED(){return"TARGET_MOVED"}static get EVENT_TARGET_VISUAL_CHANGE(){return"EVENT_TARGET_VISUAL_CHANGE"}static get ROTATION_STYLE_ALL_AROUND(){return"all around"}static get ROTATION_STYLE_LEFT_RIGHT(){return"left-right"}static get ROTATION_STYLE_NONE(){return"don't rotate"}static get VIDEO_STATE(){return{OFF:"off",ON:"on",ON_FLIPPED:"on-flipped"}}setXY(t,e,r){if(this.isStage)return;if(this.dragging&&!r)return;const i=this.x,n=this.y;if(this.renderer){const r=this.renderer.getFencedPositionOfDrawable(this.drawableID,[t,e]);this.x=r[0],this.y=r[1],this.renderer.updateDrawablePosition(this.drawableID,r),this.visible&&(this.emit(h.EVENT_TARGET_VISUAL_CHANGE,this),this.runtime.requestRedraw())}else this.x=t,this.y=e;this.emit(h.EVENT_TARGET_MOVED,this,i,n,r),this.runtime.requestTargetsUpdate(this)}_getRenderedDirectionAndScale(){let t=this.direction,e=[this.size,this.size];if(this.rotationStyle===h.ROTATION_STYLE_NONE)t=90;else if(this.rotationStyle===h.ROTATION_STYLE_LEFT_RIGHT){t=90,e=[(this.direction<0?-1:1)*this.size,this.size]}return{direction:t,scale:e}}setDirection(t){if(!this.isStage&&isFinite(t)){if(this.direction=n.wrapClamp(t,-179,180),this.renderer){const{direction:t,scale:e}=this._getRenderedDirectionAndScale();this.renderer.updateDrawableDirectionScale(this.drawableID,t,e),this.visible&&(this.emit(h.EVENT_TARGET_VISUAL_CHANGE,this),this.runtime.requestRedraw())}this.runtime.requestTargetsUpdate(this)}}setDraggable(t){this.isStage||(this.draggable=!!t,this.runtime.requestTargetsUpdate(this))}setSay(t,e){this.isStage||(t&&e?i.info("Setting say bubble:",t,e):i.info("Clearing say bubble"))}setVisible(t){this.isStage||(this.visible=!!t,this.renderer&&(this.renderer.updateDrawableVisible(this.drawableID,this.visible),this.visible&&(this.emit(h.EVENT_TARGET_VISUAL_CHANGE,this),this.runtime.requestRedraw())),this.runtime.requestTargetsUpdate(this))}setSize(t){if(!this.isStage){if(this.renderer){const e=this.renderer.getCurrentSkinSize(this.drawableID),r=e[0],i=e[1],s=Math.min(1,Math.max(5/r,5/i)),o=Math.min(1.5*this.runtime.constructor.STAGE_WIDTH/r,1.5*this.runtime.constructor.STAGE_HEIGHT/i);this.size=100*n.clamp(t/100,s,o);const{direction:a,scale:u}=this._getRenderedDirectionAndScale();this.renderer.updateDrawableDirectionScale(this.drawableID,a,u),this.visible&&(this.emit(h.EVENT_TARGET_VISUAL_CHANGE,this),this.runtime.requestRedraw())}this.runtime.requestTargetsUpdate(this)}}setEffect(t,e){this.effects.hasOwnProperty(t)&&(this.effects[t]=e,this.renderer&&(this.renderer.updateDrawableEffect(this.drawableID,t,e),this.visible&&(this.emit(h.EVENT_TARGET_VISUAL_CHANGE,this),this.runtime.requestRedraw())))}clearEffects(){for(const t in this.effects)this.effects.hasOwnProperty(t)&&(this.effects[t]=0);if(this.renderer){for(const t in this.effects)this.effects.hasOwnProperty(t)&&this.renderer.updateDrawableEffect(this.drawableID,t,0);this.visible&&(this.emit(h.EVENT_TARGET_VISUAL_CHANGE,this),this.runtime.requestRedraw())}}setCostume(t){if(t=Math.round(t),[1/0,-1/0,NaN].includes(t)&&(t=0),this.currentCostume=n.wrapClamp(t,0,this.sprite.costumes.length-1),this.renderer){const t=this.getCostumes()[this.currentCostume];if(void 0!==t.rotationCenterX&&void 0!==t.rotationCenterY){const e=t.bitmapResolution||2,r=[t.rotationCenterX/e,t.rotationCenterY/e];this.renderer.updateDrawableSkinIdRotationCenter(this.drawableID,t.skinId,r)}else this.renderer.updateDrawableSkinId(this.drawableID,t.skinId);this.visible&&(this.emit(h.EVENT_TARGET_VISUAL_CHANGE,this),this.runtime.requestRedraw())}this.runtime.requestTargetsUpdate(this)}addCostume(t,e){"number"!=typeof e||isNaN(e)?this.sprite.addCostumeAt(t,this.sprite.costumes.length):this.sprite.addCostumeAt(t,e)}renameCostume(t,e){const r=this.sprite.costumes.filter((e,r)=>t!==r).map(t=>t.name),i=this.getCostumes()[t].name,n=s.unusedName(e,r);if(this.getCostumes()[t].name=n,this.isStage){const t=this.runtime.targets;for(let e=0;e<t.length;e++){t[e].blocks.updateAssetName(i,n,"backdrop")}}else this.blocks.updateAssetName(i,n,"costume")}deleteCostume(t){const e=this.sprite.costumes.length;if(1===e)return null;if(t<0||t>=e)return null;const r=this.sprite.deleteCostumeAt(t);return t===this.currentCostume&&t===e-1?this.setCostume(t-1):t<this.currentCostume?this.setCostume(this.currentCostume-1):this.setCostume(this.currentCostume),this.runtime.requestTargetsUpdate(this),r}addSound(t,e){const r=this.sprite.sounds.map(t=>t.name);t.name=s.unusedName(t.name,r),"number"!=typeof e||isNaN(e)?this.sprite.sounds.push(t):this.sprite.sounds.splice(e,0,t)}renameSound(t,e){const r=this.sprite.sounds.filter((e,r)=>t!==r).map(t=>t.name),i=this.sprite.sounds[t].name,n=s.unusedName(e,r);this.sprite.sounds[t].name=n,this.blocks.updateAssetName(i,n,"sound")}deleteSound(t){if(t<0||t>=this.sprite.sounds.length)return null;const e=this.sprite.sounds.splice(t,1)[0];return this.runtime.requestTargetsUpdate(this),e}setRotationStyle(t){if(t===h.ROTATION_STYLE_NONE?this.rotationStyle=h.ROTATION_STYLE_NONE:t===h.ROTATION_STYLE_ALL_AROUND?this.rotationStyle=h.ROTATION_STYLE_ALL_AROUND:t===h.ROTATION_STYLE_LEFT_RIGHT&&(this.rotationStyle=h.ROTATION_STYLE_LEFT_RIGHT),this.renderer){const{direction:t,scale:e}=this._getRenderedDirectionAndScale();this.renderer.updateDrawableDirectionScale(this.drawableID,t,e),this.visible&&(this.emit(h.EVENT_TARGET_VISUAL_CHANGE,this),this.runtime.requestRedraw())}this.runtime.requestTargetsUpdate(this)}getCostumeIndexByName(t){for(let e=0;e<this.sprite.costumes.length;e++)if(this.getCostumes()[e].name===t)return e;return-1}getCurrentCostume(){return this.getCostumes()[this.currentCostume]}getCostumes(){return this.sprite.costumes}reorderCostume(t,e){if((e=n.clamp(e,0,this.sprite.costumes.length-1))===(t=n.clamp(t,0,this.sprite.costumes.length-1)))return!1;const r=this.getCurrentCostume(),i=this.sprite.costumes[t];return this.sprite.deleteCostumeAt(t),this.addCostume(i,e),this.currentCostume=this.getCostumeIndexByName(r.name),!0}reorderSound(t,e){if((e=n.clamp(e,0,this.sprite.sounds.length-1))===(t=n.clamp(t,0,this.sprite.sounds.length-1)))return!1;const r=this.sprite.sounds[t];return this.deleteSound(t),this.addSound(r,e),!0}getSounds(){return this.sprite.sounds}updateAllDrawableProperties(){if(this.renderer){const{direction:t,scale:e}=this._getRenderedDirectionAndScale();this.renderer.updateDrawablePosition(this.drawableID,[this.x,this.y]),this.renderer.updateDrawableDirectionScale(this.drawableID,t,e),this.renderer.updateDrawableVisible(this.drawableID,this.visible);const r=this.getCostumes()[this.currentCostume],i=r.bitmapResolution||2;this.renderer.updateDrawableSkinIdRotationCenter(this.drawableID,r.skinId,[r.rotationCenterX/i,r.rotationCenterY/i]);for(const t in this.effects)this.effects.hasOwnProperty(t)&&this.renderer.updateDrawableEffect(this.drawableID,t,this.effects[t]);this.visible&&(this.emit(h.EVENT_TARGET_VISUAL_CHANGE,this),this.runtime.requestRedraw())}this.runtime.requestTargetsUpdate(this)}getName(){return this.sprite.name}isSprite(){return!this.isStage&&this.isOriginal}getBounds(){return this.renderer?this.runtime.renderer.getBounds(this.drawableID):null}getBoundsForBubble(){return this.renderer?this.runtime.renderer.getBoundsForBubble(this.drawableID):null}isTouchingObject(t){if("_mouse_"===t){if(!this.runtime.ioDevices.mouse)return!1;const t=this.runtime.ioDevices.mouse.getClientX(),e=this.runtime.ioDevices.mouse.getClientY();return this.isTouchingPoint(t,e)}return"_edge_"===t?this.isTouchingEdge():this.isTouchingSprite(t)}isTouchingPoint(t,e){return!!this.renderer&&this.renderer.drawableTouching(this.drawableID,t,e)}isTouchingEdge(){if(this.renderer){const t=this.runtime.constructor.STAGE_WIDTH,e=this.runtime.constructor.STAGE_HEIGHT,r=this.getBounds();if(r.left<-t/2||r.right>t/2||r.top>e/2||r.bottom<-e/2)return!0}return!1}isTouchingSprite(t){t=o.toString(t);const e=this.runtime.getSpriteTargetByName(t);if(!e||!this.renderer)return!1;const r=e.sprite.clones.filter(t=>!t.dragging).map(t=>t.drawableID);return this.renderer.isTouchingDrawables(this.drawableID,r)}isTouchingColor(t){return!!this.renderer&&this.renderer.isTouchingColor(this.drawableID,t)}colorIsTouchingColor(t,e){return!!this.renderer&&this.renderer.isTouchingColor(this.drawableID,t,e)}getLayerOrder(){return this.renderer?this.renderer.getDrawableOrder(this.drawableID):null}goToFront(){this.renderer&&this.renderer.setDrawableOrder(this.drawableID,1/0,c.SPRITE_LAYER),this.runtime.setExecutablePosition(this,1/0)}goToBack(){this.renderer&&this.renderer.setDrawableOrder(this.drawableID,-1/0,c.SPRITE_LAYER,!1),this.runtime.setExecutablePosition(this,-1/0)}goForwardLayers(t){this.renderer&&this.renderer.setDrawableOrder(this.drawableID,t,c.SPRITE_LAYER,!0),this.runtime.moveExecutable(this,t)}goBackwardLayers(t){this.renderer&&this.renderer.setDrawableOrder(this.drawableID,-t,c.SPRITE_LAYER,!0),this.runtime.moveExecutable(this,-t)}goBehindOther(t){if(this.renderer){const e=this.renderer.setDrawableOrder(t.drawableID,0,c.SPRITE_LAYER,!0);this.renderer.setDrawableOrder(this.drawableID,e,c.SPRITE_LAYER)}const e=this.runtime.executableTargets.indexOf(t);this.runtime.setExecutablePosition(this,e)}keepInFence(t,e,r){let i=r;i||(i={left:-this.runtime.constructor.STAGE_WIDTH/2,right:this.runtime.constructor.STAGE_WIDTH/2,top:this.runtime.constructor.STAGE_HEIGHT/2,bottom:-this.runtime.constructor.STAGE_HEIGHT/2});const n=this.getBounds();if(!n)return;n.left+=t-this.x,n.right+=t-this.x,n.top+=e-this.y,n.bottom+=e-this.y;let s=0,o=0;return n.left<i.left&&(s+=i.left-n.left),n.right>i.right&&(s+=i.right-n.right),n.top>i.top&&(o+=i.top-n.top),n.bottom<i.bottom&&(o+=i.bottom-n.bottom),[t+s,e+o]}makeClone(){if(!this.runtime.clonesAvailable()||this.isStage)return null;this.runtime.changeCloneCounter(1);const t=this.sprite.createClone();return t.x=this.x,t.y=this.y,t.direction=this.direction,t.draggable=this.draggable,t.visible=this.visible,t.size=this.size,t.currentCostume=this.currentCostume,t.rotationStyle=this.rotationStyle,t.effects=a.simple(this.effects),t.variables=this.duplicateVariables(),t._edgeActivatedHatValues=a.simple(this._edgeActivatedHatValues),t.initDrawable(c.SPRITE_LAYER),t.updateAllDrawableProperties(),t}duplicate(){return this.sprite.duplicate().then(t=>{const e=t.createClone();return e.x=400*(Math.random()-.5)/2,e.y=300*(Math.random()-.5)/2,e.direction=this.direction,e.draggable=this.draggable,e.visible=this.visible,e.size=this.size,e.currentCostume=this.currentCostume,e.rotationStyle=this.rotationStyle,e.effects=JSON.parse(JSON.stringify(this.effects)),e.variables=this.duplicateVariables(e.blocks),e.updateAllDrawableProperties(),e})}onGreenFlag(){this.clearEffects()}onStopAll(){this.clearEffects()}postSpriteInfo(t){const e=t.hasOwnProperty("force")?t.force:null,r=t.hasOwnProperty("x"),i=t.hasOwnProperty("y");(r||i)&&this.setXY(r?t.x:this.x,i?t.y:this.y,e),t.hasOwnProperty("direction")&&this.setDirection(t.direction),t.hasOwnProperty("draggable")&&this.setDraggable(t.draggable),t.hasOwnProperty("rotationStyle")&&this.setRotationStyle(t.rotationStyle),t.hasOwnProperty("visible")&&this.setVisible(t.visible),t.hasOwnProperty("size")&&this.setSize(t.size)}startDrag(){this.dragging=!0}stopDrag(){this.dragging=!1}toJSON(){const t=this.getCostumes();return{id:this.id,name:this.getName(),isStage:this.isStage,x:this.x,y:this.y,size:this.size,direction:this.direction,draggable:this.draggable,currentCostume:this.currentCostume,costume:t[this.currentCostume],costumeCount:t.length,visible:this.visible,rotationStyle:this.rotationStyle,comments:this.comments,blocks:this.blocks._blocks,variables:this.variables,costumes:t,sounds:this.getSounds(),textToSpeechLanguage:this.textToSpeechLanguage,tempo:this.tempo,volume:this.volume,videoTransparency:this.videoTransparency,videoState:this.videoState}}dispose(){this.runtime.changeCloneCounter(-1),this.runtime.stopForTarget(this),this.runtime.removeExecutable(this),this.sprite.removeClone(this),this.renderer&&null!==this.drawableID&&(this.renderer.destroyDrawable(this.drawableID,this.isStage?c.BACKGROUND_LAYER:c.SPRITE_LAYER),this.visible&&(this.emit(h.EVENT_TARGET_VISUAL_CHANGE,this),this.runtime.requestRedraw()))}}t.exports=h},294:function(t,e,r){const i=r(98),n=r(207);class s{constructor(t,e,r,n,o,a,u){this.id=t||i(),this.text=e,this.x=r,this.y=n,this.width=Math.max(Number(o),s.MIN_WIDTH),this.height=Math.max(Number(a),s.MIN_HEIGHT),this.minimized=u||!1,this.blockId=null}toXML(){return`<comment id="${this.id}" x="${this.x}" y="${this.y}" w="${this.width}" h="${this.height}" pinned="${null!==this.blockId}" minimized="${this.minimized}">${n(this.text)}</comment>`}static get MIN_WIDTH(){return 20}static get MIN_HEIGHT(){return 20}static get DEFAULT_WIDTH(){return 100}static get DEFAULT_HEIGHT(){return 100}}t.exports=s},369:function(t,e){var r=1e3,i=60*r,n=60*i,s=24*n,o=7*s,a=365.25*s;function u(t,e,r,i){var n=e>=1.5*r;return Math.round(t/r)+" "+i+(n?"s":"")}t.exports=function(t,e){e=e||{};var c=typeof t;if("string"===c&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!e)return;var u=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return u*a;case"weeks":case"week":case"w":return u*o;case"days":case"day":case"d":return u*s;case"hours":case"hour":case"hrs":case"hr":case"h":return u*n;case"minutes":case"minute":case"mins":case"min":case"m":return u*i;case"seconds":case"second":case"secs":case"sec":case"s":return u*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return u;default:return}}(t);if("number"===c&&isFinite(t))return e.long?function(t){var e=Math.abs(t);if(e>=s)return u(t,e,s,"day");if(e>=n)return u(t,e,n,"hour");if(e>=i)return u(t,e,i,"minute");if(e>=r)return u(t,e,r,"second");return t+" ms"}(t):function(t){var e=Math.abs(t);if(e>=s)return Math.round(t/s)+"d";if(e>=n)return Math.round(t/n)+"h";if(e>=i)return Math.round(t/i)+"m";if(e>=r)return Math.round(t/r)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},439:function(t,e,r){const i=r(871),n=r(59);t.exports=new class extends i{constructor(){super(),this.services={},this.workerClass="undefined"==typeof Worker?null:Worker,this.workers=[]}callSync(t,e,...r){const{provider:i,isRemote:n}=this._getServiceProvider(t);if(i){if(n)throw new Error(`Cannot use 'callSync' on remote provider for service ${t}.`);return i[e].apply(i,r)}throw new Error(`Provider not found for service: ${t}`)}setServiceSync(t,e){this.services.hasOwnProperty(t)&&n.warn(`Central dispatch replacing existing service provider for ${t}`),this.services[t]=e}setService(t,e){try{return this.setServiceSync(t,e),Promise.resolve()}catch(t){return Promise.reject(t)}}addWorker(t){-1===this.workers.indexOf(t)?(this.workers.push(t),t.onmessage=this._onMessage.bind(this,t),this._remoteCall(t,"dispatch","handshake").catch(t=>{n.error(`Could not handshake with worker: ${JSON.stringify(t)}`)})):n.warn("Central dispatch ignoring attempt to add duplicate worker")}_getServiceProvider(t){const e=this.services[t];return e&&{provider:e,isRemote:Boolean(this.workerClass&&e instanceof this.workerClass)}}_onDispatchMessage(t,e){let r;switch(e.method){case"setService":r=this.setService(e.args[0],t);break;default:n.error(`Central dispatch received message for unknown method: ${e.method}`)}return r}}},442:function(t,e){var r="long",i="short",n="numeric";t.exports={number:{decimal:{style:"decimal"},integer:{style:"decimal",maximumFractionDigits:0},currency:{style:"currency",currency:"USD"},percent:{style:"percent"},default:{style:"decimal"}},date:{short:{month:n,day:n,year:"2-digit"},medium:{month:i,day:n,year:n},long:{month:r,day:n,year:n},full:{month:r,day:n,year:n,weekday:r},default:{month:i,day:n,year:n}},time:{short:{hour:n,minute:n},medium:{hour:n,minute:n,second:n},long:{hour:n,minute:n,second:n,timeZoneName:i},full:{hour:n,minute:n,second:n,timeZoneName:i},default:{hour:n,minute:n,second:n}},duration:{default:{hours:{minimumIntegerDigits:1,maximumFractionDigits:0},minutes:{minimumIntegerDigits:2,maximumFractionDigits:0},seconds:{minimumIntegerDigits:2,maximumFractionDigits:3}}},parseNumberPattern:function(t){if(t){var e={},r=t.match(/\b[A-Z]{3}\b/i),i=t.replace(/[^¤]/g,"").length;if(!i&&r&&(i=1),i?(e.style="currency",e.currencyDisplay=1===i?"symbol":2===i?"code":"name",e.currency=r?r[0].toUpperCase():"USD"):t.indexOf("%")>=0&&(e.style="percent"),!/[@#0]/.test(t))return e.style?e:void 0;if(e.useGrouping=t.indexOf(",")>=0,/E\+?[@#0]+/i.test(t)||t.indexOf("@")>=0){var n=t.replace(/E\+?[@#0]+|[^@#0]/gi,"");e.minimumSignificantDigits=Math.min(Math.max(n.replace(/[^@0]/g,"").length,1),21),e.maximumSignificantDigits=Math.min(Math.max(n.length,1),21)}else{for(var s=t.replace(/[^#0.]/g,"").split("."),o=s[0],a=o.length-1;"0"===o[a];)--a;e.minimumIntegerDigits=Math.min(Math.max(o.length-1-a,1),21);var u=s[1]||"";for(a=0;"0"===u[a];)++a;for(e.minimumFractionDigits=Math.min(Math.max(a,0),20);"#"===u[a];)++a;e.maximumFractionDigits=Math.min(Math.max(a,0),20)}return e}},parseDatePattern:function(t){if(t){for(var e={},s=0;s<t.length;){for(var o=t[s],a=1;t[++s]===o;)++a;switch(o){case"G":e.era=5===a?"narrow":4===a?r:i;break;case"y":case"Y":e.year=2===a?"2-digit":n;break;case"M":case"L":a=Math.min(Math.max(a-1,0),4),e.month=[n,"2-digit",i,r,"narrow"][a];break;case"E":case"e":case"c":e.weekday=5===a?"narrow":4===a?r:i;break;case"d":case"D":e.day=2===a?"2-digit":n;break;case"h":case"K":e.hour12=!0,e.hour=2===a?"2-digit":n;break;case"H":case"k":e.hour12=!1,e.hour=2===a?"2-digit":n;break;case"m":e.minute=2===a?"2-digit":n;break;case"s":case"S":e.second=2===a?"2-digit":n;break;case"z":case"Z":case"v":case"V":e.timeZoneName=1===a?i:r}}return Object.keys(e).length?e:void 0}}}},443:function(t,e){t.exports=function(t,e){if("string"==typeof t&&e[t])return t;for(var r=[].concat(t||[]),i=0,n=r.length;i<n;++i)for(var s=r[i].split("-");s.length;){var o=s.join("-");if(e[o])return o;s.pop()}}},444:function(t,e,r){"use strict";var i="one",n="two",s="few",o="many",a="other",u=[function(t){return 1===+t?i:a},function(t){var e=+t;return 0<=e&&e<=1?i:a},function(t){return 0===Math.floor(Math.abs(+t))||1===+t?i:a},function(t){var e=+t;return 0===e?"zero":1===e?i:2===e?n:3<=e%100&&e%100<=10?s:11<=e%100&&e%100<=99?o:a},function(t){var e=Math.floor(Math.abs(+t)),r=(t+".").split(".")[1].length;return 1===e&&0===r?i:a},function(t){var e=+t;return e%10==1&&e%100!=11?i:2<=e%10&&e%10<=4&&(e%100<12||14<e%100)?s:e%10==0||5<=e%10&&e%10<=9||11<=e%100&&e%100<=14?o:a},function(t){var e=+t;return e%10==1&&e%100!=11&&e%100!=71&&e%100!=91?i:e%10==2&&e%100!=12&&e%100!=72&&e%100!=92?n:(3<=e%10&&e%10<=4||e%10==9)&&(e%100<10||19<e%100)&&(e%100<70||79<e%100)&&(e%100<90||99<e%100)?s:0!==e&&e%1e6==0?o:a},function(t){var e=Math.floor(Math.abs(+t)),r=(t+".").split(".")[1].length,n=+(t+".").split(".")[1];return 0===r&&e%10==1&&e%100!=11||n%10==1&&n%100!=11?i:0===r&&2<=e%10&&e%10<=4&&(e%100<12||14<e%100)||2<=n%10&&n%10<=4&&(n%100<12||14<n%100)?s:a},function(t){var e=Math.floor(Math.abs(+t)),r=(t+".").split(".")[1].length;return 1===e&&0===r?i:2<=e&&e<=4&&0===r?s:0!==r?o:a},function(t){var e=+t;return 0===e?"zero":1===e?i:2===e?n:3===e?s:6===e?o:a},function(t){var e=Math.floor(Math.abs(+t)),r=+(""+t).replace(/^[^.]*.?|0+$/g,"");return 1===+t||0!==r&&(0===e||1===e)?i:a},function(t){var e=Math.floor(Math.abs(+t)),r=(t+".").split(".")[1].length,o=+(t+".").split(".")[1];return 0===r&&e%100==1||o%100==1?i:0===r&&e%100==2||o%100==2?n:0===r&&3<=e%100&&e%100<=4||3<=o%100&&o%100<=4?s:a},function(t){var e=Math.floor(Math.abs(+t));return 0===e||1===e?i:a},function(t){var e=Math.floor(Math.abs(+t)),r=(t+".").split(".")[1].length,n=+(t+".").split(".")[1];return 0===r&&(1===e||2===e||3===e)||0===r&&e%10!=4&&e%10!=6&&e%10!=9||0!==r&&n%10!=4&&n%10!=6&&n%10!=9?i:a},function(t){var e=+t;return 1===e?i:2===e?n:3<=e&&e<=6?s:7<=e&&e<=10?o:a},function(t){var e=+t;return 1===e||11===e?i:2===e||12===e?n:3<=e&&e<=10||13<=e&&e<=19?s:a},function(t){var e=Math.floor(Math.abs(+t)),r=(t+".").split(".")[1].length;return 0===r&&e%10==1?i:0===r&&e%10==2?n:0!==r||e%100!=0&&e%100!=20&&e%100!=40&&e%100!=60&&e%100!=80?0!==r?o:a:s},function(t){var e=Math.floor(Math.abs(+t)),r=(t+".").split(".")[1].length,s=+t;return 1===e&&0===r?i:2===e&&0===r?n:0===r&&(s<0||10<s)&&s%10==0?o:a},function(t){var e=Math.floor(Math.abs(+t)),r=+(""+t).replace(/^[^.]*.?|0+$/g,"");return 0===r&&e%10==1&&e%100!=11||0!==r?i:a},function(t){var e=+t;return 1===e?i:2===e?n:a},function(t){var e=+t;return 0===e?"zero":1===e?i:a},function(t){var e=Math.floor(Math.abs(+t)),r=+t;return 0===r?"zero":0!==e&&1!==e||0===r?a:i},function(t){var e=+(t+".").split(".")[1],r=+t;return r%10==1&&(r%100<11||19<r%100)?i:2<=r%10&&r%10<=9&&(r%100<11||19<r%100)?s:0!==e?o:a},function(t){var e=(t+".").split(".")[1].length,r=+(t+".").split(".")[1],n=+t;return n%10==0||11<=n%100&&n%100<=19||2===e&&11<=r%100&&r%100<=19?"zero":n%10==1&&n%100!=11||2===e&&r%10==1&&r%100!=11||2!==e&&r%10==1?i:a},function(t){var e=Math.floor(Math.abs(+t)),r=(t+".").split(".")[1].length,n=+(t+".").split(".")[1];return 0===r&&e%10==1&&e%100!=11||n%10==1&&n%100!=11?i:a},function(t){var e=Math.floor(Math.abs(+t)),r=(t+".").split(".")[1].length,n=+t;return 1===e&&0===r?i:0!==r||0===n||1!==n&&1<=n%100&&n%100<=19?s:a},function(t){var e=+t;return 1===e?i:0===e||2<=e%100&&e%100<=10?s:11<=e%100&&e%100<=19?o:a},function(t){var e=Math.floor(Math.abs(+t)),r=(t+".").split(".")[1].length;return 1===e&&0===r?i:0===r&&2<=e%10&&e%10<=4&&(e%100<12||14<e%100)?s:0===r&&1!==e&&0<=e%10&&e%10<=1||0===r&&5<=e%10&&e%10<=9||0===r&&12<=e%100&&e%100<=14?o:a},function(t){var e=Math.floor(Math.abs(+t));return 0<=e&&e<=1?i:a},function(t){var e=Math.floor(Math.abs(+t)),r=(t+".").split(".")[1].length;return 0===r&&e%10==1&&e%100!=11?i:0===r&&2<=e%10&&e%10<=4&&(e%100<12||14<e%100)?s:0===r&&e%10==0||0===r&&5<=e%10&&e%10<=9||0===r&&11<=e%100&&e%100<=14?o:a},function(t){var e=+t;return 0===Math.floor(Math.abs(+t))||1===e?i:2<=e&&e<=10?s:a},function(t){var e=Math.floor(Math.abs(+t)),r=+(t+".").split(".")[1],n=+t;return 0===n||1===n||0===e&&1===r?i:a},function(t){var e=Math.floor(Math.abs(+t)),r=(t+".").split(".")[1].length;return 0===r&&e%100==1?i:0===r&&e%100==2?n:0===r&&3<=e%100&&e%100<=4||0!==r?s:a},function(t){var e=+t;return 0<=e&&e<=1||11<=e&&e<=99?i:a},function(t){var e=+t;return 1===e||5===e||7===e||8===e||9===e||10===e?i:2===e||3===e?n:4===e?s:6===e?o:a},function(t){var e=Math.floor(Math.abs(+t));return e%10==1||e%10==2||e%10==5||e%10==7||e%10==8||e%100==20||e%100==50||e%100==70||e%100==80?i:e%10==3||e%10==4||e%1e3==100||e%1e3==200||e%1e3==300||e%1e3==400||e%1e3==500||e%1e3==600||e%1e3==700||e%1e3==800||e%1e3==900?s:0===e||e%10==6||e%100==40||e%100==60||e%100==90?o:a},function(t){var e=+t;return e%10!=2&&e%10!=3||e%100==12||e%100==13?a:s},function(t){var e=+t;return 1===e||3===e?i:2===e?n:4===e?s:a},function(t){var e=+t;return 0===e||7===e||8===e||9===e?"zero":1===e?i:2===e?n:3===e||4===e?s:5===e||6===e?o:a},function(t){var e=+t;return e%10==1&&e%100!=11?i:e%10==2&&e%100!=12?n:e%10==3&&e%100!=13?s:a},function(t){var e=+t;return 1===e||11===e?i:2===e||12===e?n:3===e||13===e?s:a},function(t){var e=+t;return 1===e?i:2===e||3===e?n:4===e?s:6===e?o:a},function(t){var e=+t;return 1===e||5===e?i:a},function(t){var e=+t;return 11===e||8===e||80===e||800===e?o:a},function(t){var e=Math.floor(Math.abs(+t));return 1===e?i:0===e||2<=e%100&&e%100<=20||e%100==40||e%100==60||e%100==80?o:a},function(t){var e=+t;return e%10==6||e%10==9||e%10==0&&0!==e?o:a},function(t){var e=Math.floor(Math.abs(+t));return e%10==1&&e%100!=11?i:e%10==2&&e%100!=12?n:e%10!=7&&e%10!=8||e%100==17||e%100==18?a:o},function(t){var e=+t;return 1===e?i:2===e||3===e?n:4===e?s:a},function(t){var e=+t;return 1<=e&&e<=4?i:a},function(t){var e=+t;return 1===e||5===e||7<=e&&e<=9?i:2===e||3===e?n:4===e?s:6===e?o:a},function(t){var e=+t;return 1===e?i:e%10==4&&e%100!=14?o:a},function(t){var e=+t;return e%10!=1&&e%10!=2||e%100==11||e%100==12?a:i},function(t){var e=+t;return e%10==6||e%10==9||10===e?s:a},function(t){var e=+t;return e%10==3&&e%100!=13?s:a}];t.exports={af:{cardinal:u[0]},ak:{cardinal:u[1]},am:{cardinal:u[2]},ar:{cardinal:u[3]},ars:{cardinal:u[3]},as:{cardinal:u[2],ordinal:u[34]},asa:{cardinal:u[0]},ast:{cardinal:u[4]},az:{cardinal:u[0],ordinal:u[35]},be:{cardinal:u[5],ordinal:u[36]},bem:{cardinal:u[0]},bez:{cardinal:u[0]},bg:{cardinal:u[0]},bh:{cardinal:u[1]},bn:{cardinal:u[2],ordinal:u[34]},br:{cardinal:u[6]},brx:{cardinal:u[0]},bs:{cardinal:u[7]},ca:{cardinal:u[4],ordinal:u[37]},ce:{cardinal:u[0]},cgg:{cardinal:u[0]},chr:{cardinal:u[0]},ckb:{cardinal:u[0]},cs:{cardinal:u[8]},cy:{cardinal:u[9],ordinal:u[38]},da:{cardinal:u[10]},de:{cardinal:u[4]},dsb:{cardinal:u[11]},dv:{cardinal:u[0]},ee:{cardinal:u[0]},el:{cardinal:u[0]},en:{cardinal:u[4],ordinal:u[39]},eo:{cardinal:u[0]},es:{cardinal:u[0]},et:{cardinal:u[4]},eu:{cardinal:u[0]},fa:{cardinal:u[2]},ff:{cardinal:u[12]},fi:{cardinal:u[4]},fil:{cardinal:u[13],ordinal:u[0]},fo:{cardinal:u[0]},fr:{cardinal:u[12],ordinal:u[0]},fur:{cardinal:u[0]},fy:{cardinal:u[4]},ga:{cardinal:u[14],ordinal:u[0]},gd:{cardinal:u[15],ordinal:u[40]},gl:{cardinal:u[4]},gsw:{cardinal:u[0]},gu:{cardinal:u[2],ordinal:u[41]},guw:{cardinal:u[1]},gv:{cardinal:u[16]},ha:{cardinal:u[0]},haw:{cardinal:u[0]},he:{cardinal:u[17]},hi:{cardinal:u[2],ordinal:u[41]},hr:{cardinal:u[7]},hsb:{cardinal:u[11]},hu:{cardinal:u[0],ordinal:u[42]},hy:{cardinal:u[12],ordinal:u[0]},ia:{cardinal:u[4]},io:{cardinal:u[4]},is:{cardinal:u[18]},it:{cardinal:u[4],ordinal:u[43]},iu:{cardinal:u[19]},iw:{cardinal:u[17]},jgo:{cardinal:u[0]},ji:{cardinal:u[4]},jmc:{cardinal:u[0]},ka:{cardinal:u[0],ordinal:u[44]},kab:{cardinal:u[12]},kaj:{cardinal:u[0]},kcg:{cardinal:u[0]},kk:{cardinal:u[0],ordinal:u[45]},kkj:{cardinal:u[0]},kl:{cardinal:u[0]},kn:{cardinal:u[2]},ks:{cardinal:u[0]},ksb:{cardinal:u[0]},ksh:{cardinal:u[20]},ku:{cardinal:u[0]},kw:{cardinal:u[19]},ky:{cardinal:u[0]},lag:{cardinal:u[21]},lb:{cardinal:u[0]},lg:{cardinal:u[0]},ln:{cardinal:u[1]},lt:{cardinal:u[22]},lv:{cardinal:u[23]},mas:{cardinal:u[0]},mg:{cardinal:u[1]},mgo:{cardinal:u[0]},mk:{cardinal:u[24],ordinal:u[46]},ml:{cardinal:u[0]},mn:{cardinal:u[0]},mo:{cardinal:u[25],ordinal:u[0]},mr:{cardinal:u[2],ordinal:u[47]},mt:{cardinal:u[26]},nah:{cardinal:u[0]},naq:{cardinal:u[19]},nb:{cardinal:u[0]},nd:{cardinal:u[0]},ne:{cardinal:u[0],ordinal:u[48]},nl:{cardinal:u[4]},nn:{cardinal:u[0]},nnh:{cardinal:u[0]},no:{cardinal:u[0]},nr:{cardinal:u[0]},nso:{cardinal:u[1]},ny:{cardinal:u[0]},nyn:{cardinal:u[0]},om:{cardinal:u[0]},or:{cardinal:u[0],ordinal:u[49]},os:{cardinal:u[0]},pa:{cardinal:u[1]},pap:{cardinal:u[0]},pl:{cardinal:u[27]},prg:{cardinal:u[23]},ps:{cardinal:u[0]},pt:{cardinal:u[28]},"pt-PT":{cardinal:u[4]},rm:{cardinal:u[0]},ro:{cardinal:u[25],ordinal:u[0]},rof:{cardinal:u[0]},ru:{cardinal:u[29]},rwk:{cardinal:u[0]},saq:{cardinal:u[0]},sc:{cardinal:u[4],ordinal:u[43]},scn:{cardinal:u[4],ordinal:u[43]},sd:{cardinal:u[0]},sdh:{cardinal:u[0]},se:{cardinal:u[19]},seh:{cardinal:u[0]},sh:{cardinal:u[7]},shi:{cardinal:u[30]},si:{cardinal:u[31]},sk:{cardinal:u[8]},sl:{cardinal:u[32]},sma:{cardinal:u[19]},smi:{cardinal:u[19]},smj:{cardinal:u[19]},smn:{cardinal:u[19]},sms:{cardinal:u[19]},sn:{cardinal:u[0]},so:{cardinal:u[0]},sq:{cardinal:u[0],ordinal:u[50]},sr:{cardinal:u[7]},ss:{cardinal:u[0]},ssy:{cardinal:u[0]},st:{cardinal:u[0]},sv:{cardinal:u[4],ordinal:u[51]},sw:{cardinal:u[4]},syr:{cardinal:u[0]},ta:{cardinal:u[0]},te:{cardinal:u[0]},teo:{cardinal:u[0]},ti:{cardinal:u[1]},tig:{cardinal:u[0]},tk:{cardinal:u[0],ordinal:u[52]},tl:{cardinal:u[13],ordinal:u[0]},tn:{cardinal:u[0]},tr:{cardinal:u[0]},ts:{cardinal:u[0]},tzm:{cardinal:u[33]},ug:{cardinal:u[0]},uk:{cardinal:u[29],ordinal:u[53]},ur:{cardinal:u[4]},uz:{cardinal:u[0]},ve:{cardinal:u[0]},vo:{cardinal:u[0]},vun:{cardinal:u[0]},wa:{cardinal:u[1]},wae:{cardinal:u[0]},xh:{cardinal:u[0]},xog:{cardinal:u[0]},yi:{cardinal:u[4]},zu:{cardinal:u[2]},lo:{ordinal:u[0]},ms:{ordinal:u[0]},vi:{ordinal:u[0]}}},445:function(t,e){t.exports={BOOLEAN:"Boolean",BUTTON:"button",COMMAND:"command",CONDITIONAL:"conditional",EVENT:"event",HAT:"hat",LOOP:"loop",REPORTER:"reporter"}},446:function(t,e,r){const i=r(156),n=r(914),s=function(t){const e=Object.create(null);e.tagName=t.name,e.children=[];for(const r in t.attribs)"xmlns"!==r&&(e[r]=n(t.attribs[r]),"blockinfo"===r&&(e.blockInfo=JSON.parse(e.blockinfo),delete e.blockinfo));for(let r=0;r<t.children.length;r++)e.children.push(s(t.children[r]));return e};t.exports=function(t){let e;return e="object"==typeof t?t:i.parseDOM(t)[0],s(e)}},447:function(t,e,r){var i=r(448),n={input:!0,option:!0,optgroup:!0,select:!0,button:!0,datalist:!0,textarea:!0},s={tr:{tr:!0,th:!0,td:!0},th:{th:!0},td:{thead:!0,th:!0,td:!0},body:{head:!0,link:!0,script:!0},li:{li:!0},p:{p:!0},h1:{p:!0},h2:{p:!0},h3:{p:!0},h4:{p:!0},h5:{p:!0},h6:{p:!0},select:n,input:n,output:n,button:n,datalist:n,textarea:n,option:{option:!0},optgroup:{optgroup:!0}},o={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},a={__proto__:null,math:!0,svg:!0},u={__proto__:null,mi:!0,mo:!0,mn:!0,ms:!0,mtext:!0,"annotation-xml":!0,foreignObject:!0,desc:!0,title:!0},c=/\s|\//;function h(t,e){this._options=e||{},this._cbs=t||{},this._tagname="",this._attribname="",this._attribvalue="",this._attribs=null,this._stack=[],this._foreignContext=[],this.startIndex=0,this.endIndex=null,this._lowerCaseTagNames="lowerCaseTags"in this._options?!!this._options.lowerCaseTags:!this._options.xmlMode,this._lowerCaseAttributeNames="lowerCaseAttributeNames"in this._options?!!this._options.lowerCaseAttributeNames:!this._options.xmlMode,this._options.Tokenizer&&(i=this._options.Tokenizer),this._tokenizer=new i(this._options,this),this._cbs.onparserinit&&this._cbs.onparserinit(this)}r(27)(h,r(40).EventEmitter),h.prototype._updatePosition=function(t){null===this.endIndex?this._tokenizer._sectionStart<=t?this.startIndex=0:this.startIndex=this._tokenizer._sectionStart-t:this.startIndex=this.endIndex+1,this.endIndex=this._tokenizer.getAbsoluteIndex()},h.prototype.ontext=function(t){this._updatePosition(1),this.endIndex--,this._cbs.ontext&&this._cbs.ontext(t)},h.prototype.onopentagname=function(t){if(this._lowerCaseTagNames&&(t=t.toLowerCase()),this._tagname=t,!this._options.xmlMode&&t in s)for(var e;(e=this._stack[this._stack.length-1])in s[t];this.onclosetag(e));!this._options.xmlMode&&t in o||(this._stack.push(t),t in a?this._foreignContext.push(!0):t in u&&this._foreignContext.push(!1)),this._cbs.onopentagname&&this._cbs.onopentagname(t),this._cbs.onopentag&&(this._attribs={})},h.prototype.onopentagend=function(){this._updatePosition(1),this._attribs&&(this._cbs.onopentag&&this._cbs.onopentag(this._tagname,this._attribs),this._attribs=null),!this._options.xmlMode&&this._cbs.onclosetag&&this._tagname in o&&this._cbs.onclosetag(this._tagname),this._tagname=""},h.prototype.onclosetag=function(t){if(this._updatePosition(1),this._lowerCaseTagNames&&(t=t.toLowerCase()),!this._stack.length||t in o&&!this._options.xmlMode)this._options.xmlMode||"br"!==t&&"p"!==t||(this.onopentagname(t),this._closeCurrentTag());else{var e=this._stack.lastIndexOf(t);if(-1!==e)if(this._cbs.onclosetag)for(e=this._stack.length-e;e--;)this._cbs.onclosetag(this._stack.pop());else this._stack.length=e;else"p"!==t||this._options.xmlMode||(this.onopentagname(t),this._closeCurrentTag())}},h.prototype.onselfclosingtag=function(){this._options.xmlMode||this._options.recognizeSelfClosing||this._foreignContext[this._foreignContext.length-1]?this._closeCurrentTag():this.onopentagend()},h.prototype._closeCurrentTag=function(){var t=this._tagname;this.onopentagend(),this._stack[this._stack.length-1]===t&&(this._cbs.onclosetag&&this._cbs.onclosetag(t),this._stack.pop(),(t in a||t in u)&&this._foreignContext.pop())},h.prototype.onattribname=function(t){this._lowerCaseAttributeNames&&(t=t.toLowerCase()),this._attribname=t},h.prototype.onattribdata=function(t){this._attribvalue+=t},h.prototype.onattribend=function(){this._cbs.onattribute&&this._cbs.onattribute(this._attribname,this._attribvalue),this._attribs&&!Object.prototype.hasOwnProperty.call(this._attribs,this._attribname)&&(this._attribs[this._attribname]=this._attribvalue),this._attribname="",this._attribvalue=""},h.prototype._getInstructionName=function(t){var e=t.search(c),r=e<0?t:t.substr(0,e);return this._lowerCaseTagNames&&(r=r.toLowerCase()),r},h.prototype.ondeclaration=function(t){if(this._cbs.onprocessinginstruction){var e=this._getInstructionName(t);this._cbs.onprocessinginstruction("!"+e,"!"+t)}},h.prototype.onprocessinginstruction=function(t){if(this._cbs.onprocessinginstruction){var e=this._getInstructionName(t);this._cbs.onprocessinginstruction("?"+e,"?"+t)}},h.prototype.oncomment=function(t){this._updatePosition(4),this._cbs.oncomment&&this._cbs.oncomment(t),this._cbs.oncommentend&&this._cbs.oncommentend()},h.prototype.oncdata=function(t){this._updatePosition(1),this._options.xmlMode||this._options.recognizeCDATA?(this._cbs.oncdatastart&&this._cbs.oncdatastart(),this._cbs.ontext&&this._cbs.ontext(t),this._cbs.oncdataend&&this._cbs.oncdataend()):this.oncomment("[CDATA["+t+"]]")},h.prototype.onerror=function(t){this._cbs.onerror&&this._cbs.onerror(t)},h.prototype.onend=function(){if(this._cbs.onclosetag)for(var t=this._stack.length;t>0;this._cbs.onclosetag(this._stack[--t]));this._cbs.onend&&this._cbs.onend()},h.prototype.reset=function(){this._cbs.onreset&&this._cbs.onreset(),this._tokenizer.reset(),this._tagname="",this._attribname="",this._attribs=null,this._stack=[],this._cbs.onparserinit&&this._cbs.onparserinit(this)},h.prototype.parseComplete=function(t){this.reset(),this.end(t)},h.prototype.write=function(t){this._tokenizer.write(t)},h.prototype.end=function(t){this._tokenizer.end(t)},h.prototype.pause=function(){this._tokenizer.pause()},h.prototype.resume=function(){this._tokenizer.resume()},h.prototype.parseChunk=h.prototype.write,h.prototype.done=h.prototype.end,t.exports=h},448:function(t,e,r){t.exports=ft;var i=r(888),n=r(890),s=r(891),o=r(892),a=0,u=a++,c=a++,h=a++,l=a++,p=a++,d=a++,m=a++,_=a++,f=a++,g=a++,b=a++,y=a++,T=a++,v=a++,S=a++,E=a++,O=a++,I=a++,k=a++,w=a++,N=a++,A=a++,x=a++,C=a++,M=a++,P=a++,R=a++,D=a++,B=a++,L=a++,U=a++,F=a++,V=a++,z=a++,j=a++,G=a++,Y=a++,q=a++,$=a++,H=a++,W=a++,K=a++,X=a++,J=a++,Q=a++,Z=a++,tt=a++,et=a++,rt=a++,it=a++,nt=a++,st=a++,ot=a++,at=a++,ut=a++,ct=0,ht=ct++,lt=ct++,pt=ct++;function dt(t){return" "===t||"\n"===t||"\t"===t||"\f"===t||"\r"===t}function mt(t,e,r){var i=t.toLowerCase();return t===i?function(t){t===i?this._state=e:(this._state=r,this._index--)}:function(n){n===i||n===t?this._state=e:(this._state=r,this._index--)}}function _t(t,e){var r=t.toLowerCase();return function(i){i===r||i===t?this._state=e:(this._state=h,this._index--)}}function ft(t,e){this._state=u,this._buffer="",this._sectionStart=0,this._index=0,this._bufferOffset=0,this._baseState=u,this._special=ht,this._cbs=e,this._running=!0,this._ended=!1,this._xmlMode=!(!t||!t.xmlMode),this._decodeEntities=!(!t||!t.decodeEntities)}ft.prototype._stateText=function(t){"<"===t?(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._state=c,this._sectionStart=this._index):this._decodeEntities&&this._special===ht&&"&"===t&&(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._baseState=u,this._state=nt,this._sectionStart=this._index)},ft.prototype._stateBeforeTagName=function(t){"/"===t?this._state=p:"<"===t?(this._cbs.ontext(this._getSection()),this._sectionStart=this._index):">"===t||this._special!==ht||dt(t)?this._state=u:"!"===t?(this._state=S,this._sectionStart=this._index+1):"?"===t?(this._state=O,this._sectionStart=this._index+1):(this._state=this._xmlMode||"s"!==t&&"S"!==t?h:U,this._sectionStart=this._index)},ft.prototype._stateInTagName=function(t){("/"===t||">"===t||dt(t))&&(this._emitToken("onopentagname"),this._state=_,this._index--)},ft.prototype._stateBeforeCloseingTagName=function(t){dt(t)||(">"===t?this._state=u:this._special!==ht?"s"===t||"S"===t?this._state=F:(this._state=u,this._index--):(this._state=d,this._sectionStart=this._index))},ft.prototype._stateInCloseingTagName=function(t){(">"===t||dt(t))&&(this._emitToken("onclosetag"),this._state=m,this._index--)},ft.prototype._stateAfterCloseingTagName=function(t){">"===t&&(this._state=u,this._sectionStart=this._index+1)},ft.prototype._stateBeforeAttributeName=function(t){">"===t?(this._cbs.onopentagend(),this._state=u,this._sectionStart=this._index+1):"/"===t?this._state=l:dt(t)||(this._state=f,this._sectionStart=this._index)},ft.prototype._stateInSelfClosingTag=function(t){">"===t?(this._cbs.onselfclosingtag(),this._state=u,this._sectionStart=this._index+1):dt(t)||(this._state=_,this._index--)},ft.prototype._stateInAttributeName=function(t){("="===t||"/"===t||">"===t||dt(t))&&(this._cbs.onattribname(this._getSection()),this._sectionStart=-1,this._state=g,this._index--)},ft.prototype._stateAfterAttributeName=function(t){"="===t?this._state=b:"/"===t||">"===t?(this._cbs.onattribend(),this._state=_,this._index--):dt(t)||(this._cbs.onattribend(),this._state=f,this._sectionStart=this._index)},ft.prototype._stateBeforeAttributeValue=function(t){'"'===t?(this._state=y,this._sectionStart=this._index+1):"'"===t?(this._state=T,this._sectionStart=this._index+1):dt(t)||(this._state=v,this._sectionStart=this._index,this._index--)},ft.prototype._stateInAttributeValueDoubleQuotes=function(t){'"'===t?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=_):this._decodeEntities&&"&"===t&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=nt,this._sectionStart=this._index)},ft.prototype._stateInAttributeValueSingleQuotes=function(t){"'"===t?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=_):this._decodeEntities&&"&"===t&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=nt,this._sectionStart=this._index)},ft.prototype._stateInAttributeValueNoQuotes=function(t){dt(t)||">"===t?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=_,this._index--):this._decodeEntities&&"&"===t&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=nt,this._sectionStart=this._index)},ft.prototype._stateBeforeDeclaration=function(t){this._state="["===t?A:"-"===t?I:E},ft.prototype._stateInDeclaration=function(t){">"===t&&(this._cbs.ondeclaration(this._getSection()),this._state=u,this._sectionStart=this._index+1)},ft.prototype._stateInProcessingInstruction=function(t){">"===t&&(this._cbs.onprocessinginstruction(this._getSection()),this._state=u,this._sectionStart=this._index+1)},ft.prototype._stateBeforeComment=function(t){"-"===t?(this._state=k,this._sectionStart=this._index+1):this._state=E},ft.prototype._stateInComment=function(t){"-"===t&&(this._state=w)},ft.prototype._stateAfterComment1=function(t){this._state="-"===t?N:k},ft.prototype._stateAfterComment2=function(t){">"===t?(this._cbs.oncomment(this._buffer.substring(this._sectionStart,this._index-2)),this._state=u,this._sectionStart=this._index+1):"-"!==t&&(this._state=k)},ft.prototype._stateBeforeCdata1=mt("C",x,E),ft.prototype._stateBeforeCdata2=mt("D",C,E),ft.prototype._stateBeforeCdata3=mt("A",M,E),ft.prototype._stateBeforeCdata4=mt("T",P,E),ft.prototype._stateBeforeCdata5=mt("A",R,E),ft.prototype._stateBeforeCdata6=function(t){"["===t?(this._state=D,this._sectionStart=this._index+1):(this._state=E,this._index--)},ft.prototype._stateInCdata=function(t){"]"===t&&(this._state=B)},ft.prototype._stateAfterCdata1=function(t){this._state="]"===t?L:D},ft.prototype._stateAfterCdata2=function(t){">"===t?(this._cbs.oncdata(this._buffer.substring(this._sectionStart,this._index-2)),this._state=u,this._sectionStart=this._index+1):"]"!==t&&(this._state=D)},ft.prototype._stateBeforeSpecial=function(t){"c"===t||"C"===t?this._state=V:"t"===t||"T"===t?this._state=X:(this._state=h,this._index--)},ft.prototype._stateBeforeSpecialEnd=function(t){this._special!==lt||"c"!==t&&"C"!==t?this._special!==pt||"t"!==t&&"T"!==t?this._state=u:this._state=tt:this._state=q},ft.prototype._stateBeforeScript1=_t("R",z),ft.prototype._stateBeforeScript2=_t("I",j),ft.prototype._stateBeforeScript3=_t("P",G),ft.prototype._stateBeforeScript4=_t("T",Y),ft.prototype._stateBeforeScript5=function(t){("/"===t||">"===t||dt(t))&&(this._special=lt),this._state=h,this._index--},ft.prototype._stateAfterScript1=mt("R",$,u),ft.prototype._stateAfterScript2=mt("I",H,u),ft.prototype._stateAfterScript3=mt("P",W,u),ft.prototype._stateAfterScript4=mt("T",K,u),ft.prototype._stateAfterScript5=function(t){">"===t||dt(t)?(this._special=ht,this._state=d,this._sectionStart=this._index-6,this._index--):this._state=u},ft.prototype._stateBeforeStyle1=_t("Y",J),ft.prototype._stateBeforeStyle2=_t("L",Q),ft.prototype._stateBeforeStyle3=_t("E",Z),ft.prototype._stateBeforeStyle4=function(t){("/"===t||">"===t||dt(t))&&(this._special=pt),this._state=h,this._index--},ft.prototype._stateAfterStyle1=mt("Y",et,u),ft.prototype._stateAfterStyle2=mt("L",rt,u),ft.prototype._stateAfterStyle3=mt("E",it,u),ft.prototype._stateAfterStyle4=function(t){">"===t||dt(t)?(this._special=ht,this._state=d,this._sectionStart=this._index-5,this._index--):this._state=u},ft.prototype._stateBeforeEntity=mt("#",st,ot),ft.prototype._stateBeforeNumericEntity=mt("X",ut,at),ft.prototype._parseNamedEntityStrict=function(){if(this._sectionStart+1<this._index){var t=this._buffer.substring(this._sectionStart+1,this._index),e=this._xmlMode?o:n;e.hasOwnProperty(t)&&(this._emitPartial(e[t]),this._sectionStart=this._index+1)}},ft.prototype._parseLegacyEntity=function(){var t=this._sectionStart+1,e=this._index-t;for(e>6&&(e=6);e>=2;){var r=this._buffer.substr(t,e);if(s.hasOwnProperty(r))return this._emitPartial(s[r]),void(this._sectionStart+=e+1);e--}},ft.prototype._stateInNamedEntity=function(t){";"===t?(this._parseNamedEntityStrict(),this._sectionStart+1<this._index&&!this._xmlMode&&this._parseLegacyEntity(),this._state=this._baseState):(t<"a"||t>"z")&&(t<"A"||t>"Z")&&(t<"0"||t>"9")&&(this._xmlMode||this._sectionStart+1===this._index||(this._baseState!==u?"="!==t&&this._parseNamedEntityStrict():this._parseLegacyEntity()),this._state=this._baseState,this._index--)},ft.prototype._decodeNumericEntity=function(t,e){var r=this._sectionStart+t;if(r!==this._index){var n=this._buffer.substring(r,this._index),s=parseInt(n,e);this._emitPartial(i(s)),this._sectionStart=this._index}else this._sectionStart--;this._state=this._baseState},ft.prototype._stateInNumericEntity=function(t){";"===t?(this._decodeNumericEntity(2,10),this._sectionStart++):(t<"0"||t>"9")&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(2,10),this._index--)},ft.prototype._stateInHexEntity=function(t){";"===t?(this._decodeNumericEntity(3,16),this._sectionStart++):(t<"a"||t>"f")&&(t<"A"||t>"F")&&(t<"0"||t>"9")&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(3,16),this._index--)},ft.prototype._cleanup=function(){this._sectionStart<0?(this._buffer="",this._bufferOffset+=this._index,this._index=0):this._running&&(this._state===u?(this._sectionStart!==this._index&&this._cbs.ontext(this._buffer.substr(this._sectionStart)),this._buffer="",this._bufferOffset+=this._index,this._index=0):this._sectionStart===this._index?(this._buffer="",this._bufferOffset+=this._index,this._index=0):(this._buffer=this._buffer.substr(this._sectionStart),this._index-=this._sectionStart,this._bufferOffset+=this._sectionStart),this._sectionStart=0)},ft.prototype.write=function(t){this._ended&&this._cbs.onerror(Error(".write() after done!")),this._buffer+=t,this._parse()},ft.prototype._parse=function(){for(;this._index<this._buffer.length&&this._running;){var t=this._buffer.charAt(this._index);this._state===u?this._stateText(t):this._state===c?this._stateBeforeTagName(t):this._state===h?this._stateInTagName(t):this._state===p?this._stateBeforeCloseingTagName(t):this._state===d?this._stateInCloseingTagName(t):this._state===m?this._stateAfterCloseingTagName(t):this._state===l?this._stateInSelfClosingTag(t):this._state===_?this._stateBeforeAttributeName(t):this._state===f?this._stateInAttributeName(t):this._state===g?this._stateAfterAttributeName(t):this._state===b?this._stateBeforeAttributeValue(t):this._state===y?this._stateInAttributeValueDoubleQuotes(t):this._state===T?this._stateInAttributeValueSingleQuotes(t):this._state===v?this._stateInAttributeValueNoQuotes(t):this._state===S?this._stateBeforeDeclaration(t):this._state===E?this._stateInDeclaration(t):this._state===O?this._stateInProcessingInstruction(t):this._state===I?this._stateBeforeComment(t):this._state===k?this._stateInComment(t):this._state===w?this._stateAfterComment1(t):this._state===N?this._stateAfterComment2(t):this._state===A?this._stateBeforeCdata1(t):this._state===x?this._stateBeforeCdata2(t):this._state===C?this._stateBeforeCdata3(t):this._state===M?this._stateBeforeCdata4(t):this._state===P?this._stateBeforeCdata5(t):this._state===R?this._stateBeforeCdata6(t):this._state===D?this._stateInCdata(t):this._state===B?this._stateAfterCdata1(t):this._state===L?this._stateAfterCdata2(t):this._state===U?this._stateBeforeSpecial(t):this._state===F?this._stateBeforeSpecialEnd(t):this._state===V?this._stateBeforeScript1(t):this._state===z?this._stateBeforeScript2(t):this._state===j?this._stateBeforeScript3(t):this._state===G?this._stateBeforeScript4(t):this._state===Y?this._stateBeforeScript5(t):this._state===q?this._stateAfterScript1(t):this._state===$?this._stateAfterScript2(t):this._state===H?this._stateAfterScript3(t):this._state===W?this._stateAfterScript4(t):this._state===K?this._stateAfterScript5(t):this._state===X?this._stateBeforeStyle1(t):this._state===J?this._stateBeforeStyle2(t):this._state===Q?this._stateBeforeStyle3(t):this._state===Z?this._stateBeforeStyle4(t):this._state===tt?this._stateAfterStyle1(t):this._state===et?this._stateAfterStyle2(t):this._state===rt?this._stateAfterStyle3(t):this._state===it?this._stateAfterStyle4(t):this._state===nt?this._stateBeforeEntity(t):this._state===st?this._stateBeforeNumericEntity(t):this._state===ot?this._stateInNamedEntity(t):this._state===at?this._stateInNumericEntity(t):this._state===ut?this._stateInHexEntity(t):this._cbs.onerror(Error("unknown _state"),this._state),this._index++}this._cleanup()},ft.prototype.pause=function(){this._running=!1},ft.prototype.resume=function(){this._running=!0,this._index<this._buffer.length&&this._parse(),this._ended&&this._finish()},ft.prototype.end=function(t){this._ended&&this._cbs.onerror(Error(".end() after done!")),t&&this.write(t),this._ended=!0,this._running&&this._finish()},ft.prototype._finish=function(){this._sectionStart<this._index&&this._handleTrailingData(),this._cbs.onend()},ft.prototype._handleTrailingData=function(){var t=this._buffer.substr(this._sectionStart);this._state===D||this._state===B||this._state===L?this._cbs.oncdata(t):this._state===k||this._state===w||this._state===N?this._cbs.oncomment(t):this._state!==ot||this._xmlMode?this._state!==at||this._xmlMode?this._state!==ut||this._xmlMode?this._state!==h&&this._state!==_&&this._state!==b&&this._state!==g&&this._state!==f&&this._state!==T&&this._state!==y&&this._state!==v&&this._state!==d&&this._cbs.ontext(t):(this._decodeNumericEntity(3,16),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._decodeNumericEntity(2,10),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._parseLegacyEntity(),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData()))},ft.prototype.reset=function(){ft.call(this,{xmlMode:this._xmlMode,decodeEntities:this._decodeEntities},this._cbs)},ft.prototype.getAbsoluteIndex=function(){return this._bufferOffset+this._index},ft.prototype._getSection=function(){return this._buffer.substring(this._sectionStart,this._index)},ft.prototype._emitToken=function(t){this._cbs[t](this._getSection()),this._sectionStart=-1},ft.prototype._emitPartial=function(t){this._baseState!==u?this._cbs.onattribdata(t):this._cbs.ontext(t)}},450:function(t,e,r){t.exports=a;var i=r(447),n=r(897).Writable,s=r(201).StringDecoder,o=r(24).Buffer;function a(t,e){var r=this._parser=new i(t,e),o=this._decoder=new s;n.call(this,{decodeStrings:!1}),this.once("finish",(function(){r.end(o.end())}))}r(27)(a,n),n.prototype._write=function(t,e,r){t instanceof o&&(t=this._decoder.write(t)),this._parser.write(t),r()}},455:function(t,e,r){e.getCached=function(){throw new Error("blocks.js has not initialized BlocksExecuteCache")},r(135)},456:function(t,e,r){e.getScripts=function(){throw new Error("blocks.js has not initialized BlocksRuntimeCache")},e._RuntimeScriptCache=class{constructor(t,e){this.container=t,this.blockId=e;const r=t.getBlock(e),i=t.getFields(r);if(this.fieldsOfInputs=Object.assign({},i),0===Object.keys(i).length){const e=t.getInputs(r);for(const r in e){if(!e.hasOwnProperty(r))continue;const i=e[r].block,n=t.getBlock(i),s=t.getFields(n);Object.assign(this.fieldsOfInputs,s)}}for(const t in this.fieldsOfInputs){const e=this.fieldsOfInputs[t]=Object.assign({},this.fieldsOfInputs[t]);e.value.toUpperCase&&(e.value=e.value.toUpperCase())}}},r(135)},457:function(t,e,r){const i=r(917),n=r(455),s=r(59),o=r(209),{Map:a}=r(175),u=r(90),c=new i;let h=-1;const l=function(t,e,r,i,n){const s=i.id,u=i.opcode,c=i._isHat;if(r.pushReportedValue(t),c)if(e.runtime.getIsEdgeActivatedHat(u)){if(!r.stackClick){const i=r.target.hasEdgeActivatedValue(s),n=r.target.updateEdgeActivatedValue(s,t);(i?!n&&t:t)||e.retireThread(r)}}else t?r.status=o.STATUS_RUNNING:e.retireThread(r);else{if(n&&void 0!==t&&r.atStackTop()&&(r.stackClick&&e.runtime.visualReport(s,t),r.updateMonitor)){const r=e.runtime.monitorBlocks.getBlock(s),i=r&&r.targetId;if(i&&!e.runtime.getTargetById(i))return;e.runtime.requestUpdateMonitor(a({id:s,spriteName:i?e.runtime.getTargetById(i).getName():null,value:t}))}r.status=o.STATUS_RUNNING}},p=(t,e,r,i,n)=>{r.status===o.STATUS_RUNNING&&(r.status=o.STATUS_PROMISE_WAIT),t.then(t=>{if(l(t,e,r,i,n),n&&(void 0===t||!0===t&&i._isHat)){let t,e;do{const i=r.popStack();if(null===i)return;if(e=r.target.blocks.getNextBlock(i),null!==e)break;t=r.peekStackFrame()}while(null!==t&&!t.isLoop);r.pushStack(e)}else n&&!i._parentKey&&r.popStack()},t=>{s.warn("Primitive rejected promise: ",t),r.status=o.STATUS_RUNNING,r.popStack()})};class d{constructor(t,e){this.id=e.id,this.opcode=e.opcode,this.fields=e.fields,this.inputs=e.inputs,this.mutation=e.mutation,this._profiler=null,this._profilerFrame=null,this._isHat=!1,this._blockFunction=null,this._definedBlockFunction=!1,this._isShadowBlock=!1,this._shadowValue=null,this._fields=Object.assign({},this.fields),this._inputs=Object.assign({},this.inputs),this._argValues={mutation:this.mutation},this._parentKey=null,this._parentValues=null,this._shadowOps=[],this._ops=[];const{runtime:r}=c.sequencer,{opcode:i,fields:s,inputs:o}=this;this._isHat=r.getIsHat(i),this._blockFunction=r.getOpcodeFunction(i),this._definedBlockFunction=void 0!==this._blockFunction;const a=Object.keys(s);this._isShadowBlock=!this._definedBlockFunction&&1===a.length&&0===Object.keys(o).length,this._shadowValue=this._isShadowBlock&&s[a[0]].value;for(const t in s)this._argValues[t]="VARIABLE"===t||"LIST"===t||"BROADCAST_OPTION"===t?{id:s[t].id,name:s[t].value}:s[t].value;if(delete this._inputs.custom_block,"BROADCAST_INPUT"in this._inputs){this._argValues.BROADCAST_OPTION={id:null,name:null};const e=this._inputs.BROADCAST_INPUT;if(e.block===e.shadow){const r=t.getBlock(e.shadow).fields.BROADCAST_OPTION;this._argValues.BROADCAST_OPTION.id=r.id,this._argValues.BROADCAST_OPTION.name=r.value,delete this._inputs.BROADCAST_INPUT}}for(const e in this._inputs){const r=this._inputs[e];if(r.block){const i=n.getCached(t,r.block,d);if(i._isHat)continue;this._shadowOps.push(...i._shadowOps),this._ops.push(...i._ops),i._parentKey=e,i._parentValues=this._argValues,i._isShadowBlock&&(this._argValues[e]=i._shadowValue)}}!this._isHat&&this._isShadowBlock?this._shadowOps.push(this):this._definedBlockFunction&&this._ops.push(this)}}t.exports=function(t,e){const r=t.runtime;c.sequencer=t,c.thread=e;const i=e.peekStack(),s=e.peekStackFrame();let a=e.blockContainer,m=n.getCached(a,i,d);if(null===m&&(a=r.flyoutBlocks,m=n.getCached(a,i,d),null===m))return void t.retireThread(e);const _=m._ops,f=_.length;let g=0;if(null!==s.reported){const t=s.reported;for(;g<t.length;g++){const{opCached:e,inputValue:r}=t[g],i=_.find(t=>t.id===e);if(i){const t=i._parentKey,e=i._parentValues;"BROADCAST_INPUT"===t?(e.BROADCAST_OPTION.id=null,e.BROADCAST_OPTION.name=u.toString(r)):e[t]=r}}if(t.length>0){const e=t.reverse().find(t=>_.find(e=>e.id===t.opCached));g=e?_.findIndex(t=>t.id===e.opCached)+1:0}if(null!==e.justReported&&_[g]&&_[g].id===s.reporting){const t=_[g],r=e.justReported;e.justReported=null;const i=t._parentKey,n=t._parentValues;"BROADCAST_INPUT"===i?(n.BROADCAST_OPTION.id=null,n.BROADCAST_OPTION.name=u.toString(r)):n[i]=r,g+=1}s.reporting=null,s.reported=null}const b=g;for(;g<f;g++){const r=g===f-1,i=_[g],n=i._blockFunction,h=i._argValues;a.forceNoGlow||(e.requestScriptGlowInFrame=!0);const d=n(h,c);if(null!==(y=d)&&"object"==typeof y&&"function"==typeof y.then){p(d,t,e,i,r),e.justReported=null,s.reporting=_[g].id,s.reported=_.slice(0,g).map(t=>{const e=t._parentKey,r=t._parentValues;return"BROADCAST_INPUT"===e?{opCached:t.id,inputValue:r[e].BROADCAST_OPTION.name}:{opCached:t.id,inputValue:r[e]}});break}if(e.status===o.STATUS_RUNNING)if(r)l(d,t,e,i,r);else{const t=i._parentKey,e=i._parentValues;"BROADCAST_INPUT"===t?(e.BROADCAST_OPTION.id=null,e.BROADCAST_OPTION.name=u.toString(d)):e[t]=d}}var y;if(null!==r.profiler){m._profiler!==r.profiler&&function(t,e){e._profiler=t,-1===h&&(h=t.idByName("blockFunction"));const r=e._ops;for(let e=0;e<r.length;e++)r[e]._profilerFrame=t.frame(h,r[e].opcode)}(r.profiler,m);const t=Math.min(g+1,f);for(let e=b;e<t;e++)_[e]._profilerFrame.count+=1}}},486:function(t,e,r){const i=r(293),n=r(135),{loadSoundFromAsset:s}=r(211),{loadCostumeFromAsset:o}=r(210),a=r(460),u=r(110),c=r(136);class h{constructor(t,e){this.runtime=e,t||(t=new n(e)),this.blocks=t,this.name="",this.costumes_=[],this.sounds=[],this.clones=[],this.soundBank=null,this.runtime&&this.runtime.audioEngine&&(this.soundBank=this.runtime.audioEngine.createBank())}set costumes(t){this.costumes_=[];for(const e of t)this.addCostumeAt(e,this.costumes_.length)}get costumes(){return this.costumes_}addCostumeAt(t,e){t.name||(t.name="");const r=this.costumes_.map(t=>t.name);t.name=u.unusedName(t.name,r),this.costumes_.splice(e,0,t)}deleteCostumeAt(t){return this.costumes.splice(t,1)[0]}createClone(t){const e=new i(this,this.runtime);if(e.isOriginal=0===this.clones.length,this.clones.push(e),e.initAudio(),e.isOriginal){const r="string"==typeof t?t:c.SPRITE_LAYER;e.initDrawable(r),this.runtime.fireTargetWasCreated(e)}else this.runtime.fireTargetWasCreated(e,this.clones[0]);return e}removeClone(t){this.runtime.fireTargetWasRemoved(t);const e=this.clones.indexOf(t);e>=0&&this.clones.splice(e,1)}duplicate(){const t=new h(null,this.runtime),e=this.blocks._blocks,r=Object.keys(e).map(t=>e[t]),i=JSON.parse(JSON.stringify(r));a(i),i.forEach(e=>{t.blocks.createBlock(e)});const n=this.runtime.targets.map(t=>t.sprite.name);t.name=u.unusedName(this.name,n);const c=[];return t.costumes=this.costumes_.map(t=>{const e=Object.assign({},t);return c.push(o(e,this.runtime)),e}),t.sounds=this.sounds.map(e=>{const r=Object.assign({},e),i=e.asset;return c.push(s(r,i,this.runtime,t.soundBank)),r}),Promise.all(c).then(()=>t)}dispose(){this.soundBank&&this.soundBank.dispose()}}t.exports=h},487:function(t,e,r){const i=r(287),n=r(59);t.exports={deserializeSound:function(t,e,r,s){const o=s||t.md5,a=e.storage;if(!a)return n.error("No storage module present; cannot load sound asset: ",o),Promise.resolve(null);if(!r)return Promise.resolve(null);let u=r.file(o);if(!u){const t=new RegExp(`^([^/]*/)?${o}$`);u=r.file(t)[0]}if(!u){n.error(`Could not find sound file associated with the ${t.name} sound.`);const e=a.EmptySound;return t.asset=e,t.assetId=e.assetId,t.md5=`${e.assetId}.${e.dataFormat}`,Promise.resolve(null)}if(!i.support.uint8array)return n.error("JSZip uint8array is not supported in this browser."),Promise.resolve(null);const c="mp3"===t.dataFormat.toLowerCase()?a.DataFormat.MP3:a.DataFormat.WAV;return u.async("uint8array").then(e=>a.createAsset(a.AssetType.Sound,c,e,t.assetId,!0)).then(e=>{t.asset=e,t.assetId=e.assetId,t.md5=`${e.assetId}.${e.dataFormat}`})},deserializeCostume:function(t,e,r,s,o){const a=e.storage,u=t.assetId,c=s||`${u}.${t.dataFormat}`;if(!a)return n.error("No storage module present; cannot load costume asset: ",c),Promise.resolve(null);if(t.asset)return Promise.resolve(a.createAsset(t.asset.assetType,t.asset.dataFormat,new Uint8Array(Object.keys(t.asset.data).map(e=>t.asset.data[e])),u,!1)).then(e=>{t.asset=e,t.assetId=e.assetId,t.md5=`${e.assetId}.${e.dataFormat}`});if(!r)return Promise.resolve(null);let h=r.file(c);if(!h){const t=new RegExp(`^([^/]*/)?${c}$`);h=r.file(t)[0]}if(!h){n.error(`Could not find costume file associated with the ${t.name} costume.`);const e=a.EmptyCostume;return t.asset=e,t.assetId=e.assetId,t.md5=`${e.assetId}.${e.dataFormat}`,Promise.resolve(null)}let l=null;const p=t.dataFormat.toLowerCase();if("svg"===p?l=a.AssetType.ImageVector:["png","bmp","jpeg","jpg","gif"].indexOf(p)>=0?l=a.AssetType.ImageBitmap:n.error(`Unexpected file format for costume: ${p}`),!i.support.uint8array)return n.error("JSZip uint8array is not supported in this browser."),Promise.resolve(null);let d;if(t.textLayerMD5){const e=r.file(o);if(!e)return n.error(`Could not find text layer file associated with the ${t.name} costume.`),Promise.resolve(null);d=e.async("uint8array").then(e=>a.createAsset(a.AssetType.ImageBitmap,"png",e,t.textLayerMD5)).then(e=>{t.textLayerAsset=e})}else d=Promise.resolve(null);return Promise.all([d,h.async("uint8array").then(t=>a.createAsset(l,p,t,u,!1)).then(e=>{t.asset=e,t.assetId=e.assetId,t.md5=`${e.assetId}.${e.dataFormat}`})])}}},488:function(t,e,r){const i=r(135),n=r(293),s=r(486),o=r(458),a=r(59),u=r(98),c=r(110),h=r(109),l=r(1021),p=r(294),d=r(123),m=r(291),_=r(136),{loadCostume:f}=r(210),{loadSound:g}=r(211),{deserializeCostume:b,deserializeSound:y}=r(487),T=["argument","control","data","event","looks","math","motion","operator","procedures","sensing","sound"],v=function(t){const e=[{}];let r=0;const i=t.split(/(?=[^\\]%[nbs])/);for(let t=0;t<i.length;t++){const n=i[t].trim();if("%"===n.substring(0,1)){const t=n.substring(1,2),i={type:"input",inputName:"input"+r++};"n"===t?i.inputOp="math_number":"s"===t?i.inputOp="text":"b"===t&&(i.inputOp="boolean"),e.push(i)}}return e},S=function(t){return v(t).map(t=>t.inputName).filter(t=>t)},E=function(t){let e=[];for(let r=0;r<t.length;r++){const i=t[r];e.push(i),i.children&&(e=e.concat(E(i.children))),delete i.children}return e},O=function(t,e,r,i,n,s,o){const a=[];let u=null;for(let c=0;c<t.length;c++){const h=t[c],l=C(h,e,r,i,n,s,o),p=l[0];o=l[1],p&&(u&&(p.parent=u.id,u.next=p.id),u=p,a.push(p))}return[a,o]},I=function(){let t={};const e=(t,e,r)=>`${t}-${c.replaceUnsafeChars(e)}-${r}`;return function(r,i){return i&&(t={}),function(n,s){return i?(t[`${n}-${s}`]=e(r,n,s),t[`${n}-${s}`]):t[`${n}-${s}`]?t[`${n}-${s}`]:e(r,n,s)}}}(),k=function(){let t={};const e=[],r=u();return function(i){return i&&(t={}),{broadcastMsgMapUpdater:function(i,n){return""===(i=i.toLowerCase())&&(i=r),t[i]=`broadcastMsgId-${c.replaceUnsafeChars(i)}`,e.push(n),t[i]},globalBroadcastMsgs:t,allBroadcastFields:e,emptyMsgName:r}}}(),w=(t,e,r,i)=>{if(!l[t.cmd])return void a.warn(`Could not find monitor block with opcode: ${t.cmd}`);const n=l[t.cmd].opcode,s=n.indexOf("_"),o=n.substring(0,s);if("videoSensing"===o)return;if(-1===T.indexOf(o)&&""!==o&&!i.extensionIDs.has(o)&&!t.visible)return;let u=null;if(!t.hasOwnProperty("target"))for(let e=0;e<r.length;e++){const i=r[e];Object.keys(i.variables).filter(e=>{const r=i.variables[e];return r.type===d.LIST_TYPE&&r.name===t.listName}).length>0&&(u=i,t.target=i.getName())}if(u=u||r.filter(e=>e.getName()===t.target)[0],!u)throw new Error("Cannot create monitor for target that cannot be found by name");const c=I(u.id,!1),[h,p]=C([t.cmd,t.param],null,c,i,{},null,null);"getVar:"===t.cmd?h.id=c(t.param,d.SCALAR_TYPE):"contentsOfList:"===t.cmd?h.id=c(t.param,d.LIST_TYPE):e.monitorBlockInfo.hasOwnProperty(h.opcode)?h.id=e.monitorBlockInfo[h.opcode].getId(u.id,h.fields):h.id=h.opcode,h.targetId=u.isStage?null:u.id,h.isMonitored=t.visible;const _=e.monitorBlocks._blocks[h.id];if(_)_.isMonitored=t.visible,_.targetId=h.targetId;else{const t=E([h]);for(let r=0;r<t.length;r++)e.monitorBlocks.createBlock(t[r])}switch(t.mode){case 1:t.mode="default";break;case 2:t.mode="large";break;case 3:t.mode="slider"}e.requestAddMonitor(m({id:h.id,targetId:h.targetId,spriteName:h.targetId?t.target:null,opcode:h.opcode,params:e.monitorBlocks._getBlockParams(h),value:"",mode:t.mode,sliderMin:t.sliderMin,sliderMax:t.sliderMax,isDiscrete:t.isDiscrete,x:t.x,y:t.y,width:t.width,height:t.height,visible:t.visible}))},N=function(t,e,r,i){if(!t.hasOwnProperty("objName"))return null;const n={costumePromises:[],soundPromises:[],soundBank:e.audioEngine&&e.audioEngine.createBank(),children:[]},s=n.costumePromises;if(t.hasOwnProperty("costumes"))for(let n=0;n<t.costumes.length;n++){const o=t.costumes[n],a=o.bitmapResolution||1,u={name:o.costumeName,bitmapResolution:a,rotationCenterX:r?240*a:o.rotationCenterX,rotationCenterY:r?180*a:o.rotationCenterY,md5:o.baseLayerMD5,skinId:null},h=o.baseLayerMD5,l=c.splitFirst(h,"."),p=l[0];let d;2===l.length&&l[1]?d=l[1]:(d="png",u.md5=`${u.md5}.${d}`),u.dataFormat=d,u.assetId=p,o.textLayerMD5&&(u.textLayerMD5=c.splitFirst(o.textLayerMD5,".")[0]);const m=`${o.baseLayerID}.${d}`,_=o.textLayerID?`${o.textLayerID}.png`:null;s.push(b(u,e,i,m,_).then(()=>f(u.md5,u,e,2,t._storeId)))}const{soundBank:o,soundPromises:a}=n;if(t.hasOwnProperty("sounds"))for(let r=0;r<t.sounds.length;r++){const n=t.sounds[r],s={name:n.soundName,format:n.format,rate:n.rate,sampleCount:n.sampleCount,md5:n.md5,data:null},u=n.md5,h=c.splitFirst(u,"."),l=h[0],p=h[1].toLowerCase();s.dataFormat=p,s.assetId=l;const d=`${n.soundID}.${p}`;a.push(y(s,e,i,d).then(()=>g(s,e,o,t._storeId)))}const u=n.children;if(t.children)for(let r=0;r<t.children.length;r++)u.push(N(t.children[r],e,!1,i));return n},A=function(t,e,r,o,a,u){if(!t.hasOwnProperty("objName"))return t.hasOwnProperty("listName")&&(t.cmd="contentsOfList:",t.param=t.listName,t.mode="list"),t.deferredMonitor=!0,Promise.resolve(t);const c=new i(e),l=new s(c,e);if(t.hasOwnProperty("objName")){if(o&&"Stage"!==t.objName){for(const e of t.children)e.hasOwnProperty("objName")||e.target!==t.objName||(e.target="Stage");t.objName="Stage"}l.name=t.objName}const m=u.costumePromises,{soundBank:f,soundPromises:g}=u,b=l.createClone(o?_.BACKGROUND_LAYER:_.SPRITE_LAYER),y=I(b.id,o),T=k(o),v=T.broadcastMsgMapUpdater;if(t.hasOwnProperty("variables"))for(let r=0;r<t.variables.length;r++){const i=t.variables[r],n=i.isPersistent&&o&&e.canAddCloudVariable(),s=new d(y(i.name,d.SCALAR_TYPE),i.name,d.SCALAR_TYPE,n);n&&e.addCloudVariable(),s.value=i.value,b.variables[s.id]=s}const S={};if(t.hasOwnProperty("scriptComments")){t.scriptComments.map(t=>{const[e,r,i,n,s,o,a]=t,u=t[5]>=0,c=new p(null,a,u?null:1.5*e,u?null:2.2*r,1.5*i,2.2*n,!s);return u&&(c.blockId=o,S.hasOwnProperty(o)?S[o].push(c):S[o]=[c]),c}).forEach(t=>{b.comments[t.id]=t})}t.hasOwnProperty("scripts")&&function(t,e,r,i,n,s){let o=0;for(let a=0;a<t.length;a++){const u=t[a],c=u[0],h=u[1],l=u[2],p={},[d,m]=O(l,r,i,n,p,s,o);o=m,d[0]&&(d[0].x=1.5*c,d[0].y=2.2*h,d[0].topLevel=!0,d[0].parent=null);const _=E(d);for(let t=0;t<_.length;t++)e.createBlock(_[t])}}(t.scripts,c,v,y,r,S);for(const t in S){S[t].forEach(t=>{"number"==typeof t.blockId&&(t.blockId=null)})}if(c.updateTargetSpecificBlocks(o),t.hasOwnProperty("lists"))for(let e=0;e<t.lists.length;e++){const r=t.lists[e],i=new d(y(r.listName,d.LIST_TYPE),r.listName,d.LIST_TYPE,!1);i.value=r.contents,b.variables[i.id]=i}t.hasOwnProperty("scratchX")&&(b.x=t.scratchX),t.hasOwnProperty("scratchY")&&(b.y=t.scratchY),t.hasOwnProperty("direction")&&(b.direction=t.direction),t.hasOwnProperty("isDraggable")&&(b.draggable=t.isDraggable),t.hasOwnProperty("scale")&&(b.size=100*t.scale),t.hasOwnProperty("visible")&&(b.visible=t.visible),t.hasOwnProperty("currentCostumeIndex")&&(b.currentCostume=h.clamp(Math.floor(t.currentCostumeIndex),0,t.costumes.length-1)),t.hasOwnProperty("rotationStyle")&&("none"===t.rotationStyle?b.rotationStyle=n.ROTATION_STYLE_NONE:"leftRight"===t.rotationStyle?b.rotationStyle=n.ROTATION_STYLE_LEFT_RIGHT:"normal"===t.rotationStyle&&(b.rotationStyle=n.ROTATION_STYLE_ALL_AROUND)),t.hasOwnProperty("tempoBPM")&&(b.tempo=t.tempoBPM),t.hasOwnProperty("videoAlpha")&&(b.videoTransparency=100-100*t.videoAlpha),t.hasOwnProperty("info")&&t.info.hasOwnProperty("videoOn")&&(t.info.videoOn?b.videoState=n.VIDEO_STATE.ON:b.videoState=n.VIDEO_STATE.OFF),t.hasOwnProperty("indexInLibrary")&&(b.targetPaneOrder=t.indexInLibrary),b.isStage=o,Promise.all(m).then(t=>{l.costumes=t}),Promise.all(g).then(t=>{l.sounds=t,l.soundBank=f||null});const N=[];if(t.children)for(let i=0;i<t.children.length;i++)N.push(A(t.children[i],e,r,!1,a,u.children[i]));return Promise.all(m.concat(g)).then(()=>Promise.all(N).then(t=>{if(b.isStage){const t=T.globalBroadcastMsgs,e=T.allBroadcastFields,r=T.emptyMsgName;if(t[r]){let i=1;for(;t[`message${i}`];)i+=1;const n=`message${i}`;t[n]=t[r],delete t[r];for(let t=0;t<e.length;t++)""===e[t].value&&(e[t].value=n)}for(const e in t){const r=t[e],i=new d(r,e,d.BROADCAST_MESSAGE_TYPE,!1);b.variables[i.id]=i}}let i=[b];const n=[];for(let e=0;e<t.length;e++)t[e]&&(t[e].deferredMonitor?n.push(t[e]):i=i.concat(t[e]));for(let t=0;t<n.length;t++)w(n[t],e,i,r);return i}))},x=function(t){const e=t.map((t,e)=>(t.layerOrder=e,t)).sort((t,e)=>t.targetPaneOrder-e.targetPaneOrder);return e.forEach(t=>{delete t.targetPaneOrder}),e},C=function(t,e,r,i,n,s,c){const h=s&&"number"==typeof c&&!isNaN(c)?s[c]:null,p=function(t){const e=t[0],r=e&&l[e];return r?"function"==typeof r?r(t):r:(a.warn(`Couldn't find SB2 block: ${e}`),null)}(t);if(!p)return h&&h.forEach(t=>{t.blockId=null,t.x=t.y=0}),[null,c+1];const m=t[0],_=p.opcode.indexOf("_"),f=p.opcode.substring(0,_);-1===T.indexOf(f)&&""!==f&&i.extensionIDs.add(f);const g={id:u(),opcode:p.opcode,inputs:{},fields:{},next:null,shadow:!1,children:[]};h&&(g.comment=h[h.length-1].id,h.forEach(t=>{t.id===g.comment?t.blockId=g.id:(t.blockId=null,t.x=t.y=0)})),c++;const b=n.expectedArg;"call"===m&&(p.argMap=v(t[1]));for(let h=0;h<p.argMap.length;h++){const l=p.argMap[h],m=t[h+1];let _=!1;if("input"===l.type){const t=u();if(g.inputs[l.inputName]={name:l.inputName,block:null,shadow:null},"object"==typeof m&&m){let t;if(n.expectedArg=l,"object"==typeof m[0]&&m[0])[t,c]=O(m,e,r,i,n,s,c);else{const o=C(m,e,r,i,n,s,c);t=o[0]?[o[0]]:[],c=o[1]}if(n.expectedArg=b,t.length>0){let e=null;for(let r=0;r<t.length;r++)t[r].parent=0===r?g.id:e,e=t[r].id;g.inputs[l.inputName].block=t[0].id,g.children=g.children.concat(t)}_=!0}if(!l.inputOp){a.warn(`Unknown input operation for input ${l.inputName} of opcode ${g.opcode}.`);continue}if("boolean"===l.inputOp||"substack"===l.inputOp)continue;let h=m,p=l.inputName;"math_number"===l.inputOp||"math_whole_number"===l.inputOp||"math_positive_number"===l.inputOp||"math_integer"===l.inputOp||"math_angle"===l.inputOp?(p="NUM",_&&(h=10)):"text"===l.inputOp?(p="TEXT",_&&(h="")):"colour_picker"===l.inputOp?(h=o.decimalToHex(m),p="COLOUR",_&&(h="#990000")):"event_broadcast_menu"===l.inputOp?(p="BROADCAST_OPTION",_&&(h="")):"sensing_of_object_menu"===l.inputOp?_?h="_stage_":"Stage"===h&&(h="_stage_"):"note"===l.inputOp?_&&(h=60):"music.menu.DRUM"===l.inputOp?_&&(h=1):"music.menu.INSTRUMENT"===l.inputOp?_&&(h=1):"videoSensing.menu.ATTRIBUTE"===l.inputOp?_&&(h="motion"):"videoSensing.menu.SUBJECT"===l.inputOp?_&&(h="this sprite"):"videoSensing.menu.VIDEO_STATE"===l.inputOp?_&&(h="on"):_&&(h="");const d={};if(d[p]={name:p,value:h},"event_broadcast_menu"===l.inputOp){const t=e(h,d[p]);d[p].id=t,d[p].variableType=l.variableType}g.children.push({id:t,opcode:l.inputOp,inputs:{},fields:d,next:null,topLevel:!1,parent:g.id,shadow:!0}),g.inputs[l.inputName].shadow=t,g.inputs[l.inputName].block||(g.inputs[l.inputName].block=t)}else if("field"===l.type){if(g.fields[l.fieldName]={name:l.fieldName,value:m},"CURRENTMENU"===l.fieldName&&(g.fields[l.fieldName].value=m.toUpperCase(),"day of week"===m&&(g.fields[l.fieldName].value="DAYOFWEEK")),"VARIABLE"===l.fieldName)g.fields[l.fieldName].id=r(m,d.SCALAR_TYPE);else if("LIST"===l.fieldName)g.fields[l.fieldName].id=r(m,d.LIST_TYPE);else if("BROADCAST_OPTION"===l.fieldName){const t=e(m,g.fields[l.fieldName]);g.fields[l.fieldName].id=t}const t=l.variableType;"string"==typeof t&&(g.fields[l.fieldName].variableType=t)}}switch(m){case"comeToFront":g.fields.FRONT_BACK={name:"FRONT_BACK",value:"front"};break;case"goBackByLayers:":g.fields.FORWARD_BACKWARD={name:"FORWARD_BACKWARD",value:"backward"};break;case"backgroundIndex":g.fields.NUMBER_NAME={name:"NUMBER_NAME",value:"number"};break;case"sceneName":g.fields.NUMBER_NAME={name:"NUMBER_NAME",value:"name"};break;case"costumeIndex":g.fields.NUMBER_NAME={name:"NUMBER_NAME",value:"number"};break;case"costumeName":g.fields.NUMBER_NAME={name:"NUMBER_NAME",value:"name"}}if("stopScripts"===m)"other scripts in sprite"!==t[1]&&"other scripts in stage"!==t[1]||(g.mutation={tagName:"mutation",hasnext:"true",children:[]});else if("procDef"===m){const e=t.slice(1),r=u(),i="custom_block";g.inputs[i]={name:i,block:r,shadow:r},g.children=[{id:r,opcode:"procedures_prototype",inputs:{},fields:{},next:null,shadow:!0,children:[],mutation:{tagName:"mutation",proccode:e[0],argumentnames:JSON.stringify(e[1]),argumentids:JSON.stringify(S(e[0])),argumentdefaults:JSON.stringify(e[2]),warp:e[3],children:[]}}]}else if("call"===m)g.mutation={tagName:"mutation",children:[],proccode:t[1],argumentids:JSON.stringify(S(t[1]))};else if("getParam"===m){let e=t[2];switch(b&&"boolean"===b.inputOp&&"b"!==e&&(e="b"),e){case"r":g.opcode="argument_reporter_string_number";break;case"b":g.opcode="argument_reporter_boolean"}}return[g,c]};t.exports={deserialize:function(t,e,r,i){const n={extensionIDs:new Set,extensionURLs:new Map};return Promise.resolve(N(t,e,!r,i)).then(t=>Promise.resolve(t)).then(s=>A(t,e,n,!r,i,s)).then(x).then(t=>({targets:t,extensions:n}))}}},849:function(t,e,r){const i=r(850);t.exports=i},871:function(t,e,r){const i=r(59);t.exports=class{constructor(){this.callbacks=[],this.nextResponseId=0}call(t,e,...r){return this.transferCall(t,e,null,...r)}transferCall(t,e,r,...i){try{const{provider:n,isRemote:s}=this._getServiceProvider(t);if(n){if(s)return this._remoteTransferCall(n,t,e,r,...i);const o=n[e].apply(n,i);return Promise.resolve(o)}return Promise.reject(new Error(`Service not found: ${t}`))}catch(t){return Promise.reject(t)}}_isRemoteService(t){return this._getServiceProvider(t).isRemote}_remoteCall(t,e,r,...i){return this._remoteTransferCall(t,e,r,null,...i)}_remoteTransferCall(t,e,r,i,...n){return new Promise((s,o)=>{const a=this._storeCallbacks(s,o);n.length>0&&"function"==typeof n[n.length-1].yield&&n.pop(),i?t.postMessage({service:e,method:r,responseId:a,args:n},i):t.postMessage({service:e,method:r,responseId:a,args:n})})}_storeCallbacks(t,e){const r=this.nextResponseId++;return this.callbacks[r]=[t,e],r}_deliverResponse(t,e){try{const[r,i]=this.callbacks[t];delete this.callbacks[t],e.error?i(e.error):r(e.result)}catch(t){i.error(`Dispatch callback failed: ${JSON.stringify(t)}`)}}_onMessage(t,e){const r=e.data;let n;r.args=r.args||[],r.service?n="dispatch"===r.service?this._onDispatchMessage(t,r):this.call(r.service,r.method,...r.args):void 0===r.responseId?i.error(`Dispatch caught malformed message from a worker: ${JSON.stringify(e)}`):this._deliverResponse(r.responseId,r),n&&(void 0===r.responseId?i.error(`Dispatch message missing required response ID: ${JSON.stringify(e)}`):n.then(e=>t.postMessage({responseId:r.responseId,result:e}),e=>t.postMessage({responseId:r.responseId,error:e})))}_getServiceProvider(t){throw new Error(`Could not get provider for ${t}: _getServiceProvider not implemented`)}_onDispatchMessage(t,e){throw new Error(`Unimplemented dispatch message handler cannot handle ${e.method} method`)}}},881:function(t,e,r){const i=r(439),n=r(59),s=r(441),o=r(290),a=r(445),u={};t.exports=class{constructor(t){this.nextExtensionWorker=0,this.pendingExtensions=[],this.pendingWorkers=[],this._loadedExtensions=new Map,this.runtime=t,i.setService("extensions",this).catch(t=>{n.error(`ExtensionManager was unable to register extension service: ${JSON.stringify(t)}`)})}isExtensionLoaded(t){return this._loadedExtensions.has(t)}loadExtensionIdSync(t){if(!u.hasOwnProperty(t))return void n.warn(`Could not find extension ${t} in the built in extensions.`);if(this.isExtensionLoaded(t)){const e=`Rejecting attempt to load a second extension with ID ${t}`;return void n.warn(e)}const e=new(u[t]())(this.runtime),r=this._registerInternalExtension(e);this._loadedExtensions.set(t,r)}loadExtensionURL(t){if(u.hasOwnProperty(t)){if(this.isExtensionLoaded(t)){const e=`Rejecting attempt to load a second extension with ID ${t}`;return n.warn(e),Promise.resolve()}const e=new(u[t]())(this.runtime),r=this._registerInternalExtension(e);return this._loadedExtensions.set(t,r),Promise.resolve()}return new Promise((e,n)=>{const s=r(884);this.pendingExtensions.push({extensionURL:t,resolve:e,reject:n}),i.addWorker(new s)})}getExtensionInstance(t){return new t(this.runtime,o)}loadExtension(t,e){const r=this._registerInternalExtension(t);return this._loadedExtensions.set(e,r),Promise.resolve()}refreshBlocks(){const t=Array.from(this._loadedExtensions.values()).map(t=>i.call(t,"getInfo").then(e=>{e=this._prepareExtensionInfo(t,e),i.call("runtime","_refreshExtensionPrimitives",e)}).catch(t=>{n.error(`Failed to refresh built-in extension primitives: ${JSON.stringify(t)}`)}));return Promise.all(t)}allocateWorker(){const t=this.nextExtensionWorker++,e=this.pendingExtensions.shift();return this.pendingWorkers[t]=e,[t,e.extensionURL]}registerExtensionServiceSync(t){const e=i.callSync(t,"getInfo");this._registerExtensionInfo(t,e)}registerExtensionService(t){i.call(t,"getInfo").then(e=>{this._registerExtensionInfo(t,e)})}onWorkerInit(t,e){const r=this.pendingWorkers[t];delete this.pendingWorkers[t],e?r.reject(e):r.resolve(t)}_registerInternalExtension(t){const e=t.getInfo(),r=`extension_${this.nextExtensionWorker++}_${e.id}`;return i.setServiceSync(r,t),i.callSync("extensions","registerExtensionServiceSync",r),r}_registerExtensionInfo(t,e){e=this._prepareExtensionInfo(t,e),i.call("runtime","_registerExtensionPrimitives",e).catch(e=>{n.error(`Failed to register primitives for extension on service ${t}:`,e)})}_sanitizeID(t){return t.toString().replace(/[<"&]/,"_")}_prepareExtensionInfo(t,e){if(e=Object.assign({},e),!/^[a-z0-9]+$/i.test(e.id))throw new Error("Invalid extension id");return e.name=e.name||e.id,e.blocks=e.blocks||[],e.targetTypes=e.targetTypes||[],e.blocks=e.blocks.reduce((e,r)=>{try{let i;switch(r){case"---":i="---";break;default:i=this._prepareBlockInfo(t,r)}e.push(i)}catch(t){n.error(`Error processing block: ${t.message}, Block:\n${JSON.stringify(r)}`)}return e},[]),e.menus=e.menus||{},e.menus=this._prepareMenuInfo(t,e.menus),e}_prepareMenuInfo(t,e){const r=Object.getOwnPropertyNames(e);for(let n=0;n<r.length;n++){const s=r[n];let o=e[s];if(o.items||(o={items:o},e[s]=o),"string"==typeof o.items){const e=o.items,r=i.services[t];o.items=this._getExtensionMenuItems.bind(this,r,e)}}return e}_getExtensionMenuItems(t,e){const r=this.runtime.getEditingTarget()||this.runtime.getTargetForStage(),i=r?r.id:null,n=this.runtime.makeMessageContextForTarget(r),o=t[e].call(t,i).map(t=>{switch(typeof(t=s(t,n))){case"object":return[s(t.text,n),t.value];case"string":return[t,t];default:return t}});if(!o||o.length<1)throw new Error(`Extension menu returned no items: ${e}`);return o}_prepareBlockInfo(t,e){switch((e=Object.assign({},{blockType:a.COMMAND,terminal:!1,blockAllThreads:!1,arguments:{}},e)).opcode=e.opcode&&this._sanitizeID(e.opcode),e.text=e.text||e.opcode,e.blockType){case a.EVENT:e.func&&n.warn(`Ignoring function "${e.func}" for event block ${e.opcode}`);break;case a.BUTTON:e.opcode&&n.warn(`Ignoring opcode "${e.opcode}" for button with text: ${e.text}`);break;default:{if(!e.opcode)throw new Error("Missing opcode for block");const r=e.func?this._sanitizeID(e.func):e.opcode,s=e.isDynamic?t=>t&&t.mutation&&t.mutation.blockInfo:()=>e,o=(()=>{if(i._isRemoteService(t))return(e,n,s)=>i.call(t,r,e,n,s);const e=i.services[t];return e[r]||n.warn(`Could not find extension block function called ${r}`),(t,i,n)=>e[r](t,i,n)})();e.func=(t,e)=>{const r=s(t);return o(t,e,r)};break}}return e}}},882:function(t,e,r){"use strict";var i="{",n="}",s=",",o="#",a="<",u=">",c="</",h="/>",l="'",p="offset:",d=["number","date","time","ordinal","duration","spellout"],m=["plural","select","selectordinal"];function _(t,e){var r=t.pattern,i=r.length,s=[],o=t.index,a=f(t,e);for(a&&s.push(a),a&&t.tokens&&t.tokens.push(["text",r.slice(o,t.index)]);t.index<i;){if(r[t.index]===n){if(!e)throw O(t);break}if(e&&t.tagsType&&r.slice(t.index,t.index+c.length)===c)break;s.push(y(t)),o=t.index,(a=f(t,e))&&s.push(a),a&&t.tokens&&t.tokens.push(["text",r.slice(o,t.index)])}return s}function f(t,e){for(var r=t.pattern,s=r.length,u="plural"===e||"selectordinal"===e,c=!!t.tagsType,h="{style}"===e,p="";t.index<s;){var d=r[t.index];if(d===i||d===n||u&&d===o||c&&d===a||h&&g(d.charCodeAt(0)))break;if(d===l)if((d=r[++t.index])===l)p+=d,++t.index;else if(d===i||d===n||u&&d===o||c&&d===a||h)for(p+=d;++t.index<s;)if((d=r[t.index])===l&&r[t.index+1]===l)p+=l,++t.index;else{if(d===l){++t.index;break}p+=d}else p+=l;else p+=d,++t.index}return p}function g(t){return t>=9&&t<=13||32===t||133===t||160===t||6158===t||t>=8192&&t<=8205||8232===t||8233===t||8239===t||8287===t||8288===t||12288===t||65279===t}function b(t){for(var e=t.pattern,r=e.length,i=t.index;t.index<r&&g(e.charCodeAt(t.index));)++t.index;i<t.index&&t.tokens&&t.tokens.push(["space",t.pattern.slice(i,t.index)])}function y(t){var e=t.pattern;if(e[t.index]===o)return t.tokens&&t.tokens.push(["syntax",o]),++t.index,[o];var r=function(t){var e=t.tagsType;if(!e||t.pattern[t.index]!==a)return;if(t.pattern.slice(t.index,t.index+c.length)===c)throw O(t,null,"closing tag without matching opening tag");t.tokens&&t.tokens.push(["syntax",a]);++t.index;var r=T(t,!0);if(!r)throw O(t,"placeholder id");t.tokens&&t.tokens.push(["id",r]);if(b(t),t.pattern.slice(t.index,t.index+h.length)===h)return t.tokens&&t.tokens.push(["syntax",h]),t.index+=h.length,[r,e];if(t.pattern[t.index]!==u)throw O(t,u);t.tokens&&t.tokens.push(["syntax",u]);++t.index;var i=_(t,e),n=t.index;if(t.pattern.slice(t.index,t.index+c.length)!==c)throw O(t,c+r+u);t.tokens&&t.tokens.push(["syntax",c]);t.index+=c.length;var s=T(t,!0);s&&t.tokens&&t.tokens.push(["id",s]);if(r!==s)throw t.index=n,O(t,c+r+u,c+s+u);if(b(t),t.pattern[t.index]!==u)throw O(t,u);t.tokens&&t.tokens.push(["syntax",u]);return++t.index,[r,e,{children:i}]}(t);if(r)return r;if(e[t.index]!==i)throw O(t,i);t.tokens&&t.tokens.push(["syntax",i]),++t.index,b(t);var l=T(t);if(!l)throw O(t,"placeholder id");t.tokens&&t.tokens.push(["id",l]),b(t);var m=e[t.index];if(m===n)return t.tokens&&t.tokens.push(["syntax",n]),++t.index,[l];if(m!==s)throw O(t,s+" or "+n);t.tokens&&t.tokens.push(["syntax",s]),++t.index,b(t);var f,g=T(t);if(!g)throw O(t,"placeholder type");if(t.tokens&&t.tokens.push(["type",g]),b(t),(m=e[t.index])===n){if(t.tokens&&t.tokens.push(["syntax",n]),"plural"===g||"selectordinal"===g||"select"===g)throw O(t,g+" sub-messages");return++t.index,[l,g]}if(m!==s)throw O(t,s+" or "+n);if(t.tokens&&t.tokens.push(["syntax",s]),++t.index,b(t),"plural"===g||"selectordinal"===g){var y=function(t){var e=t.pattern,r=e.length,i=0;if(e.slice(t.index,t.index+p.length)===p){t.tokens&&t.tokens.push(["offset","offset"],["syntax",":"]),t.index+=p.length,b(t);for(var n=t.index;t.index<r&&((s=e.charCodeAt(t.index))>=48&&s<=57);)++t.index;if(n===t.index)throw O(t,"offset number");t.tokens&&t.tokens.push(["number",e.slice(n,t.index)]),i=+e.slice(n,t.index)}var s;return i}(t);b(t),f=[l,g,y,S(t,g)]}else if("select"===g)f=[l,g,S(t,g)];else if(d.indexOf(g)>=0)f=[l,g,v(t)];else{var E=t.index,I=v(t);b(t),e[t.index]===i&&(t.index=E,I=S(t,g)),f=[l,g,I]}if(b(t),e[t.index]!==n)throw O(t,n);return t.tokens&&t.tokens.push(["syntax",n]),++t.index,f}function T(t,e){for(var r=t.pattern,c=r.length,h="";t.index<c;){var p=r[t.index];if(p===i||p===n||p===s||p===o||p===l||g(p.charCodeAt(0))||e&&(p===a||p===u||"/"===p))break;h+=p,++t.index}return h}function v(t){var e=t.index,r=f(t,"{style}");if(!r)throw O(t,"placeholder style name");return t.tokens&&t.tokens.push(["style",t.pattern.slice(e,t.index)]),r}function S(t,e){for(var r=t.pattern,i=r.length,s={};t.index<i&&r[t.index]!==n;){var o=T(t);if(!o)throw O(t,"sub-message selector");t.tokens&&t.tokens.push(["selector",o]),b(t),s[o]=E(t,e),b(t)}if(!s.other&&m.indexOf(e)>=0)throw O(t,null,null,'"other" sub-message must be specified in '+e);return s}function E(t,e){if(t.pattern[t.index]!==i)throw O(t,i+" to start sub-message");t.tokens&&t.tokens.push(["syntax",i]),++t.index;var r=_(t,e);if(t.pattern[t.index]!==n)throw O(t,n+" to end sub-message");return t.tokens&&t.tokens.push(["syntax",n]),++t.index,r}function O(t,e,r,i){var n=t.pattern,s=n.slice(0,t.index).split(/\r?\n/),o=t.index,a=s.length,u=s.slice(-1)[0].length;return r=r||(t.index>=n.length?"end of message pattern":T(t)||n[t.index]),i||(i=function(t,e){return t?"Expected "+t+" but found "+e:"Unexpected "+e+" found"}(e,r)),new I(i+=" in "+n.replace(/\r?\n/g,"\n"),e,r,o,a,u)}function I(t,e,r,i,n,s){Error.call(this,t),this.name="SyntaxError",this.message=t,this.expected=e,this.found=r,this.offset=i,this.line=n,this.column=s}e=t.exports=function(t,e){return _({pattern:String(t),index:0,tagsType:e&&e.tagsType||null,tokens:e&&e.tokens||null},"")},I.prototype=Object.create(Error.prototype),e.SyntaxError=I},883:function(t,e,r){"use strict";var i=r(442),n=r(443),s=r(444);function o(t,e,r,i,n){var s=t.map((function(t){return function(t,e,r,i,n){if("string"==typeof t){var s=t;return function(){return s}}var u,c=t[0],h=t[1];if(e&&"#"===t[0]){c=e[0];var l=e[2],d=(i.number||p.number)([c,"number"],r);return function(t){return d(a(c,t)-l,t)}}"plural"===h||"selectordinal"===h?(u={},Object.keys(t[3]).forEach((function(e){u[e]=o(t[3][e],t,r,i,n)})),t=[t[0],t[1],t[2],u]):t[2]&&"object"==typeof t[2]&&(u={},Object.keys(t[2]).forEach((function(e){u[e]=o(t[2][e],t,r,i,n)})),t=[t[0],t[1],u]);var m=h&&(i[h]||p[h]);if(m){var _=m(t,r);return function(t){return _(a(c,t),t)}}return n?function(t){return String(a(c,t))}:function(t){return a(c,t)}}(t,e,r,i,n)}));return n?1===s.length?s[0]:function(t){for(var e="",r=0;r<s.length;++r)e+=s[r](t);return e}:function(t){return s.reduce((function(e,r){return e.concat(r(t))}),[])}}function a(t,e){if(e&&t in e)return e[t];for(var r=t.split("."),i=e,n=0,s=r.length;i&&n<s;++n)i=i[r[n]];return i}function u(t,e){var r=t[2],n=i.number[r]||i.parseNumberPattern(r)||i.number.default;return new Intl.NumberFormat(e,n).format}function c(t,e){var r=t[1],n=t[2],s=i[r][n]||i.parseDatePattern(n)||i[r].default;return new Intl.DateTimeFormat(e,s).format}function h(t,e){var r,i="selectordinal"===t[1]?"ordinal":"cardinal",o=t[2],a=t[3];if(Intl.PluralRules&&Intl.PluralRules.supportedLocalesOf(e).length>0)r=new Intl.PluralRules(e,{type:i});else{var u=n(e,s),c=u&&s[u][i]||l;r={select:c}}return function(t,e){return(a["="+ +t]||a[r.select(t-o)]||a.other)(e)}}function l(){return"other"}(e=t.exports=function(t,e,r){return o(t,null,e||"en",r||{},!0)}).toParts=function(t,e,r){return o(t,null,e||"en",r||{},!1)};var p={number:u,ordinal:u,spellout:u,duration:function(t,e){var r=t[2],n=i.duration[r]||i.duration.default,s=new Intl.NumberFormat(e,n.seconds).format,o=new Intl.NumberFormat(e,n.minutes).format,a=new Intl.NumberFormat(e,n.hours).format,u=/^fi$|^fi-|^da/.test(String(e))?".":":";return function(t,e){if(t=+t,!isFinite(t))return s(t);var r=~~(t/60/60),i=~~(t/60%60),n=(r?a(Math.abs(r))+u:"")+o(Math.abs(i))+u+s(Math.abs(t%60));return t<0?a(-1).replace(a(1),n):n}},date:c,time:c,plural:h,selectordinal:h,select:function(t,e){var r=t[2];return function(t,e){return(r[t]||r.other)(e)}}};e.types=p},884:function(t,e,r){t.exports=function(){return new Worker(r.p+"extension-worker.js")}},885:function(t,e,r){const i=r(40),{OrderedMap:n}=r(175),s=r(886),o=r(135),a=r(456),u=r(445),c=r(915),h=r(916),l=r(457),p=r(918),d=r(919),m=r(209),_=r(59),f=r(441),g=r(136),b=r(123),y=r(207),T=r(920),v=r(921),S=r(922),E=r(923),O=r(924),I=r(925),k=r(926),w=r(927),N=r(110),A=r(98),x={scratch3_control:r(928),scratch3_event:r(929),scratch3_looks:r(930),scratch3_motion:r(932),scratch3_operators:r(933),scratch3_sound:r(934),scratch3_sensing:r(935),scratch3_data:r(936),scratch3_procedures:r(937)},C=["#0FBD8C","#0DA57A","#0B8E69"],M=(()=>{const t={};return t[s.ANGLE]={shadow:{type:"math_angle",fieldName:"NUM"}},t[s.COLOR]={shadow:{type:"colour_picker",fieldName:"COLOUR"}},t[s.NUMBER]={shadow:{type:"math_number",fieldName:"NUM"}},t[s.STRING]={shadow:{type:"text",fieldName:"TEXT"}},t[s.BOOLEAN]={check:"Boolean"},t[s.MATRIX]={shadow:{type:"matrix",fieldName:"MATRIX"}},t[s.NOTE]={shadow:{type:"note",fieldName:"NOTE"}},t[s.IMAGE]={fieldType:"field_image"},t})(),P=()=>{let t=0;return{canAddCloudVariable:()=>t<10,addCloudVariable:()=>{t++},removeCloudVariable:()=>{t--},hasCloudVariables:()=>t>0}};let R=-1,D=-1,B=-1;class L extends i{constructor(){super(),this.targets=[],this.executableTargets=[],this.threads=[],this.sequencer=new h(this),this.flyoutBlocks=new o(this,!0),this.monitorBlocks=new o(this,!0),this._editingTarget=null,this._primitives={},this._blockInfo=[],this._hats={},this._scriptGlowsPreviousFrame=[],this._nonMonitorThreadCount=0,this._lastStepDoneThreads=null,this._cloneCounter=0,this._refreshTargets=!1,this.monitorBlockInfo={},this._monitorState=n({}),this._prevMonitorState=n({}),this.turboMode=!1,this.compatibilityMode=!1,this._steppingInterval=null,this.currentStepTime=null,this.updateCurrentMSecs(),this.redrawRequested=!1,this._registerBlockPackages(),this.ioDevices={clock:new v(this),cloud:new S(this),keyboard:new E(this),mouse:new O(this),mouseWheel:new I(this),userData:new k,video:new w(this)},this.peripheralExtensions={},this.profiler=null;const t=P();this.hasCloudData=t.hasCloudVariables,this.canAddCloudVariable=t.canAddCloudVariable,this.addCloudVariable=this._initializeAddCloudVariable(t),this.removeCloudVariable=this._initializeRemoveCloudVariable(t)}static get STAGE_WIDTH(){return 480}static get STAGE_HEIGHT(){return 360}static get SCRIPT_GLOW_ON(){return"SCRIPT_GLOW_ON"}static get SCRIPT_GLOW_OFF(){return"SCRIPT_GLOW_OFF"}static get BLOCK_GLOW_ON(){return"BLOCK_GLOW_ON"}static get BLOCK_GLOW_OFF(){return"BLOCK_GLOW_OFF"}static get HAS_CLOUD_DATA_UPDATE(){return"HAS_CLOUD_DATA_UPDATE"}static get TURBO_MODE_ON(){return"TURBO_MODE_ON"}static get TURBO_MODE_OFF(){return"TURBO_MODE_OFF"}static get PROJECT_START(){return"PROJECT_START"}static get PROJECT_RUN_START(){return"PROJECT_RUN_START"}static get PROJECT_RUN_STOP(){return"PROJECT_RUN_STOP"}static get PROJECT_STOP_ALL(){return"PROJECT_STOP_ALL"}static get STOP_FOR_TARGET(){return"STOP_FOR_TARGET"}static get VISUAL_REPORT(){return"VISUAL_REPORT"}static get PROJECT_LOADED(){return"PROJECT_LOADED"}static get PROJECT_CHANGED(){return"PROJECT_CHANGED"}static get TOOLBOX_EXTENSIONS_NEED_UPDATE(){return"TOOLBOX_EXTENSIONS_NEED_UPDATE"}static get TARGETS_UPDATE(){return"TARGETS_UPDATE"}static get MONITORS_UPDATE(){return"MONITORS_UPDATE"}static get BLOCK_DRAG_UPDATE(){return"BLOCK_DRAG_UPDATE"}static get BLOCK_DRAG_END(){return"BLOCK_DRAG_END"}static get EXTENSION_ADDED(){return"EXTENSION_ADDED"}static get EXTENSION_FIELD_ADDED(){return"EXTENSION_FIELD_ADDED"}static get PERIPHERAL_LIST_UPDATE(){return"PERIPHERAL_LIST_UPDATE"}static get PERIPHERAL_CONNECTED(){return"PERIPHERAL_CONNECTED"}static get PERIPHERAL_DISCONNECTED(){return"PERIPHERAL_DISCONNECTED"}static get PERIPHERAL_REQUEST_ERROR(){return"PERIPHERAL_REQUEST_ERROR"}static get PERIPHERAL_CONNECTION_LOST_ERROR(){return"PERIPHERAL_CONNECTION_LOST_ERROR"}static get PERIPHERAL_SCAN_TIMEOUT(){return"PERIPHERAL_SCAN_TIMEOUT"}static get MIC_LISTENING(){return"MIC_LISTENING"}static get BLOCKSINFO_UPDATE(){return"BLOCKSINFO_UPDATE"}static get RUNTIME_STARTED(){return"RUNTIME_STARTED"}static get RUNTIME_DISPOSED(){return"RUNTIME_DISPOSED"}static get BLOCKS_NEED_UPDATE(){return"BLOCKS_NEED_UPDATE"}static get THREAD_STEP_INTERVAL(){return 1e3/60}static get THREAD_STEP_INTERVAL_COMPATIBILITY(){return 1e3/30}static get MAX_CLONES(){return 300}_initializeAddCloudVariable(t){return()=>{const e=this.hasCloudData();t.addCloudVariable(),!e&&this.hasCloudData()&&this.emit(L.HAS_CLOUD_DATA_UPDATE,!0)}}_initializeRemoveCloudVariable(t){return()=>{const e=this.hasCloudData();t.removeCloudVariable(),e&&!this.hasCloudData()&&this.emit(L.HAS_CLOUD_DATA_UPDATE,!1)}}_registerBlockPackages(){for(const t in x)if(x.hasOwnProperty(t)){const e=new x[t](this);if(e.getPrimitives){const t=e.getPrimitives();for(const r in t)t.hasOwnProperty(r)&&(this._primitives[r]=t[r].bind(e))}if(e.getHats){const t=e.getHats();for(const e in t)t.hasOwnProperty(e)&&(this._hats[e]=t[e])}e.getMonitored&&(this.monitorBlockInfo=Object.assign({},this.monitorBlockInfo,e.getMonitored()))}}getMonitorState(){return this._monitorState}_makeExtensionMenuId(t,e){return`${e}_menu_${y(t)}`}makeMessageContextForTarget(t){const e={};(t=t||this.getEditingTarget()||this.getTargetForStage())&&(e.targetType=t.isStage?d.STAGE:d.SPRITE)}_registerExtensionPrimitives(t){const e={id:t.id,name:f(t.name),showStatusButton:t.showStatusButton,blockIconURI:t.blockIconURI,menuIconURI:t.menuIconURI};t.color1?(e.color1=t.color1,e.color2=t.color2,e.color3=t.color3):(e.color1=C[0],e.color2=C[1],e.color3=C[2]),this._blockInfo.push(e),this._fillExtensionCategory(e,t);for(const r in e.customFieldTypes)if(t.customFieldTypes.hasOwnProperty(r)){const t=e.customFieldTypes[r];this.emit(L.EXTENSION_FIELD_ADDED,{name:`field_${t.extendedName}`,implementation:t.fieldImplementation})}this.emit(L.EXTENSION_ADDED,e)}_refreshExtensionPrimitives(t){const e=this._blockInfo.find(e=>e.id===t.id);e&&(e.name=f(t.name),this._fillExtensionCategory(e,t),this.emit(L.BLOCKSINFO_UPDATE,e))}_fillExtensionCategory(t,e){t.blocks=[],t.customFieldTypes={},t.menus=[],t.menuInfo={};for(const r in e.menus)if(e.menus.hasOwnProperty(r)){const i=e.menus[r],n=this._buildMenuForScratchBlocks(r,i,t);t.menus.push(n),t.menuInfo[r]=i}for(const r in e.customFieldTypes)if(e.customFieldTypes.hasOwnProperty(r)){const i=e.customFieldTypes[r],n=this._buildCustomFieldInfo(r,i,e.id,t);t.customFieldTypes[r]=n}for(const r of e.blocks)try{const e=this._convertForScratchBlocks(r,t);if(t.blocks.push(e),e.json){const t=e.json.type;r.blockType!==u.EVENT&&(this._primitives[t]=e.info.func),r.blockType!==u.EVENT&&r.blockType!==u.HAT||(this._hats[t]={edgeActivated:r.isEdgeActivated,restartExistingThreads:r.shouldRestartExistingThreads})}}catch(t){_.error("Error parsing block: ",{block:r,error:t})}}_convertMenuItems(t){if("function"!=typeof t){const e=this.makeMessageContextForTarget();return t.map(t=>{const r=f(t,e);switch(typeof r){case"string":return[r,r];case"object":return[f(t.text,e),t.value];default:throw new Error(`Can't interpret menu item: ${JSON.stringify(t)}`)}})}return t}_buildMenuForScratchBlocks(t,e,r){const i=this._makeExtensionMenuId(t,r.id),n=this._convertMenuItems(e.items);return{json:{message0:"%1",type:i,inputsInline:!0,output:"String",colour:r.color1,colourSecondary:r.color2,colourTertiary:r.color3,outputShape:e.acceptReporters?p.OUTPUT_SHAPE_ROUND:p.OUTPUT_SHAPE_SQUARE,args0:[{type:"field_dropdown",name:t,options:n}]}}}_buildCustomFieldInfo(t,e,r,i){const n=`${r}_${t}`;return{fieldName:t,extendedName:n,argumentTypeInfo:{shadowType:n,fieldType:`field_${n}`},scratchBlocksDefinition:this._buildCustomFieldTypeForScratchBlocks(n,e.output,e.outputShape,i),fieldImplementation:e.implementation}}_buildCustomFieldTypeForScratchBlocks(t,e,r,i){return{json:{type:t,message0:"%1",inputsInline:!0,output:e,colour:i.color1,colourSecondary:i.color2,colourTertiary:i.color3,outputShape:r,args0:[{name:`field_${t}`,type:`field_${t}`}]}}}_convertForScratchBlocks(t,e){return"---"===t?this._convertSeparatorForScratchBlocks(t):t.blockType===u.BUTTON?this._convertButtonForScratchBlocks(t):this._convertBlockForScratchBlocks(t,e)}_convertBlockForScratchBlocks(t,e){const r=`${e.id}_${t.opcode}`,i={type:r,inputsInline:!0,category:e.name,colour:e.color1,colourSecondary:e.color2,colourTertiary:e.color3},n={argsMap:{},blockJSON:i,categoryInfo:e,blockInfo:t,inputList:[]},s=t.blockIconURI||e.blockIconURI;if(s){i.extensions=["scratch_extension"],i.message0="%1 %2";const t={type:"field_image",src:s,width:40,height:40},e={type:"field_vertical_separator"};i.args0=[t,e]}switch(t.blockType){case u.COMMAND:i.outputShape=p.OUTPUT_SHAPE_SQUARE,i.previousStatement=null,t.isTerminal||(i.nextStatement=null);break;case u.REPORTER:i.output="String",i.outputShape=p.OUTPUT_SHAPE_ROUND;break;case u.BOOLEAN:i.output="Boolean",i.outputShape=p.OUTPUT_SHAPE_HEXAGONAL;break;case u.HAT:case u.EVENT:t.hasOwnProperty("isEdgeActivated")||(t.isEdgeActivated=!0),i.outputShape=p.OUTPUT_SHAPE_SQUARE,i.nextStatement=null;break;case u.CONDITIONAL:case u.LOOP:t.branchCount=t.branchCount||1,i.outputShape=p.OUTPUT_SHAPE_SQUARE,i.previousStatement=null,t.isTerminal||(i.nextStatement=null)}const o=Array.isArray(t.text)?t.text:[t.text];let a=0,c=0,h=0;const l=this._convertPlaceholders.bind(this,n),d=this.makeMessageContextForTarget();for(;a<o.length||c<t.branchCount;){if(a<o.length){n.outLineNum=h;const t=f(o[a],d).replace(/\[(.+?)]/g,l);i[`message${h}`]?i[`message${h}`]+=t:i[`message${h}`]=t,++a,++h}c<t.branchCount&&(i[`message${h}`]="%1",i[`args${h}`]=[{type:"input_statement",name:`SUBSTACK${c>0?c+1:""}`}],++c,++h)}t.blockType===u.REPORTER?t.disableMonitor||0!==n.inputList.length||(i.checkboxInFlyout=!0):t.blockType===u.LOOP&&(i[`lastDummyAlign${h}`]="RIGHT",i[`message${h}`]="%1",i[`args${h}`]=[{type:"field_image",src:"./static/blocks-media/repeat.svg",width:24,height:24,alt:"*",flip_rtl:!0}],++h);const m=`<block type="${r}">${t.isDynamic?`<mutation blockInfo="${y(JSON.stringify(t))}"/>`:""}${n.inputList.join("")}</block>`;return{info:n.blockInfo,json:n.blockJSON,xml:m}}_convertSeparatorForScratchBlocks(t){return{info:t,xml:'<sep gap="36"/>'}}_convertButtonForScratchBlocks(t){["MAKE_A_LIST","MAKE_A_PROCEDURE","MAKE_A_VARIABLE"].indexOf(t.func)<0&&_.error(`Custom button callbacks not supported yet: ${t.func}`);const e=this.makeMessageContextForTarget();return{info:t,xml:`<button text="${f(t.text,e)}" callbackKey="${t.func}"></button>`}}_constructInlineImageJson(t){return t.dataURI||_.warn("Missing data URI in extension block with argument type IMAGE"),{type:"field_image",src:t.dataURI||"",width:24,height:24,flip_rtl:t.flipRTL||!1}}_convertPlaceholders(t,e,r){r=r.replace(/[<"&]/,"_");const i=t.blockInfo.arguments[r]||{};let n,s=M[i.type]||{};if(!M[i.type]&&t.categoryInfo.customFieldTypes[i.type]&&(s=t.categoryInfo.customFieldTypes[i.type].argumentTypeInfo),"field_image"===s.fieldType)n=this._constructInlineImageJson(i);else{n={type:"input_value",name:r};const e=void 0===i.defaultValue?"":y(f(i.defaultValue,this.makeMessageContextForTarget()).toString());let o,a,u;if(s.check&&(n.check=s.check),i.menu){const e=t.categoryInfo.menuInfo[i.menu];e.acceptReporters?(o=r,a=this._makeExtensionMenuId(i.menu,t.categoryInfo.id),u=i.menu):(n.type="field_dropdown",n.options=this._convertMenuItems(e.items),o=null,a=null,u=r)}else o=r,a=s.shadow&&s.shadow.type||null,u=s.shadow&&s.shadow.fieldName||null;o&&t.inputList.push(`<value name="${r}">`),a&&t.inputList.push(`<shadow type="${a}">`),e&&u&&t.inputList.push(`<field name="${u}">${e}</field>`),a&&t.inputList.push("</shadow>"),o&&t.inputList.push("</value>")}const o=`args${t.outLineNum}`,a=t.blockJSON[o]=t.blockJSON[o]||[];n&&a.push(n);const u=a.length;return t.argsMap[r]=u,`%${u}`}getBlocksXML(){return this._blockInfo.map(t=>{const{name:e,color1:r,color2:i}=t,n=t.blocks.filter(t=>!t.info.hideFromPalette),s=`colour="${r}" secondaryColour="${i}"`;let o="";t.menuIconURI?o=t.menuIconURI:t.blockIconURI&&(o=t.blockIconURI);const a=o?`iconURI="${o}"`:"";let u="";return t.showStatusButton&&(u='showStatusButton="true"'),{id:t.id,xml:`<category name="${e}" id="${t.id}" ${u} ${s} ${a}>${n.map(t=>t.xml).join("")}</category>`}})}getBlocksJSON(){return this._blockInfo.reduce((t,e)=>t.concat(e.blocks.map(t=>t.json)),[])}getScratchLinkSocket(t){return(this._linkSocketFactory||this._defaultScratchLinkSocketFactory)(t)}configureScratchLinkSocketFactory(t){this._linkSocketFactory=t}_defaultScratchLinkSocketFactory(t){return new T(t)}registerPeripheralExtension(t,e){this.peripheralExtensions[t]=e}scanForPeripheral(t){this.peripheralExtensions[t]&&this.peripheralExtensions[t].scan()}connectPeripheral(t,e){this.peripheralExtensions[t]&&this.peripheralExtensions[t].connect(e)}disconnectPeripheral(t){this.peripheralExtensions[t]&&this.peripheralExtensions[t].disconnect()}getPeripheralIsConnected(t){let e=!1;return this.peripheralExtensions[t]&&(e=this.peripheralExtensions[t].isConnected()),e}emitMicListening(t){this.emit(L.MIC_LISTENING,t)}getOpcodeFunction(t){return this._primitives[t]}getIsHat(t){return this._hats.hasOwnProperty(t)}getIsEdgeActivatedHat(t){return this._hats.hasOwnProperty(t)&&this._hats[t].edgeActivated}attachAudioEngine(t){this.audioEngine=t}attachRenderer(t){this.renderer=t,this.renderer.setLayerGroupOrdering(g.LAYER_GROUPS)}attachV2SVGAdapter(t){this.v2SvgAdapter=t}attachV2BitmapAdapter(t){this.v2BitmapAdapter=t}attachStorage(t){this.storage=t}_pushThread(t,e,r){const i=new m(t);return i.target=e,i.stackClick=Boolean(r&&r.stackClick),i.updateMonitor=Boolean(r&&r.updateMonitor),i.blockContainer=i.updateMonitor?this.monitorBlocks:e.blocks,i.pushStack(t),this.threads.push(i),i}_stopThread(t){t.isKilled=!0,this.sequencer.retireThread(t)}_restartThread(t){const e=new m(t.topBlock);e.target=t.target,e.stackClick=t.stackClick,e.updateMonitor=t.updateMonitor,e.blockContainer=t.blockContainer,e.pushStack(t.topBlock);const r=this.threads.indexOf(t);return r>-1?(this.threads[r]=e,e):(this.threads.push(t),t)}isActiveThread(t){return t.stack.length>0&&t.status!==m.STATUS_DONE&&this.threads.indexOf(t)>-1}isWaitingThread(t){return t.status===m.STATUS_PROMISE_WAIT||t.status===m.STATUS_YIELD_TICK||!this.isActiveThread(t)}toggleScript(t,e){e=Object.assign({target:this._editingTarget,stackClick:!1},e);for(let r=0;r<this.threads.length;r++)if(this.threads[r].topBlock===t&&this.threads[r].status!==m.STATUS_DONE){const i=e.target.blocks,n=i.getOpcode(i.getBlock(t));if(this.getIsEdgeActivatedHat(n)&&this.threads[r].stackClick!==e.stackClick)continue;return void this._stopThread(this.threads[r])}this._pushThread(t,e.target,e)}addMonitorScript(t,e){e||(e=this._editingTarget);for(let e=0;e<this.threads.length;e++)if(this.threads[e].topBlock===t&&this.threads[e].status!==m.STATUS_DONE&&this.threads[e].updateMonitor)return;this._pushThread(t,e,{updateMonitor:!0})}allScriptsDo(t,e){let r=this.executableTargets;e&&(r=[e]);for(let e=r.length-1;e>=0;e--){const i=r[e],n=i.blocks.getScripts();for(let e=0;e<n.length;e++){t(n[e],i)}}}allScriptsByOpcodeDo(t,e,r){let i=this.executableTargets;r&&(i=[r]);for(let r=i.length-1;r>=0;r--){const n=i[r],s=a.getScripts(n.blocks,t);for(let t=0;t<s.length;t++)e(s[t],n)}}startHats(t,e,r){if(!this._hats.hasOwnProperty(t))return;const i=[],n=this._hats[t];for(const t in e)e.hasOwnProperty(t)&&(e[t]=e[t].toUpperCase());return this.allScriptsByOpcodeDo(t,(t,r)=>{const{blockId:s,fieldsOfInputs:o}=t;for(const t in e)if(o[t].value!==e[t])return;if(n.restartExistingThreads){for(let t=0;t<this.threads.length;t++)if(this.threads[t].target===r&&this.threads[t].topBlock===s&&!this.threads[t].stackClick)return void i.push(this._restartThread(this.threads[t]))}else for(let t=0;t<this.threads.length;t++)if(this.threads[t].target===r&&this.threads[t].topBlock===s&&!this.threads[t].stackClick&&this.threads[t].status!==m.STATUS_DONE)return;i.push(this._pushThread(s,r))},r),i.forEach(t=>{l(this.sequencer,t),t.status===m.STATUS_RUNNING&&t.goToNextBlock()}),i}dispose(){this.stopAll(),this.targets.forEach(t=>{t.isOriginal&&t.deleteMonitors()}),this.targets.map(this.disposeTarget,this),this._monitorState=n({}),this.emit(L.RUNTIME_DISPOSED),this.hasCloudData()&&this.emit(L.HAS_CLOUD_DATA_UPDATE,!1),this.ioDevices.cloud.clear();const t=P();this.hasCloudData=t.hasCloudVariables,this.canAddCloudVariable=t.canAddCloudVariable,this.addCloudVariable=this._initializeAddCloudVariable(t),this.removeCloudVariable=this._initializeRemoveCloudVariable(t)}addTarget(t){this.targets.push(t),this.executableTargets.push(t)}moveExecutable(t,e){const r=this.executableTargets.indexOf(t);this.executableTargets.splice(r,1);let i=r+e;return i>this.executableTargets.length&&(i=this.executableTargets.length),i<=0&&(i=this.executableTargets.length>0&&this.executableTargets[0].isStage?1:0),this.executableTargets.splice(i,0,t),i}setExecutablePosition(t,e){const r=this.executableTargets.indexOf(t);return this.moveExecutable(t,e-r)}removeExecutable(t){const e=this.executableTargets.indexOf(t);e>-1&&this.executableTargets.splice(e,1)}disposeTarget(t){this.targets=this.targets.filter(e=>t!==e||(e.dispose(),!1))}stopForTarget(t,e){this.emit(L.STOP_FOR_TARGET,t,e);for(let r=0;r<this.threads.length;r++)this.threads[r]!==e&&this.threads[r].target===t&&this._stopThread(this.threads[r])}greenFlag(){this.stopAll(),this.emit(L.PROJECT_START),this.ioDevices.clock.resetProjectTimer(),this.targets.forEach(t=>t.clearEdgeActivatedValues());for(let t=0;t<this.targets.length;t++)this.targets[t].onGreenFlag();this.startHats("event_whenflagclicked")}stopAll(){this.emit(L.PROJECT_STOP_ALL);const t=[];for(let e=0;e<this.targets.length;e++)this.targets[e].onStopAll(),this.targets[e].hasOwnProperty("isOriginal")&&!this.targets[e].isOriginal?this.targets[e].dispose():t.push(this.targets[e]);this.targets=t,null!==this.sequencer.activeThread&&this._stopThread(this.sequencer.activeThread),this.threads=[]}_step(){null!==this.profiler&&(-1===R&&(R=this.profiler.idByName("Runtime._step")),this.profiler.start(R)),this.threads=this.threads.filter(t=>!t.isKilled);for(const t in this._hats){if(!this._hats.hasOwnProperty(t))continue;this._hats[t].edgeActivated&&this.startHats(t)}this.redrawRequested=!1,this._pushMonitors(),null!==this.profiler&&(-1===D&&(D=this.profiler.idByName("Sequencer.stepThreads")),this.profiler.start(D));const t=this.sequencer.stepThreads();null!==this.profiler&&this.profiler.stop(),this._updateGlows(t),this._emitProjectRunStatus(this.threads.length+t.length-this._getMonitorThreadCount([...this.threads,...t])),this._lastStepDoneThreads=t,this.renderer&&(null!==this.profiler&&(-1===B&&(B=this.profiler.idByName("RenderWebGL.draw")),this.profiler.start(B)),this.renderer.draw(),null!==this.profiler&&this.profiler.stop()),this._refreshTargets&&(this.emit(L.TARGETS_UPDATE,!1),this._refreshTargets=!1),this._prevMonitorState.equals(this._monitorState)||(this.emit(L.MONITORS_UPDATE,this._monitorState),this._prevMonitorState=this._monitorState),null!==this.profiler&&(this.profiler.stop(),this.profiler.reportFrames())}_getMonitorThreadCount(t){let e=0;return t.forEach(t=>{t.updateMonitor&&e++}),e}_pushMonitors(){this.monitorBlocks.runAllMonitored(this)}setEditingTarget(t){const e=this._editingTarget;this._editingTarget=t,this._scriptGlowsPreviousFrame=[],this._updateGlows(),e!==this._editingTarget&&this.requestToolboxExtensionsUpdate()}setCompatibilityMode(t){this.compatibilityMode=t,this._steppingInterval&&(clearInterval(this._steppingInterval),this._steppingInterval=null,this.start())}_updateGlows(t){const e=[];e.push.apply(e,this.threads),t&&e.push.apply(e,t);const r=[],i=[];for(let t=0;t<e.length;t++){const i=e[t],n=i.target;if(n===this._editingTarget){const t=i.blockGlowInFrame;if(i.requestScriptGlowInFrame||i.stackClick){let e=n.blocks.getTopLevelScript(t);e||(e=this.flyoutBlocks.getTopLevelScript(t)),e&&r.push(e)}}}for(let t=0;t<this._scriptGlowsPreviousFrame.length;t++){const e=this._scriptGlowsPreviousFrame[t];r.indexOf(e)<0?this.glowScript(e,!1):i.push(e)}for(let t=0;t<r.length;t++){const e=r[t];this._scriptGlowsPreviousFrame.indexOf(e)<0&&(this.glowScript(e,!0),i.push(e))}this._scriptGlowsPreviousFrame=i}_emitProjectRunStatus(t){0===this._nonMonitorThreadCount&&t>0&&this.emit(L.PROJECT_RUN_START),this._nonMonitorThreadCount>0&&0===t&&this.emit(L.PROJECT_RUN_STOP),this._nonMonitorThreadCount=t}quietGlow(t){const e=this._scriptGlowsPreviousFrame.indexOf(t);e>-1&&this._scriptGlowsPreviousFrame.splice(e,1)}glowBlock(t,e){e?this.emit(L.BLOCK_GLOW_ON,{id:t}):this.emit(L.BLOCK_GLOW_OFF,{id:t})}glowScript(t,e){e?this.emit(L.SCRIPT_GLOW_ON,{id:t}):this.emit(L.SCRIPT_GLOW_OFF,{id:t})}emitBlockDragUpdate(t){this.emit(L.BLOCK_DRAG_UPDATE,t)}emitBlockEndDrag(t,e){this.emit(L.BLOCK_DRAG_END,t,e)}visualReport(t,e){this.emit(L.VISUAL_REPORT,{id:t,value:String(e)})}requestAddMonitor(t){const e=t.get("id");this.requestUpdateMonitor(t)||(this._monitorState=this._monitorState.set(e,t))}requestUpdateMonitor(t){const e=t.get("id");return!!this._monitorState.has(e)&&(this._monitorState=this._monitorState.set(e,this._monitorState.get(e).mergeWith((t,e)=>null==e?t:e,t)),!0)}requestRemoveMonitor(t){this._monitorState=this._monitorState.delete(t)}requestHideMonitor(t){return this.requestUpdateMonitor(new Map([["id",t],["visible",!1]]))}requestShowMonitor(t){return this.requestUpdateMonitor(new Map([["id",t],["visible",!0]]))}requestRemoveMonitorByTargetId(t){this._monitorState=this._monitorState.filterNot(e=>e.targetId===t)}getTargetById(t){for(let e=0;e<this.targets.length;e++){const r=this.targets[e];if(r.id===t)return r}}getSpriteTargetByName(t){for(let e=0;e<this.targets.length;e++){const r=this.targets[e];if(!r.isStage&&(r.sprite&&r.sprite.name===t))return r}}getTargetByDrawableId(t){for(let e=0;e<this.targets.length;e++){const r=this.targets[e];if(r.drawableID===t)return r}}changeCloneCounter(t){this._cloneCounter+=t}clonesAvailable(){return this._cloneCounter<L.MAX_CLONES}emitProjectLoaded(){this.emit(L.PROJECT_LOADED)}emitProjectChanged(){this.emit(L.PROJECT_CHANGED)}fireTargetWasCreated(t,e){this.emit("targetWasCreated",t,e)}fireTargetWasRemoved(t){this.emit("targetWasRemoved",t)}getTargetForStage(){for(let t=0;t<this.targets.length;t++){const e=this.targets[t];if(e.isStage)return e}}getEditingTarget(){return this._editingTarget}getAllVarNamesOfType(t){let e=[];for(const r of this.targets){const i=r.getAllVariableNamesInScopeByType(t,!0);e=e.concat(i)}return e}getLabelForOpcode(t){const[e,r]=N.splitFirst(t,"_");if(!e||!r)return;const i=this._blockInfo.find(t=>t.id===e);if(!i)return;const n=i.blocks.find(t=>t.info.opcode===r);return n?{category:"extension",label:`${i.name}: ${n.info.text}`}:void 0}createNewGlobalVariable(t,e,r){const i="string"==typeof r?r:b.SCALAR_TYPE,n=this.getAllVarNamesOfType(i),s=N.unusedName(t,n),o=new b(e||A(),s,i);return this.getTargetForStage().variables[o.id]=o,o}requestRedraw(){this.redrawRequested=!0}requestTargetsUpdate(t){t.isOriginal&&(this._refreshTargets=!0)}requestBlocksUpdate(){this.emit(L.BLOCKS_NEED_UPDATE)}requestToolboxExtensionsUpdate(){this.emit(L.TOOLBOX_EXTENSIONS_NEED_UPDATE)}start(){if(this._steppingInterval)return;let t=L.THREAD_STEP_INTERVAL;this.compatibilityMode&&(t=L.THREAD_STEP_INTERVAL_COMPATIBILITY),this.currentStepTime=t,this._steppingInterval=setInterval(()=>{this._step()},t),this.emit(L.RUNTIME_STARTED)}enableProfiling(t){c.available()&&(this.profiler=new c(t))}disableProfiling(){this.profiler=null}updateCurrentMSecs(){this.currentMSecs=Date.now()}}t.exports=L},886:function(t,e){t.exports={ANGLE:"angle",BOOLEAN:"Boolean",COLOR:"color",NUMBER:"number",STRING:"string",MATRIX:"matrix",NOTE:"note",IMAGE:"image"}},887:function(t,e,r){const i=r(446),n=r(156),s=r(98),o=function(t,e,r,n){t.attribs.id||(t.attribs.id=s());const a={id:t.attribs.id,opcode:t.attribs.type,inputs:{},fields:{},next:null,topLevel:r,parent:n,shadow:"shadow"===t.name,x:t.attribs.x,y:t.attribs.y};e[a.id]=a;for(let r=0;r<t.children.length;r++){const n=t.children[r];let s=null,u=null;for(let t=0;t<n.children.length;t++){const e=n.children[t];if(!e.name)continue;const r=e.name.toLowerCase();"block"===r?s=e:"shadow"===r&&(u=e)}switch(!s&&u&&(s=u),n.name.toLowerCase()){case"field":{const t=n.attribs.name,e=n.attribs.id;let r="";r=n.children.length>0&&n.children[0].data?n.children[0].data:"",a.fields[t]={name:t,id:e,value:r};const i=n.attribs.variabletype;"string"==typeof i&&(a.fields[t].variableType=i);break}case"comment":a.comment=n.attribs.id;break;case"value":case"statement":{o(s,e,!1,a.id),u&&s!==u&&o(u,e,!1,a.id);const t=n.attribs.name;a.inputs[t]={name:t,block:s.attribs.id,shadow:u?u.attribs.id:null};break}case"next":if(!s||!s.attribs)continue;o(s,e,!1,a.id),a.next=s.attribs.id;break;case"mutation":a.mutation=i(n)}}};t.exports=function(t){if("object"==typeof t&&"object"==typeof t.xml)return function(t){const e={};for(let r=0;r<t.length;r++){const i=t[r];if(!i.name||!i.attribs)continue;const n=i.name.toLowerCase();"block"!==n&&"shadow"!==n||o(i,e,!0,null)}const r=[];for(const t in e)e.hasOwnProperty(t)&&r.push(e[t]);return r}(n.parseDOM(t.xml.outerHTML,{decodeEntities:!0}))}},895:function(t,e,r){var i=r(156),n=i.DomHandler,s=i.DomUtils;function o(t,e){this.init(t,e)}function a(t,e){return s.getElementsByTagName(t,e,!0)}function u(t,e){return s.getElementsByTagName(t,e,!0,1)[0]}function c(t,e,r){return s.getText(s.getElementsByTagName(t,e,r,1)).trim()}function h(t,e,r,i,n){var s=c(r,i,n);s&&(t[e]=s)}r(27)(o,n),o.prototype.init=n;var l=function(t){return"rss"===t||"feed"===t||"rdf:RDF"===t};o.prototype.onend=function(){var t,e,r={},i=u(l,this.dom);i&&("feed"===i.name?(e=i.children,r.type="atom",h(r,"id","id",e),h(r,"title","title",e),(t=u("link",e))&&(t=t.attribs)&&(t=t.href)&&(r.link=t),h(r,"description","subtitle",e),(t=c("updated",e))&&(r.updated=new Date(t)),h(r,"author","email",e,!0),r.items=a("entry",e).map((function(t){var e,r={};return h(r,"id","id",t=t.children),h(r,"title","title",t),(e=u("link",t))&&(e=e.attribs)&&(e=e.href)&&(r.link=e),(e=c("summary",t)||c("content",t))&&(r.description=e),(e=c("updated",t))&&(r.pubDate=new Date(e)),r}))):(e=u("channel",i.children).children,r.type=i.name.substr(0,3),r.id="",h(r,"title","title",e),h(r,"link","link",e),h(r,"description","description",e),(t=c("lastBuildDate",e))&&(r.updated=new Date(t)),h(r,"author","managingEditor",e,!0),r.items=a("item",i.children).map((function(t){var e,r={};return h(r,"id","guid",t=t.children),h(r,"title","title",t),h(r,"link","link",t),h(r,"description","description",t),(e=c("pubDate",t))&&(r.pubDate=new Date(e)),r})))),this.dom=r,n.prototype._handleCallback.call(this,i?null:Error("couldn't find root of feed"))},t.exports=o},896:function(t,e,r){t.exports=n;var i=r(450);function n(t){i.call(this,new s(this),t)}function s(t){this.scope=t}r(27)(n,i),n.prototype.readable=!0;var o=r(156).EVENTS;Object.keys(o).forEach((function(t){if(0===o[t])s.prototype["on"+t]=function(){this.scope.emit(t)};else if(1===o[t])s.prototype["on"+t]=function(e){this.scope.emit(t,e)};else{if(2!==o[t])throw Error("wrong number of arguments!");s.prototype["on"+t]=function(e,r){this.scope.emit(t,e,r)}}}))},898:function(t,e,r){function i(t){this._cbs=t||{}}t.exports=i;var n=r(156).EVENTS;Object.keys(n).forEach((function(t){if(0===n[t])t="on"+t,i.prototype[t]=function(){this._cbs[t]&&this._cbs[t]()};else if(1===n[t])t="on"+t,i.prototype[t]=function(e){this._cbs[t]&&this._cbs[t](e)};else{if(2!==n[t])throw Error("wrong number of arguments");t="on"+t,i.prototype[t]=function(e,r){this._cbs[t]&&this._cbs[t](e,r)}}}))},913:function(t,e,r){function i(t){this._cbs=t||{},this.events=[]}t.exports=i;var n=r(156).EVENTS;Object.keys(n).forEach((function(t){if(0===n[t])t="on"+t,i.prototype[t]=function(){this.events.push([t]),this._cbs[t]&&this._cbs[t]()};else if(1===n[t])t="on"+t,i.prototype[t]=function(e){this.events.push([t,e]),this._cbs[t]&&this._cbs[t](e)};else{if(2!==n[t])throw Error("wrong number of arguments");t="on"+t,i.prototype[t]=function(e,r){this.events.push([t,e,r]),this._cbs[t]&&this._cbs[t](e,r)}}})),i.prototype.onreset=function(){this.events=[],this._cbs.onreset&&this._cbs.onreset()},i.prototype.restart=function(){this._cbs.onreset&&this._cbs.onreset();for(var t=0,e=this.events.length;t<e;t++)if(this._cbs[this.events[t][0]]){var r=this.events[t].length;1===r?this._cbs[this.events[t][0]]():2===r?this._cbs[this.events[t][0]](this.events[t][1]):this._cbs[this.events[t][0]](this.events[t][1],this.events[t][2])}}},915:function(t,e){let r=0;const i={},n=0,s=1,o=4,a=2,u="object"==typeof window&&window.performance;class c{constructor(t){this.id=-1,this.totalTime=0,this.selfTime=0,this.arg=null,this.depth=t,this.count=0}}class h{constructor(t=function(){}){this.records=[],this.increments=[],this.counters=[],this.nullFrame=new c(-1),this._stack=[new c(0)],this.onFrame=t,this.START=n,this.STOP=s}start(t,e){this.records.push(n,t,e,u.now())}stop(){this.records.push(s,u.now())}increment(t){this.increments[t]||(this.increments[t]=new c(-1),this.increments[t].id=t),this.increments[t].count+=1}frame(t,e){for(let r=0;r<this.counters.length;r++)if(this.counters[r].id===t&&this.counters[r].arg===e)return this.counters[r];const r=new c(-1);return r.id=t,r.arg=e,this.counters.push(r),r}reportFrames(){const t=this._stack;let e=1;for(let r=0;r<this.records.length;)if(this.records[r]===n){e>=t.length&&t.push(new c(e));const i=t[e++];i.id=this.records[r+1],i.arg=this.records[r+2],i.totalTime=this.records[r+3],i.selfTime=0,r+=o}else{if(this.records[r]!==s)throw this.records.length=0,new Error("Unable to decode Profiler records.");{const i=this.records[r+1],n=t[--e];n.totalTime=i-n.totalTime,n.selfTime+=n.totalTime,t[e-1].selfTime-=n.totalTime,n.count=1,this.onFrame(n),r+=a}}for(let t=0;t<this.increments.length;t++)this.increments[t]&&this.increments[t].count>0&&(this.onFrame(this.increments[t]),this.increments[t].count=0);for(let t=0;t<this.counters.length;t++)this.counters[t].count>0&&(this.onFrame(this.counters[t]),this.counters[t].count=0);this.records.length=0}idByName(t){return h.idByName(t)}nameById(t){return h.nameById(t)}static idByName(t){return"number"!=typeof i[t]&&(i[t]=r++),i[t]}static nameById(t){for(const e in i)if(i[e]===t)return e;return null}static available(){return"object"==typeof window&&void 0!==window.performance}}h.START=n,h.STOP=s,t.exports=h},916:function(t,e,r){const i=r(177),n=r(209),s=r(457),o="Sequencer.stepThread",a="Sequencer.stepThreads#inner",u="execute";let c=-1,h=-1,l=-1;class p{constructor(t){this.timer=new i,this.runtime=t,this.activeThread=null}static get WARP_TIME(){return 500}stepThreads(){const t=.75*this.runtime.currentStepTime;this.runtime.updateCurrentMSecs(),this.timer.start();let e=1/0,r=!1;const i=[];for(;this.runtime.threads.length>0&&e>0&&this.timer.timeElapsed()<t&&(this.runtime.turboMode||!this.runtime.redrawRequested);){null!==this.runtime.profiler&&(-1===h&&(h=this.runtime.profiler.idByName(a)),this.runtime.profiler.start(h)),e=0;let t=!1;const s=this.runtime.threads;for(let i=0;i<s.length;i++){const a=this.activeThread=s[i];0!==a.stack.length&&a.status!==n.STATUS_DONE?(a.status!==n.STATUS_YIELD_TICK||r||(a.status=n.STATUS_RUNNING),a.status!==n.STATUS_RUNNING&&a.status!==n.STATUS_YIELD||(null!==this.runtime.profiler&&(-1===c&&(c=this.runtime.profiler.idByName(o)),this.runtime.profiler.increment(c)),this.stepThread(a),a.warpTimer=null,a.isKilled&&i--),a.status===n.STATUS_RUNNING&&e++,0!==a.stack.length&&a.status!==n.STATUS_DONE||(t=!0)):t=!0}if(r=!0,null!==this.runtime.profiler&&this.runtime.profiler.stop(),t){let t=0;for(let e=0;e<this.runtime.threads.length;e++){const r=this.runtime.threads[e];0!==r.stack.length&&r.status!==n.STATUS_DONE?(this.runtime.threads[t]=r,t++):i.push(r)}this.runtime.threads.length=t}}return this.activeThread=null,i}stepThread(t){let e=t.peekStack();if(e||(t.popStack(),0!==t.stack.length))for(;e=t.peekStack();){let r=t.peekStackFrame().warpMode;if(r&&!t.warpTimer&&(t.warpTimer=new i,t.warpTimer.start()),null!==this.runtime.profiler&&(-1===l&&(l=this.runtime.profiler.idByName(u)),this.runtime.profiler.increment(l)),null===t.target?this.retireThread(t):s(this,t),t.blockGlowInFrame=e,t.status===n.STATUS_YIELD){if(t.status=n.STATUS_RUNNING,r&&t.warpTimer.timeElapsed()<=p.WARP_TIME)continue;return}if(t.status===n.STATUS_PROMISE_WAIT)return;if(t.status===n.STATUS_YIELD_TICK)return;for(t.peekStack()===e&&t.goToNextBlock();!t.peekStack();){if(t.popStack(),0===t.stack.length)return void(t.status=n.STATUS_DONE);const e=t.peekStackFrame();if(r=e.warpMode,e.isLoop){if(!r||t.warpTimer.timeElapsed()>p.WARP_TIME)return}else{if(e.waitingReporter)return;t.goToNextBlock()}}}else t.status=n.STATUS_DONE}stepToBranch(t,e,r){e||(e=1);const i=t.peekStack(),n=t.target.blocks.getBranch(i,e);t.peekStackFrame().isLoop=r,n?t.pushStack(n):t.pushStack(null)}stepToProcedure(t,e){const r=t.target.blocks.getProcedureDefinition(e);if(!r)return;const i=t.isRecursiveCall(e);if(t.pushStack(r),t.peekStackFrame().warpMode&&t.warpTimer.timeElapsed()>p.WARP_TIME)t.status=n.STATUS_YIELD;else{const e=t.target.blocks.getBlock(r),s=t.target.blocks.getBlock(e.inputs.custom_block.block);let o=!1;if(s&&s.mutation){const t=s.mutation.warp;"boolean"==typeof t?o=t:"string"==typeof t&&(o=JSON.parse(t))}o?t.peekStackFrame().warpMode=!0:i&&(t.status=n.STATUS_YIELD)}}retireThread(t){t.stack=[],t.stackFrame=[],t.requestScriptGlowInFrame=!1,t.status=n.STATUS_DONE}}t.exports=p},917:function(t,e,r){const i=r(209),n=r(177);t.exports=class{constructor(t=null,e=null){this.sequencer=t,this.thread=e,this._nowObj={now:()=>this.sequencer.runtime.currentMSecs}}get target(){return this.thread.target}get runtime(){return this.sequencer.runtime}get nowObj(){return this.runtime?this._nowObj:null}get stackFrame(){const t=this.thread.peekStackFrame();return null===t.executionContext&&(t.executionContext={}),t.executionContext}stackTimerFinished(){return!(this.stackFrame.timer.timeElapsed()<this.stackFrame.duration)}stackTimerNeedsInit(){return!this.stackFrame.timer}startStackTimer(t){this.nowObj?this.stackFrame.timer=new n(this.nowObj):this.stackFrame.timer=new n,this.stackFrame.timer.start(),this.stackFrame.duration=t}yield(){this.thread.status=i.STATUS_YIELD}yieldTick(){this.thread.status=i.STATUS_YIELD_TICK}startBranch(t,e){this.sequencer.stepToBranch(this.thread,t,e)}stopAll(){this.sequencer.runtime.stopAll()}stopOtherTargetThreads(){this.sequencer.runtime.stopForTarget(this.thread.target,this.thread)}stopThisScript(){this.thread.stopThisScript()}startProcedure(t){this.sequencer.stepToProcedure(this.thread,t)}getProcedureParamNamesAndIds(t){return this.thread.target.blocks.getProcedureParamNamesAndIds(t)}getProcedureParamNamesIdsAndDefaults(t){return this.thread.target.blocks.getProcedureParamNamesIdsAndDefaults(t)}initParams(){this.thread.initParams()}pushParam(t,e){this.thread.pushParam(t,e)}getParam(t){return this.thread.getParam(t)}startHats(t,e,r){const i=this.thread,n=this.sequencer,s=this.sequencer.runtime.startHats(t,e,r);return this.thread=i,this.sequencer=n,s}ioQuery(t,e,r){if(this.sequencer.runtime.ioDevices[t]&&this.sequencer.runtime.ioDevices[t][e]){const i=this.sequencer.runtime.ioDevices[t];return i[e].apply(i,r)}}}},918:function(t,e){t.exports={OUTPUT_SHAPE_HEXAGONAL:1,OUTPUT_SHAPE_ROUND:2,OUTPUT_SHAPE_SQUARE:3}},919:function(t,e){t.exports={SPRITE:"sprite",STAGE:"stage"}},921:function(t,e,r){const i=r(177);t.exports=class{constructor(t){this._projectTimer=new i({now:()=>t.currentMSecs}),this._projectTimer.start(),this._pausedTime=null,this._paused=!1,this.runtime=t}projectTimer(){return this._paused?this._pausedTime/1e3:this._projectTimer.timeElapsed()/1e3}pause(){this._paused=!0,this._pausedTime=this._projectTimer.timeElapsed()}resume(){this._paused=!1;const t=this._projectTimer.timeElapsed()-this._pausedTime;this._projectTimer.startTime+=t}resetProjectTimer(){this._projectTimer.start()}}},922:function(t,e,r){const i=r(123),n=r(59);t.exports=class{constructor(t){this.provider=null,this.runtime=t,this.stage=null}setProvider(t){this.provider=t}setStage(t){this.stage=t}postData(t){t.varUpdate&&this.updateCloudVariable(t.varUpdate)}requestCreateVariable(t){this.runtime.canAddCloudVariable()&&this.provider&&this.provider.createVariable(t.name,t.value)}requestUpdateVariable(t,e){this.provider&&this.provider.updateVariable(t,e)}requestRenameVariable(t,e){this.provider&&this.provider.renameVariable(t,e)}requestDeleteVariable(t){this.provider&&this.provider.deleteVariable(t)}updateCloudVariable(t){const e=t.name,r=this.stage.lookupVariableByNameAndType(e,i.SCALAR_TYPE);r&&r.isCloud?r.value=t.value:n.warn(`Received an update for a cloud variable that does not exist: ${e}`)}clear(){this.provider&&(this.provider.requestCloseConnection(),this.provider=null,this.stage=null)}}},923:function(t,e,r){const i=r(90),n={SPACE:"space",LEFT:"left arrow",UP:"up arrow",RIGHT:"right arrow",DOWN:"down arrow",ENTER:"enter"},s=Object.keys(n).map(t=>n[t]);t.exports=class{constructor(t){this._keysPressed=[],this.runtime=t}_keyStringToScratchKey(t){switch(t=i.toString(t)){case" ":return n.SPACE;case"ArrowLeft":case"Left":return n.LEFT;case"ArrowUp":case"Up":return n.UP;case"Right":case"ArrowRight":return n.RIGHT;case"Down":case"ArrowDown":return n.DOWN;case"Enter":return n.ENTER}return t.length>1?"":t.toUpperCase()}_keyArgToScratchKey(t){if("number"==typeof t){if(t>=48&&t<=90)return String.fromCharCode(t);switch(t){case 32:return n.SPACE;case 37:return n.LEFT;case 38:return n.UP;case 39:return n.RIGHT;case 40:return n.DOWN}}return t=i.toString(t),s.includes(t)?t:(t.length>1&&(t=t[0])," "===t?n.SPACE:t.toUpperCase())}postData(t){if(!t.key)return;const e=this._keyStringToScratchKey(t.key);if(""===e)return;const r=this._keysPressed.indexOf(e);t.isDown?(this.runtime.emit("KEY_PRESSED",e),r<0&&this._keysPressed.push(e)):r>-1&&this._keysPressed.splice(r,1)}getKeyIsDown(t){if("any"===t)return this._keysPressed.length>0;const e=this._keyArgToScratchKey(t);return this._keysPressed.indexOf(e)>-1}}},924:function(t,e,r){const i=r(109);t.exports=class{constructor(t){this._x=0,this._y=0,this._isDown=!1,this.runtime=t}_activateClickHats(t){this.runtime.startHats("event_whenthisspriteclicked",null,t),this.runtime.startHats("event_whenstageclicked",null,t)}_pickTarget(t,e){if(this.runtime.renderer){const r=this.runtime.renderer.pick(t,e);for(let t=0;t<this.runtime.targets.length;t++){const e=this.runtime.targets[t];if(e.hasOwnProperty("drawableID")&&e.drawableID===r)return e}}return this.runtime.getTargetForStage()}postData(t){if(t.x&&(this._clientX=t.x,this._scratchX=Math.round(i.clamp(480*(t.x/t.canvasWidth-.5),-240,240))),t.y&&(this._clientY=t.y,this._scratchY=Math.round(i.clamp(-360*(t.y/t.canvasHeight-.5),-180,180))),void 0!==t.isDown){const e=this._isDown;if(this._isDown=t.isDown,e===this._isDown)return;if(t.wasDragged)return;if(!(t.x>0&&t.x<t.canvasWidth&&t.y>0&&t.y<t.canvasHeight))return;const r=this._pickTarget(t.x,t.y),i=!e&&this._isDown,n=e&&!this._isDown;r.draggable&&n?this._activateClickHats(r):!r.draggable&&i&&this._activateClickHats(r)}}getClientX(){return this._clientX}getClientY(){return this._clientY}getScratchX(){return this._scratchX}getScratchY(){return this._scratchY}getIsDown(){return this._isDown}}},925:function(t,e){t.exports=class{constructor(t){this.runtime=t}postData(t){const e={};if(t.deltaY<0)e.KEY_OPTION="up arrow";else{if(!(t.deltaY>0))return;e.KEY_OPTION="down arrow"}this.runtime.startHats("event_whenkeypressed",e)}}},926:function(t,e){t.exports=class{constructor(){this._username=""}postData(t){this._username=t.username}getUsername(){return this._username}}},927:function(t,e,r){const i=r(136);class n{constructor(t){this.runtime=t,this.provider=null,this._skinId=-1,this._drawable=-1,this._ghost=0,this._forceTransparentPreview=!1}static get FORMAT_IMAGE_DATA(){return"image-data"}static get FORMAT_CANVAS(){return"canvas"}static get DIMENSIONS(){return[480,360]}static get ORDER(){return 1}setProvider(t){this.provider=t}enableVideo(){return this.provider?this.provider.enableVideo().then(()=>this._setupPreview()):null}disableVideo(){if(this._disablePreview(),!this.provider)return null;this.provider.disableVideo()}getFrame({dimensions:t=n.DIMENSIONS,mirror:e=this.mirror,format:r=n.FORMAT_IMAGE_DATA,cacheTimeout:i=this._frameCacheTimeout}){return this.provider?this.provider.getFrame({dimensions:t,mirror:e,format:r,cacheTimeout:i}):null}setPreviewGhost(t){this._ghost=t,-1!==this._drawable&&this.runtime.renderer.updateDrawableProperties(this._drawable,{ghost:this._forceTransparentPreview?100:t})}_disablePreview(){-1!==this._skinId&&(this.runtime.renderer.updateBitmapSkin(this._skinId,new ImageData(...n.DIMENSIONS),1),this.runtime.renderer.updateDrawableProperties(this._drawable,{visible:!1})),this._renderPreviewFrame=null}_setupPreview(){const{renderer:t}=this.runtime;t&&(-1===this._skinId&&-1===this._drawable&&(this._skinId=t.createBitmapSkin(new ImageData(...n.DIMENSIONS),1),this._drawable=t.createDrawable(i.VIDEO_LAYER),t.updateDrawableProperties(this._drawable,{skinId:this._skinId})),this._renderPreviewFrame||(t.updateDrawableProperties(this._drawable,{ghost:this._forceTransparentPreview?100:this._ghost,visible:!0}),this._renderPreviewFrame=()=>{if(clearTimeout(this._renderPreviewTimeout),!this._renderPreviewFrame)return;this._renderPreviewTimeout=setTimeout(this._renderPreviewFrame,this.runtime.currentStepTime);const e=this.getFrame({format:n.FORMAT_IMAGE_DATA,cacheTimeout:this.runtime.currentStepTime});e?(t.updateBitmapSkin(this._skinId,e,1),this.runtime.requestRedraw()):t.updateBitmapSkin(this._skinId,new ImageData(...n.DIMENSIONS),1)},this._renderPreviewFrame()))}get videoReady(){return!!this.provider&&this.provider.videoReady}postData({forceTransparentPreview:t}){this._forceTransparentPreview=t,this.setPreviewGhost(this._ghost)}}t.exports=n},928:function(t,e,r){const i=r(90);t.exports=class{constructor(t){this.runtime=t,this._counter=0}getPrimitives(){return{control_repeat:this.repeat,control_repeat_until:this.repeatUntil,control_while:this.repeatWhile,control_for_each:this.forEach,control_forever:this.forever,control_wait:this.wait,control_wait_until:this.waitUntil,control_if:this.if,control_if_else:this.ifElse,control_stop:this.stop,control_create_clone_of:this.createClone,control_delete_this_clone:this.deleteClone,control_get_counter:this.getCounter,control_incr_counter:this.incrCounter,control_clear_counter:this.clearCounter,control_all_at_once:this.allAtOnce}}getHats(){return{control_start_as_clone:{restartExistingThreads:!1}}}repeat(t,e){const r=Math.round(i.toNumber(t.TIMES));void 0===e.stackFrame.loopCounter&&(e.stackFrame.loopCounter=r),e.stackFrame.loopCounter--,e.stackFrame.loopCounter>=0&&e.startBranch(1,!0)}repeatUntil(t,e){i.toBoolean(t.CONDITION)||e.startBranch(1,!0)}repeatWhile(t,e){i.toBoolean(t.CONDITION)&&e.startBranch(1,!0)}forEach(t,e){const r=e.target.lookupOrCreateVariable(t.VARIABLE.id,t.VARIABLE.name);void 0===e.stackFrame.index&&(e.stackFrame.index=0),e.stackFrame.index<Number(t.VALUE)&&(e.stackFrame.index++,r.value=e.stackFrame.index,e.startBranch(1,!0))}waitUntil(t,e){i.toBoolean(t.CONDITION)||e.yield()}forever(t,e){e.startBranch(1,!0)}wait(t,e){if(e.stackTimerNeedsInit()){const r=Math.max(0,1e3*i.toNumber(t.DURATION));e.startStackTimer(r),this.runtime.requestRedraw(),e.yield()}else e.stackTimerFinished()||e.yield()}if(t,e){i.toBoolean(t.CONDITION)&&e.startBranch(1,!1)}ifElse(t,e){i.toBoolean(t.CONDITION)?e.startBranch(1,!1):e.startBranch(2,!1)}stop(t,e){const r=t.STOP_OPTION;"all"===r?e.stopAll():"other scripts in sprite"===r||"other scripts in stage"===r?e.stopOtherTargetThreads():"this script"===r&&e.stopThisScript()}createClone(t,e){let r;if(t.CLONE_OPTION=i.toString(t.CLONE_OPTION),r="_myself_"===t.CLONE_OPTION?e.target:this.runtime.getSpriteTargetByName(t.CLONE_OPTION),!r)return;const n=r.makeClone();n&&(this.runtime.addTarget(n),n.goBehindOther(r))}deleteClone(t,e){e.target.isOriginal||(this.runtime.disposeTarget(e.target),this.runtime.stopForTarget(e.target))}getCounter(){return this._counter}clearCounter(){this._counter=0}incrCounter(){this._counter++}allAtOnce(t,e){e.startBranch(1,!1)}}},929:function(t,e,r){const i=r(90);t.exports=class{constructor(t){this.runtime=t,this.runtime.on("KEY_PRESSED",t=>{this.runtime.startHats("event_whenkeypressed",{KEY_OPTION:t}),this.runtime.startHats("event_whenkeypressed",{KEY_OPTION:"any"})})}getPrimitives(){return{event_whentouchingobject:this.touchingObject,event_broadcast:this.broadcast,event_broadcastandwait:this.broadcastAndWait,event_whengreaterthan:this.hatGreaterThanPredicate}}getHats(){return{event_whenflagclicked:{restartExistingThreads:!0},event_whenkeypressed:{restartExistingThreads:!1},event_whenthisspriteclicked:{restartExistingThreads:!0},event_whentouchingobject:{restartExistingThreads:!1,edgeActivated:!0},event_whenstageclicked:{restartExistingThreads:!0},event_whenbackdropswitchesto:{restartExistingThreads:!0},event_whengreaterthan:{restartExistingThreads:!1,edgeActivated:!0},event_whenbroadcastreceived:{restartExistingThreads:!0}}}touchingObject(t,e){return e.target.isTouchingObject(t.TOUCHINGOBJECTMENU)}hatGreaterThanPredicate(t,e){const r=i.toString(t.WHENGREATERTHANMENU).toLowerCase(),n=i.toNumber(t.VALUE);switch(r){case"timer":return e.ioQuery("clock","projectTimer")>n;case"loudness":return this.runtime.audioEngine&&this.runtime.audioEngine.getLoudness()>n}return!1}broadcast(t,e){const r=e.runtime.getTargetForStage().lookupBroadcastMsg(t.BROADCAST_OPTION.id,t.BROADCAST_OPTION.name);if(r){const t=r.name;e.startHats("event_whenbroadcastreceived",{BROADCAST_OPTION:t})}}broadcastAndWait(t,e){const r=e.runtime.getTargetForStage().lookupBroadcastMsg(t.BROADCAST_OPTION.id,t.BROADCAST_OPTION.name);if(r){const t=r.name;if(!e.stackFrame.startedThreads&&(e.stackFrame.startedThreads=e.startHats("event_whenbroadcastreceived",{BROADCAST_OPTION:t}),0===e.stackFrame.startedThreads.length))return;const i=this;e.stackFrame.startedThreads.some(t=>-1!==i.runtime.threads.indexOf(t))&&(e.stackFrame.startedThreads.every(t=>i.runtime.isWaitingThread(t))?e.yieldTick():e.yield())}}}},930:function(t,e,r){const i=r(90),n=r(208),s=r(293),o=r(98),a=r(136),u=r(292),c=r(109);class h{constructor(t){this.runtime=t,this._onTargetChanged=this._onTargetChanged.bind(this),this._onResetBubbles=this._onResetBubbles.bind(this),this._onTargetWillExit=this._onTargetWillExit.bind(this),this._updateBubble=this._updateBubble.bind(this),this.runtime.on("PROJECT_STOP_ALL",this._onResetBubbles),this.runtime.on("targetWasRemoved",this._onTargetWillExit),this.runtime.on("SAY",this._updateBubble)}static get DEFAULT_BUBBLE_STATE(){return{drawableId:null,onSpriteRight:!0,skinId:null,text:"",type:"say",usageId:null}}static get STATE_KEY(){return"Scratch.looks"}static get SAY_BUBBLE_LIMIT(){return 330}static get EFFECT_GHOST_LIMIT(){return{min:0,max:100}}static get EFFECT_BRIGHTNESS_LIMIT(){return{min:-100,max:100}}_getBubbleState(t){let e=t.getCustomState(h.STATE_KEY);return e||(e=n.simple(h.DEFAULT_BUBBLE_STATE),t.setCustomState(h.STATE_KEY,e)),e}_onTargetChanged(t){this._getBubbleState(t).drawableId&&this._positionBubble(t)}_onTargetWillExit(t){const e=this._getBubbleState(t);e.drawableId&&e.skinId&&(this.runtime.renderer.destroyDrawable(e.drawableId,a.SPRITE_LAYER),this.runtime.renderer.destroySkin(e.skinId),e.drawableId=null,e.skinId=null,this.runtime.requestRedraw()),t.removeListener(s.EVENT_TARGET_VISUAL_CHANGE,this._onTargetChanged)}_onResetBubbles(){for(let t=0;t<this.runtime.targets.length;t++){this._getBubbleState(this.runtime.targets[t]).text="",this._onTargetWillExit(this.runtime.targets[t])}clearTimeout(this._bubbleTimeout)}_positionBubble(t){if(!t.visible)return;const e=this._getBubbleState(t),[r,i]=this.runtime.renderer.getCurrentSkinSize(e.drawableId);let n;try{n=t.getBoundsForBubble()}catch(e){n={left:t.x,right:t.x,top:t.y,bottom:t.y}}const s=this.runtime.renderer.getNativeSize(),o={left:-s[0]/2,right:s[0]/2,top:s[1]/2,bottom:-s[1]/2};e.onSpriteRight&&r+n.right>o.right&&n.left-r>o.left?(e.onSpriteRight=!1,this._renderBubble(t)):!e.onSpriteRight&&n.left-r<o.left&&r+n.right<o.right?(e.onSpriteRight=!0,this._renderBubble(t)):(this.runtime.renderer.updateDrawableProperties(e.drawableId,{position:[e.onSpriteRight?Math.max(o.left,Math.min(o.right-r,n.right)):Math.min(o.right-r,Math.max(o.left,n.left-r)),Math.min(o.top,n.bottom+i)]}),this.runtime.requestRedraw())}_renderBubble(t){if(!this.runtime.renderer)return;const e=this._getBubbleState(t),{type:r,text:i,onSpriteRight:n}=e;t.visible&&""!==i?(e.skinId?this.runtime.renderer.updateTextSkin(e.skinId,r,i,n,[0,0]):(t.addListener(s.EVENT_TARGET_VISUAL_CHANGE,this._onTargetChanged),e.drawableId=this.runtime.renderer.createDrawable(a.SPRITE_LAYER),e.skinId=this.runtime.renderer.createTextSkin(r,i,e.onSpriteRight,[0,0]),this.runtime.renderer.updateDrawableProperties(e.drawableId,{skinId:e.skinId})),this._positionBubble(t)):this._onTargetWillExit(t)}_updateBubble(t,e,r){const i=this._getBubbleState(t);i.type=e,i.text=r,i.usageId=o(),this._renderBubble(t)}getPrimitives(){return{looks_say:this.say,looks_sayforsecs:this.sayforsecs,looks_think:this.think,looks_thinkforsecs:this.thinkforsecs,looks_show:this.show,looks_hide:this.hide,looks_hideallsprites:()=>{},looks_switchcostumeto:this.switchCostume,looks_switchbackdropto:this.switchBackdrop,looks_switchbackdroptoandwait:this.switchBackdropAndWait,looks_nextcostume:this.nextCostume,looks_nextbackdrop:this.nextBackdrop,looks_changeeffectby:this.changeEffect,looks_seteffectto:this.setEffect,looks_cleargraphiceffects:this.clearEffects,looks_changesizeby:this.changeSize,looks_setsizeto:this.setSize,looks_changestretchby:()=>{},looks_setstretchto:()=>{},looks_gotofrontback:this.goToFrontBack,looks_goforwardbackwardlayers:this.goForwardBackwardLayers,looks_size:this.getSize,looks_costumenumbername:this.getCostumeNumberName,looks_backdropnumbername:this.getBackdropNumberName}}getMonitored(){return{looks_size:{isSpriteSpecific:!0,getId:t=>`${t}_size`},looks_costumenumbername:{isSpriteSpecific:!0,getId:(t,e)=>u(`${t}_costumenumbername`,e)},looks_backdropnumbername:{getId:(t,e)=>u("backdropnumbername",e)}}}say(t,e){let r=t.MESSAGE;"number"==typeof r&&(r=parseFloat(r.toFixed(2))),r=String(r).substr(0,h.SAY_BUBBLE_LIMIT),this.runtime.emit("SAY",e.target,"say",r)}sayforsecs(t,e){this.say(t,e);const r=e.target,i=this._getBubbleState(r).usageId;return new Promise(e=>{this._bubbleTimeout=setTimeout(()=>{this._bubbleTimeout=null,this._getBubbleState(r).usageId===i&&this._updateBubble(r,"say",""),e()},1e3*t.SECS)})}think(t,e){this._updateBubble(e.target,"think",String(t.MESSAGE).substr(0,h.SAY_BUBBLE_LIMIT))}thinkforsecs(t,e){this.think(t,e);const r=e.target,i=this._getBubbleState(r).usageId;return new Promise(e=>{this._bubbleTimeout=setTimeout(()=>{this._bubbleTimeout=null,this._getBubbleState(r).usageId===i&&this._updateBubble(r,"think",""),e()},1e3*t.SECS)})}show(t,e){e.target.setVisible(!0),this._renderBubble(e.target)}hide(t,e){e.target.setVisible(!1),this._renderBubble(e.target)}_setCostume(t,e,r){if("number"==typeof e)t.setCostume(r?e:e-1);else{const n=t.getCostumeIndexByName(e.toString());-1!==n?t.setCostume(n):"next costume"===e?t.setCostume(t.currentCostume+1):"previous costume"===e?t.setCostume(t.currentCostume-1):isNaN(e)||i.isWhiteSpace(e)||t.setCostume(r?Number(e):Number(e)-1)}return[]}_setBackdrop(t,e,r){if("number"==typeof e)t.setCostume(r?e:e-1);else{const n=t.getCostumeIndexByName(e.toString());if(-1!==n)t.setCostume(n);else if("next backdrop"===e)t.setCostume(t.currentCostume+1);else if("previous backdrop"===e)t.setCostume(t.currentCostume-1);else if("random backdrop"===e){const e=t.getCostumes().length;if(e>1){let r=Math.floor(Math.random()*(e-1));r===t.currentCostume&&(r+=1),t.setCostume(r)}}else isNaN(e)||i.isWhiteSpace(e)||t.setCostume(r?Number(e):Number(e)-1)}const n=t.getCostumes()[t.currentCostume].name;return this.runtime.startHats("event_whenbackdropswitchesto",{BACKDROP:n})}switchCostume(t,e){this._setCostume(e.target,t.COSTUME)}nextCostume(t,e){this._setCostume(e.target,e.target.currentCostume+1,!0)}switchBackdrop(t){this._setBackdrop(this.runtime.getTargetForStage(),t.BACKDROP)}switchBackdropAndWait(t,e){if(!e.stackFrame.startedThreads&&(e.stackFrame.startedThreads=this._setBackdrop(this.runtime.getTargetForStage(),t.BACKDROP),0===e.stackFrame.startedThreads.length))return;const r=this;e.stackFrame.startedThreads.some(t=>-1!==r.runtime.threads.indexOf(t))&&(e.stackFrame.startedThreads.every(t=>r.runtime.isWaitingThread(t))?e.yieldTick():e.yield())}nextBackdrop(){const t=this.runtime.getTargetForStage();this._setBackdrop(t,t.currentCostume+1,!0)}clampEffect(t,e){let r=e;switch(t){case"ghost":r=c.clamp(e,h.EFFECT_GHOST_LIMIT.min,h.EFFECT_GHOST_LIMIT.max);break;case"brightness":r=c.clamp(e,h.EFFECT_BRIGHTNESS_LIMIT.min,h.EFFECT_BRIGHTNESS_LIMIT.max)}return r}changeEffect(t,e){const r=i.toString(t.EFFECT).toLowerCase(),n=i.toNumber(t.CHANGE);if(!e.target.effects.hasOwnProperty(r))return;let s=n+e.target.effects[r];s=this.clampEffect(r,s),e.target.setEffect(r,s)}setEffect(t,e){const r=i.toString(t.EFFECT).toLowerCase();let n=i.toNumber(t.VALUE);n=this.clampEffect(r,n),e.target.setEffect(r,n)}clearEffects(t,e){e.target.clearEffects()}changeSize(t,e){const r=i.toNumber(t.CHANGE);e.target.setSize(e.target.size+r)}setSize(t,e){const r=i.toNumber(t.SIZE);e.target.setSize(r)}goToFrontBack(t,e){e.target.isStage||("front"===t.FRONT_BACK?e.target.goToFront():e.target.goToBack())}goForwardBackwardLayers(t,e){e.target.isStage||("forward"===t.FORWARD_BACKWARD?e.target.goForwardLayers(i.toNumber(t.NUM)):e.target.goBackwardLayers(i.toNumber(t.NUM)))}getSize(t,e){return Math.round(e.target.size)}getBackdropNumberName(t){const e=this.runtime.getTargetForStage();return"number"===t.NUMBER_NAME?e.currentCostume+1:e.getCostumes()[e.currentCostume].name}getCostumeNumberName(t,e){return"number"===t.NUMBER_NAME?e.target.currentCostume+1:e.target.getCostumes()[e.target.currentCostume].name}}t.exports=h},931:function(t,e,r){const i=r(40),n=r(135),s=r(123),o=r(294),a=r(98),{Map:u}=r(175),c=r(59),h=r(110),l=r(459);t.exports=class extends i{constructor(t,e){super(),e||(e=new n(t)),this.runtime=t,this.id=a(),this.blocks=e,this.variables={},this.comments={},this._customState={},this._edgeActivatedHatValues={}}onGreenFlag(){}getName(){return this.id}updateEdgeActivatedValue(t,e){const r=this._edgeActivatedHatValues[t];return this._edgeActivatedHatValues[t]=e,r}hasEdgeActivatedValue(t){return this._edgeActivatedHatValues.hasOwnProperty(t)}clearEdgeActivatedValues(){this._edgeActivatedHatValues={}}lookupOrCreateVariable(t,e){let r=this.lookupVariableById(t);if(r)return r;if(r=this.lookupVariableByNameAndType(e,s.SCALAR_TYPE),r)return r;const i=new s(t,e,s.SCALAR_TYPE,!1);return this.variables[t]=i,i}lookupBroadcastMsg(t,e){let r;if(t?r=this.lookupVariableById(t):e?r=this.lookupBroadcastByInputValue(e):c.error("Cannot find broadcast message if neither id nor name are provided."),r)return e&&r.name.toLowerCase()!==e.toLowerCase()&&c.error(`Found broadcast message with id: ${t}, but`+`its name, ${r.name} did not match expected name ${e}.`),r.type!==s.BROADCAST_MESSAGE_TYPE&&c.error(`Found variable with id: ${t}, but its type ${r.type}`+`did not match expected type ${s.BROADCAST_MESSAGE_TYPE}`),r}lookupBroadcastByInputValue(t){const e=this.variables;for(const r in e)if(e[r].type===s.BROADCAST_MESSAGE_TYPE&&e[r].name.toLowerCase()===t.toLowerCase())return e[r]}lookupVariableById(t){if(this.variables.hasOwnProperty(t))return this.variables[t];if(this.runtime&&!this.isStage){const e=this.runtime.getTargetForStage();if(e&&e.variables.hasOwnProperty(t))return e.variables[t]}}lookupVariableByNameAndType(t,e,r){if("string"==typeof t){"string"!=typeof e&&(e=s.SCALAR_TYPE),r=r||!1;for(const r in this.variables){const i=this.variables[r];if(i.name===t&&i.type===e)return i}if(!r&&this.runtime&&!this.isStage){const r=this.runtime.getTargetForStage();if(r)for(const i in r.variables){const n=r.variables[i];if(n.name===t&&n.type===e)return n}}return null}}lookupOrCreateList(t,e){let r=this.lookupVariableById(t);if(r)return r;if(r=this.lookupVariableByNameAndType(e,s.LIST_TYPE),r)return r;const i=new s(t,e,s.LIST_TYPE,!1);return this.variables[t]=i,i}createVariable(t,e,r,i){if(!this.variables.hasOwnProperty(t)){const n=new s(t,e,r,!1);i&&this.isStage&&this.runtime.canAddCloudVariable()&&(n.isCloud=!0,this.runtime.addCloudVariable(),this.runtime.ioDevices.cloud.requestCreateVariable(n)),this.variables[t]=n}}createComment(t,e,r,i,n,s,a,u){if(!this.comments.hasOwnProperty(t)){const h=new o(t,r,i,n,s,a,u);if(e){h.blockId=e;const r=this.blocks.getBlock(e);r?r.comment=t:c.warn(`Could not find block with id ${e} associated with commentId: ${t}`)}this.comments[t]=h}}renameVariable(t,e){if(this.variables.hasOwnProperty(t)){const r=this.variables[t];if(r.id===t){const i=r.name;if(r.name=e,this.runtime){r.isCloud&&this.isStage&&this.runtime.ioDevices.cloud.requestRenameVariable(i,e);const n=this.runtime.monitorBlocks;n.changeBlock({id:t,element:"field",name:"list"===r.type?"LIST":"VARIABLE",value:t},this.runtime);const s=n.getBlock(r.id);s&&this.runtime.requestUpdateMonitor(u({id:t,params:n._getBlockParams(s)}))}}}}deleteVariable(t){if(this.variables.hasOwnProperty(t)){const e=this.variables[t].name,r=this.variables[t].isCloud;delete this.variables[t],this.runtime&&(r&&this.isStage&&(this.runtime.ioDevices.cloud.requestDeleteVariable(e),this.runtime.removeCloudVariable()),this.runtime.monitorBlocks.deleteBlock(t),this.runtime.requestRemoveMonitor(t))}}deleteMonitors(){let t;this.runtime.requestRemoveMonitorByTargetId(this.id),t=this.isStage?Object.keys(this.variables):Object.keys(this.runtime.monitorBlocks._blocks).filter(t=>this.runtime.monitorBlocks._blocks[t].targetId===this.id);for(const e of t)this.runtime.monitorBlocks.deleteBlock(e)}duplicateVariable(t,e){if(this.variables.hasOwnProperty(t)){const r=this.variables[t],i=new s(e?t:null,r.name,r.type,r.isCloud);return i.type===s.LIST_TYPE?i.value=r.value.slice(0):i.value=r.value,i}return null}duplicateVariables(t){let e;return t&&(e=t.getAllVariableAndListReferences()),Object.keys(this.variables).reduce((r,i)=>{const n=this.duplicateVariable(i,!t);if(r[n.id]=n,t&&e){const t=e[i];t&&this.mergeVariables(i,n.id,t)}return r},{})}postSpriteInfo(){}getCustomState(t){return this._customState[t]}setCustomState(t,e){this._customState[t]=e}dispose(){this._customState={},this.runtime&&this.runtime.removeExecutable(this)}getAllVariableNamesInScopeByType(t,e){"string"!=typeof t&&(t=s.SCALAR_TYPE),e=e||!1;const r=Object.values(this.variables).filter(e=>e.type===t).map(t=>t.name);if(e||this.isStage||!this.runtime)return r;const i=this.runtime.getTargetForStage().getAllVariableNamesInScopeByType(t);return r.concat(i)}mergeVariables(t,e,r,i){const n=r||this.blocks.getAllVariableAndListReferences()[t];l.updateVariableIdentifiers(n,e,i)}shareLocalVariableToStage(t,e){if(!this.runtime)return;const r=this.variables[t];if(!r)return void c.warn("Cannot share a local variable to the stage if it's not local.");const i=`StageVarFromLocal_${t}`;let n=this.runtime.getTargetForStage().lookupVariableById(i);if(!n){const t=r.name,e=r.type,s=`Stage: ${t}`;n=this.runtime.createNewGlobalVariable(s,i,e)}this.mergeVariables(t,n.id,e,n.name)}shareLocalVariableToSprite(t,e,r){if(!this.runtime)return;if(this.isStage)return;const i=this.variables[t];if(!i)return void c.warn("Tried to call 'shareLocalVariableToSprite' with a non-local variable.");const n=i.name,o=i.type,a=e.lookupVariableByNameAndType(n,o);let u;if(a)u=a.id;else{const t=new s(null,n,o);u=t.id,e.variables[u]=t}this.mergeVariables(t,u,r)}resolveVariableSharingConflictsWithTarget(t,e){if(this.isStage)return;const r=this.blocks.getAllVariableAndListReferences(t);for(const t in r){if(!this.variables[t])continue;const i=r[t];e.isStage?this.shareLocalVariableToStage(t,i):this.shareLocalVariableToSprite(t,e,i)}}fixUpVariableReferences(){if(!this.runtime)return;if(this.isStage)return;const t=this.runtime.getTargetForStage();if(!t||!t.variables)return;const e=(e,r,i)=>{if(t.lookupVariableByNameAndType(r,i)){const t=h.unusedName(`${this.getName()}: ${r}`,this.getAllVariableNamesInScopeByType(i));return this.renameVariable(e,t),t}return null},r=this.blocks.getAllVariableAndListReferences(),i=[];if(Object.keys(this.variables).length>0)for(const t in this.variables)this.variables.hasOwnProperty(t)&&(r[t]||i.push(t));const n=Object.create(null),s=Object.create(null),o={},a=t=>{const e=o[t];return e||(o[t]=this.runtime.getAllVarNamesOfType(t),o[t])};for(const i in r){const o=r[i][0],u=o.referencingField.value,c=o.type;if(this.lookupVariableById(i)){if(this.variables.hasOwnProperty(i)){const t=e(i,u,c);t&&r[i].map(e=>(e.referencingField.value=t,e))}}else{const e=t.lookupVariableByNameAndType(u,c);if(e)n[i]||(n[i]=e.id);else{const e=a(c),r=h.unusedName(u,e);t.createVariable(i,r,c),s[i]||(s[i]=r)}}}for(const t in i){const r=i[t];e(r,this.variables[r].name,this.variables[r].type)}for(const t in n){const e=n[t],i=r[t];this.mergeVariables(t,e,i)}for(const t in s){const e=s[t];r[t].map(t=>(t.referencingField.value=e,t))}}}},932:function(t,e,r){const i=r(90),n=r(109),s=r(177);t.exports=class{constructor(t){this.runtime=t}getPrimitives(){return{motion_movesteps:this.moveSteps,motion_gotoxy:this.goToXY,motion_goto:this.goTo,motion_turnright:this.turnRight,motion_turnleft:this.turnLeft,motion_pointindirection:this.pointInDirection,motion_pointtowards:this.pointTowards,motion_glidesecstoxy:this.glide,motion_glideto:this.glideTo,motion_ifonedgebounce:this.ifOnEdgeBounce,motion_setrotationstyle:this.setRotationStyle,motion_changexby:this.changeX,motion_setx:this.setX,motion_changeyby:this.changeY,motion_sety:this.setY,motion_xposition:this.getX,motion_yposition:this.getY,motion_direction:this.getDirection,motion_scroll_right:()=>{},motion_scroll_up:()=>{},motion_align_scene:()=>{},motion_xscroll:()=>{},motion_yscroll:()=>{}}}getMonitored(){return{motion_xposition:{isSpriteSpecific:!0,getId:t=>`${t}_xposition`},motion_yposition:{isSpriteSpecific:!0,getId:t=>`${t}_yposition`},motion_direction:{isSpriteSpecific:!0,getId:t=>`${t}_direction`}}}moveSteps(t,e){const r=i.toNumber(t.STEPS),s=n.degToRad(90-e.target.direction),o=r*Math.cos(s),a=r*Math.sin(s);e.target.setXY(e.target.x+o,e.target.y+a)}goToXY(t,e){const r=i.toNumber(t.X),n=i.toNumber(t.Y);e.target.setXY(r,n)}getTargetXY(t,e){let r=0,n=0;if("_mouse_"===t)r=e.ioQuery("mouse","getScratchX"),n=e.ioQuery("mouse","getScratchY");else if("_random_"===t){const t=this.runtime.constructor.STAGE_WIDTH,e=this.runtime.constructor.STAGE_HEIGHT;r=Math.round(t*(Math.random()-.5)),n=Math.round(e*(Math.random()-.5))}else{t=i.toString(t);const e=this.runtime.getSpriteTargetByName(t);if(!e)return;r=e.x,n=e.y}return[r,n]}goTo(t,e){const r=this.getTargetXY(t.TO,e);r&&e.target.setXY(r[0],r[1])}turnRight(t,e){const r=i.toNumber(t.DEGREES);e.target.setDirection(e.target.direction+r)}turnLeft(t,e){const r=i.toNumber(t.DEGREES);e.target.setDirection(e.target.direction-r)}pointInDirection(t,e){const r=i.toNumber(t.DIRECTION);e.target.setDirection(r)}pointTowards(t,e){let r=0,s=0;if("_mouse_"===t.TOWARDS)r=e.ioQuery("mouse","getScratchX"),s=e.ioQuery("mouse","getScratchY");else{if("_random_"===t.TOWARDS)return void e.target.setDirection(Math.round(360*Math.random())-180);{t.TOWARDS=i.toString(t.TOWARDS);const e=this.runtime.getSpriteTargetByName(t.TOWARDS);if(!e)return;r=e.x,s=e.y}}const o=r-e.target.x,a=s-e.target.y,u=90-n.radToDeg(Math.atan2(a,o));e.target.setDirection(u)}glide(t,e){if(e.stackFrame.timer){const t=e.stackFrame.timer.timeElapsed();if(t<1e3*e.stackFrame.duration){const r=t/(1e3*e.stackFrame.duration),i=r*(e.stackFrame.endX-e.stackFrame.startX),n=r*(e.stackFrame.endY-e.stackFrame.startY);e.target.setXY(e.stackFrame.startX+i,e.stackFrame.startY+n),e.yield()}else e.target.setXY(e.stackFrame.endX,e.stackFrame.endY)}else{if(e.stackFrame.timer=new s,e.stackFrame.timer.start(),e.stackFrame.duration=i.toNumber(t.SECS),e.stackFrame.startX=e.target.x,e.stackFrame.startY=e.target.y,e.stackFrame.endX=i.toNumber(t.X),e.stackFrame.endY=i.toNumber(t.Y),e.stackFrame.duration<=0)return void e.target.setXY(e.stackFrame.endX,e.stackFrame.endY);e.yield()}}glideTo(t,e){const r=this.getTargetXY(t.TO,e);r&&this.glide({SECS:t.SECS,X:r[0],Y:r[1]},e)}ifOnEdgeBounce(t,e){const r=e.target.getBounds();if(!r)return;const i=this.runtime.constructor.STAGE_WIDTH,s=this.runtime.constructor.STAGE_HEIGHT,o=Math.max(0,i/2+r.left),a=Math.max(0,s/2-r.top),u=Math.max(0,i/2-r.right),c=Math.max(0,s/2+r.bottom);let h="",l=1/0;if(o<l&&(l=o,h="left"),a<l&&(l=a,h="top"),u<l&&(l=u,h="right"),c<l&&(l=c,h="bottom"),l>0)return;const p=n.degToRad(90-e.target.direction);let d=Math.cos(p),m=-Math.sin(p);"left"===h?d=Math.max(.2,Math.abs(d)):"top"===h?m=Math.max(.2,Math.abs(m)):"right"===h?d=0-Math.max(.2,Math.abs(d)):"bottom"===h&&(m=0-Math.max(.2,Math.abs(m)));const _=n.radToDeg(Math.atan2(m,d))+90;e.target.setDirection(_);const f=e.target.keepInFence(e.target.x,e.target.y);e.target.setXY(f[0],f[1])}setRotationStyle(t,e){e.target.setRotationStyle(t.STYLE)}changeX(t,e){const r=i.toNumber(t.DX);e.target.setXY(e.target.x+r,e.target.y)}setX(t,e){const r=i.toNumber(t.X);e.target.setXY(r,e.target.y)}changeY(t,e){const r=i.toNumber(t.DY);e.target.setXY(e.target.x,e.target.y+r)}setY(t,e){const r=i.toNumber(t.Y);e.target.setXY(e.target.x,r)}getX(t,e){return this.limitPrecision(e.target.x)}getY(t,e){return this.limitPrecision(e.target.y)}getDirection(t,e){return e.target.direction}limitPrecision(t){const e=Math.round(t),r=t-e;return Math.abs(r)<1e-9?e:t}}},933:function(t,e,r){const i=r(90),n=r(109);t.exports=class{constructor(t){this.runtime=t}getPrimitives(){return{operator_add:this.add,operator_subtract:this.subtract,operator_multiply:this.multiply,operator_divide:this.divide,operator_lt:this.lt,operator_equals:this.equals,operator_gt:this.gt,operator_and:this.and,operator_or:this.or,operator_not:this.not,operator_random:this.random,operator_join:this.join,operator_letter_of:this.letterOf,operator_length:this.length,operator_contains:this.contains,operator_mod:this.mod,operator_round:this.round,operator_mathop:this.mathop}}add(t){return i.toNumber(t.NUM1)+i.toNumber(t.NUM2)}subtract(t){return i.toNumber(t.NUM1)-i.toNumber(t.NUM2)}multiply(t){return i.toNumber(t.NUM1)*i.toNumber(t.NUM2)}divide(t){return i.toNumber(t.NUM1)/i.toNumber(t.NUM2)}lt(t){return i.compare(t.OPERAND1,t.OPERAND2)<0}equals(t){return 0===i.compare(t.OPERAND1,t.OPERAND2)}gt(t){return i.compare(t.OPERAND1,t.OPERAND2)>0}and(t){return i.toBoolean(t.OPERAND1)&&i.toBoolean(t.OPERAND2)}or(t){return i.toBoolean(t.OPERAND1)||i.toBoolean(t.OPERAND2)}not(t){return!i.toBoolean(t.OPERAND)}random(t){const e=i.toNumber(t.FROM),r=i.toNumber(t.TO),n=e<=r?e:r,s=e<=r?r:e;return n===s?n:i.isInt(t.FROM)&&i.isInt(t.TO)?n+Math.floor(Math.random()*(s+1-n)):Math.random()*(s-n)+n}join(t){return i.toString(t.STRING1)+i.toString(t.STRING2)}letterOf(t){const e=i.toNumber(t.LETTER)-1,r=i.toString(t.STRING);return e<0||e>=r.length?"":r.charAt(e)}length(t){return i.toString(t.STRING).length}contains(t){const e=function(t){return i.toString(t).toLowerCase()};return e(t.STRING1).includes(e(t.STRING2))}mod(t){const e=i.toNumber(t.NUM1),r=i.toNumber(t.NUM2);let n=e%r;return n/r<0&&(n+=r),n}round(t){return Math.round(i.toNumber(t.NUM))}mathop(t){const e=i.toString(t.OPERATOR).toLowerCase(),r=i.toNumber(t.NUM);switch(e){case"abs":return Math.abs(r);case"floor":return Math.floor(r);case"ceiling":return Math.ceil(r);case"sqrt":return Math.sqrt(r);case"sin":return parseFloat(Math.sin(Math.PI*r/180).toFixed(10));case"cos":return parseFloat(Math.cos(Math.PI*r/180).toFixed(10));case"tan":return n.tan(r);case"asin":return 180*Math.asin(r)/Math.PI;case"acos":return 180*Math.acos(r)/Math.PI;case"atan":return 180*Math.atan(r)/Math.PI;case"ln":return Math.log(r);case"log":return Math.log(r)/Math.LN10;case"e ^":return Math.exp(r);case"10 ^":return Math.pow(10,r)}return 0}}},934:function(t,e,r){const i=r(109),n=r(90),s=r(208),o=!0;class a{constructor(t){this.runtime=t,this.waitingSounds={},this.stopAllSounds=this.stopAllSounds.bind(this),this._stopWaitingSoundsForTarget=this._stopWaitingSoundsForTarget.bind(this),this._clearEffectsForAllTargets=this._clearEffectsForAllTargets.bind(this),this.runtime&&(this.runtime.on("PROJECT_STOP_ALL",this.stopAllSounds),this.runtime.on("PROJECT_STOP_ALL",this._clearEffectsForAllTargets),this.runtime.on("STOP_FOR_TARGET",this._stopWaitingSoundsForTarget),this.runtime.on("PROJECT_START",this._clearEffectsForAllTargets)),this._onTargetCreated=this._onTargetCreated.bind(this),this.runtime&&t.on("targetWasCreated",this._onTargetCreated)}static get STATE_KEY(){return"Scratch.sound"}static get DEFAULT_SOUND_STATE(){return{effects:{pitch:0,pan:0}}}static get MIDI_NOTE_RANGE(){return{min:36,max:96}}static get BEAT_RANGE(){return{min:0,max:100}}static get TEMPO_RANGE(){return{min:20,max:500}}static get EFFECT_RANGE(){return{pitch:{min:-360,max:360},pan:{min:-100,max:100}}}_getSoundState(t){let e=t.getCustomState(a.STATE_KEY);return e||(e=s.simple(a.DEFAULT_SOUND_STATE),t.setCustomState(a.STATE_KEY,e),t.soundEffects=e.effects),e}_onTargetCreated(t,e){if(e){const r=e.getCustomState(a.STATE_KEY);r&&t&&(t.setCustomState(a.STATE_KEY,s.simple(r)),this._syncEffectsForTarget(t))}}getPrimitives(){return{sound_play:this.playSound,sound_playuntildone:this.playSoundAndWait,sound_stopallsounds:this.stopAllSounds,sound_seteffectto:this.setEffect,sound_changeeffectby:this.changeEffect,sound_cleareffects:this.clearEffects,sound_sounds_menu:this.soundsMenu,sound_beats_menu:this.beatsMenu,sound_effects_menu:this.effectsMenu,sound_setvolumeto:this.setVolume,sound_changevolumeby:this.changeVolume,sound_volume:this.getVolume}}getMonitored(){return{sound_volume:{isSpriteSpecific:!0,getId:t=>`${t}_volume`}}}playSound(t,e){this._playSound(t,e)}playSoundAndWait(t,e){return this._playSound(t,e,o)}_playSound(t,e,r){const i=this._getSoundIndex(t.SOUND_MENU,e);if(i>=0){const{target:t}=e,{sprite:n}=t,{soundId:s}=n.sounds[i];if(n.soundBank)return r===o?this._addWaitingSound(t.id,s):this._removeWaitingSound(t.id,s),n.soundBank.playSound(t,s)}}_addWaitingSound(t,e){this.waitingSounds[t]||(this.waitingSounds[t]=new Set),this.waitingSounds[t].add(e)}_removeWaitingSound(t,e){this.waitingSounds[t]&&this.waitingSounds[t].delete(e)}_getSoundIndex(t,e){const r=e.target.sprite.sounds.length;if(0===r)return-1;const n=this.getSoundIndexByName(t,e);if(-1!==n)return n;const s=parseInt(t,10);return isNaN(s)?-1:i.wrapClamp(s-1,0,r-1)}getSoundIndexByName(t,e){const r=e.target.sprite.sounds;for(let e=0;e<r.length;e++)if(r[e].name===t)return e;return-1}stopAllSounds(){if(null===this.runtime.targets)return;const t=this.runtime.targets;for(let e=0;e<t.length;e++)this._stopAllSoundsForTarget(t[e])}_stopAllSoundsForTarget(t){t.sprite.soundBank&&(t.sprite.soundBank.stopAllSounds(t),this.waitingSounds[t.id]&&this.waitingSounds[t.id].clear())}_stopWaitingSoundsForTarget(t){if(t.sprite.soundBank&&this.waitingSounds[t.id]){for(const e of this.waitingSounds[t.id].values())t.sprite.soundBank.stop(t,e);this.waitingSounds[t.id].clear()}}setEffect(t,e){return this._updateEffect(t,e,!1)}changeEffect(t,e){return this._updateEffect(t,e,!0)}_updateEffect(t,e,r){const s=n.toString(t.EFFECT).toLowerCase(),o=n.toNumber(t.VALUE),u=this._getSoundState(e.target);if(!u.effects.hasOwnProperty(s))return;r?u.effects[s]+=o:u.effects[s]=o;const{min:c,max:h}=a.EFFECT_RANGE[s];return u.effects[s]=i.clamp(u.effects[s],c,h),this._syncEffectsForTarget(e.target),Promise.resolve()}_syncEffectsForTarget(t){t&&t.sprite.soundBank&&(t.soundEffects=this._getSoundState(t).effects,t.sprite.soundBank.setEffects(t))}clearEffects(t,e){this._clearEffectsForTarget(e.target)}_clearEffectsForTarget(t){const e=this._getSoundState(t);for(const t in e.effects)e.effects.hasOwnProperty(t)&&(e.effects[t]=0);this._syncEffectsForTarget(t)}_clearEffectsForAllTargets(){if(null===this.runtime.targets)return;const t=this.runtime.targets;for(let e=0;e<t.length;e++)this._clearEffectsForTarget(t[e])}setVolume(t,e){const r=n.toNumber(t.VOLUME);return this._updateVolume(r,e)}changeVolume(t,e){const r=n.toNumber(t.VOLUME)+e.target.volume;return this._updateVolume(r,e)}_updateVolume(t,e){return t=i.clamp(t,0,100),e.target.volume=t,this._syncEffectsForTarget(e.target),Promise.resolve()}getVolume(t,e){return e.target.volume}soundsMenu(t){return t.SOUND_MENU}beatsMenu(t){return t.BEATS}effectsMenu(t){return t.EFFECT}}t.exports=a},935:function(t,e,r){const i=r(90),n=r(177),s=r(292);t.exports=class{constructor(t){this.runtime=t,this._answer="",this._timer=new n,this._cachedLoudness=-1,this._cachedLoudnessTimestamp=0,this._questionList=[],this.runtime.on("ANSWER",this._onAnswer.bind(this)),this.runtime.on("PROJECT_START",this._resetAnswer.bind(this)),this.runtime.on("PROJECT_STOP_ALL",this._clearAllQuestions.bind(this)),this.runtime.on("STOP_FOR_TARGET",this._clearTargetQuestions.bind(this))}getPrimitives(){return{sensing_touchingobject:this.touchingObject,sensing_touchingcolor:this.touchingColor,sensing_coloristouchingcolor:this.colorTouchingColor,sensing_distanceto:this.distanceTo,sensing_timer:this.getTimer,sensing_resettimer:this.resetTimer,sensing_of:this.getAttributeOf,sensing_mousex:this.getMouseX,sensing_mousey:this.getMouseY,sensing_setdragmode:this.setDragMode,sensing_mousedown:this.getMouseDown,sensing_keypressed:this.getKeyPressed,sensing_current:this.current,sensing_dayssince2000:this.daysSince2000,sensing_loudness:this.getLoudness,sensing_loud:this.isLoud,sensing_askandwait:this.askAndWait,sensing_answer:this.getAnswer,sensing_username:this.getUsername,sensing_userid:()=>{}}}getMonitored(){return{sensing_answer:{getId:()=>"answer"},sensing_loudness:{getId:()=>"loudness"},sensing_timer:{getId:()=>"timer"},sensing_current:{getId:(t,e)=>s("current",e)}}}_onAnswer(t){this._answer=t;const e=this._questionList.shift();if(e){const[t,r,i,n,s]=e;n&&!s&&this.runtime.emit("SAY",i,"say",""),r(),this._askNextQuestion()}}_resetAnswer(){this._answer=""}_enqueueAsk(t,e,r,i,n){this._questionList.push([t,e,r,i,n])}_askNextQuestion(){if(this._questionList.length>0){const[t,e,r,i,n]=this._questionList[0];i&&!n?(this.runtime.emit("SAY",r,"say",t),this.runtime.emit("QUESTION","")):this.runtime.emit("QUESTION",t)}}_clearAllQuestions(){this._questionList=[],this.runtime.emit("QUESTION",null)}_clearTargetQuestions(t){const e=this._questionList.length>0&&this._questionList[0][2]===t;this._questionList=this._questionList.filter(e=>e[2]!==t),e&&(this.runtime.emit("SAY",t,"say",""),this._questionList.length>0?this._askNextQuestion():this.runtime.emit("QUESTION",null))}askAndWait(t,e){const r=e.target;return new Promise(e=>{const i=this._questionList.length>0;this._enqueueAsk(String(t.QUESTION),e,r,r.visible,r.isStage),i||this._askNextQuestion()})}getAnswer(){return this._answer}touchingObject(t,e){return e.target.isTouchingObject(t.TOUCHINGOBJECTMENU)}touchingColor(t,e){const r=i.toRgbColorList(t.COLOR);return e.target.isTouchingColor(r)}colorTouchingColor(t,e){const r=i.toRgbColorList(t.COLOR),n=i.toRgbColorList(t.COLOR2);return e.target.colorIsTouchingColor(n,r)}distanceTo(t,e){if(e.target.isStage)return 1e4;let r=0,n=0;if("_mouse_"===t.DISTANCETOMENU)r=e.ioQuery("mouse","getScratchX"),n=e.ioQuery("mouse","getScratchY");else{t.DISTANCETOMENU=i.toString(t.DISTANCETOMENU);const e=this.runtime.getSpriteTargetByName(t.DISTANCETOMENU);if(!e)return 1e4;r=e.x,n=e.y}const s=e.target.x-r,o=e.target.y-n;return Math.sqrt(s*s+o*o)}setDragMode(t,e){e.target.setDraggable("draggable"===t.DRAG_MODE)}getTimer(t,e){return e.ioQuery("clock","projectTimer")}resetTimer(t,e){e.ioQuery("clock","resetProjectTimer")}getMouseX(t,e){return e.ioQuery("mouse","getScratchX")}getMouseY(t,e){return e.ioQuery("mouse","getScratchY")}getMouseDown(t,e){return e.ioQuery("mouse","getIsDown")}current(t){const e=i.toString(t.CURRENTMENU).toLowerCase(),r=new Date;switch(e){case"year":return r.getFullYear();case"month":return r.getMonth()+1;case"date":return r.getDate();case"dayofweek":return r.getDay()+1;case"hour":return r.getHours();case"minute":return r.getMinutes();case"second":return r.getSeconds()}return 0}getKeyPressed(t,e){return e.ioQuery("keyboard","getKeyIsDown",[t.KEY_OPTION])}daysSince2000(){const t=new Date(2e3,0,1),e=new Date,r=e.getTimezoneOffset()-t.getTimezoneOffset();let i=e.valueOf()-t.valueOf();return i+=60*(e.getTimezoneOffset()-r)*1e3,i/864e5}getLoudness(){if(void 0===this.runtime.audioEngine)return-1;if(null===this.runtime.currentStepTime)return-1;return this._timer.time()-this._cachedLoudnessTimestamp<this.runtime.currentStepTime?this._cachedLoudness:(this._cachedLoudnessTimestamp=this._timer.time(),this._cachedLoudness=this.runtime.audioEngine.getLoudness(),this._cachedLoudness)}isLoud(){return this.getLoudness()>10}getAttributeOf(t){let e;if("_stage_"===t.OBJECT?e=this.runtime.getTargetForStage():(t.OBJECT=i.toString(t.OBJECT),e=this.runtime.getSpriteTargetByName(t.OBJECT)),!e)return 0;if(e.isStage)switch(t.PROPERTY){case"background #":case"backdrop #":return e.currentCostume+1;case"backdrop name":return e.getCostumes()[e.currentCostume].name;case"volume":return e.volume}else switch(t.PROPERTY){case"x position":return e.x;case"y position":return e.y;case"direction":return e.direction;case"costume #":return e.currentCostume+1;case"costume name":return e.getCostumes()[e.currentCostume].name;case"size":return e.size;case"volume":return e.volume}const r=t.PROPERTY,n=e.lookupVariableByNameAndType(r,"",!0);return n?n.value:0}getUsername(t,e){return e.ioQuery("userData","getUsername")}}},936:function(t,e,r){const i=r(90);class n{constructor(t){this.runtime=t}getPrimitives(){return{data_variable:this.getVariable,data_setvariableto:this.setVariableTo,data_changevariableby:this.changeVariableBy,data_hidevariable:this.hideVariable,data_showvariable:this.showVariable,data_listcontents:this.getListContents,data_addtolist:this.addToList,data_deleteoflist:this.deleteOfList,data_deletealloflist:this.deleteAllOfList,data_insertatlist:this.insertAtList,data_replaceitemoflist:this.replaceItemOfList,data_itemoflist:this.getItemOfList,data_itemnumoflist:this.getItemNumOfList,data_lengthoflist:this.lengthOfList,data_listcontainsitem:this.listContainsItem,data_hidelist:this.hideList,data_showlist:this.showList}}getVariable(t,e){return e.target.lookupOrCreateVariable(t.VARIABLE.id,t.VARIABLE.name).value}setVariableTo(t,e){const r=e.target.lookupOrCreateVariable(t.VARIABLE.id,t.VARIABLE.name);r.value=t.VALUE,r.isCloud&&e.ioQuery("cloud","requestUpdateVariable",[r.name,t.VALUE])}changeVariableBy(t,e){const r=e.target.lookupOrCreateVariable(t.VARIABLE.id,t.VARIABLE.name),n=i.toNumber(r.value)+i.toNumber(t.VALUE);r.value=n,r.isCloud&&e.ioQuery("cloud","requestUpdateVariable",[r.name,n])}changeMonitorVisibility(t,e){this.runtime.monitorBlocks.changeBlock({id:t,element:"checkbox",value:e},this.runtime)}showVariable(t){this.changeMonitorVisibility(t.VARIABLE.id,!0)}hideVariable(t){this.changeMonitorVisibility(t.VARIABLE.id,!1)}showList(t){this.changeMonitorVisibility(t.LIST.id,!0)}hideList(t){this.changeMonitorVisibility(t.LIST.id,!1)}getListContents(t,e){const r=e.target.lookupOrCreateList(t.LIST.id,t.LIST.name);if(e.thread.updateMonitor)return r._monitorUpToDate?r.value:(r._monitorUpToDate=!0,r.value.slice());let i=!0;for(let t=0;t<r.value.length;t++){const e=r.value[t];if("string"!=typeof e||1!==e.length){i=!1;break}}return i?r.value.join(""):r.value.join(" ")}addToList(t,e){const r=e.target.lookupOrCreateList(t.LIST.id,t.LIST.name);r.value.length<n.LIST_ITEM_LIMIT&&(r.value.push(t.ITEM),r._monitorUpToDate=!1)}deleteOfList(t,e){const r=e.target.lookupOrCreateList(t.LIST.id,t.LIST.name),n=i.toListIndex(t.INDEX,r.value.length,!0);n!==i.LIST_INVALID&&(n!==i.LIST_ALL?(r.value.splice(n-1,1),r._monitorUpToDate=!1):r.value=[])}deleteAllOfList(t,e){e.target.lookupOrCreateList(t.LIST.id,t.LIST.name).value=[]}insertAtList(t,e){const r=t.ITEM,s=e.target.lookupOrCreateList(t.LIST.id,t.LIST.name),o=i.toListIndex(t.INDEX,s.value.length+1,!1);if(o===i.LIST_INVALID)return;const a=n.LIST_ITEM_LIMIT;o>a||(s.value.splice(o-1,0,r),s.value.length>a&&s.value.pop(),s._monitorUpToDate=!1)}replaceItemOfList(t,e){const r=t.ITEM,n=e.target.lookupOrCreateList(t.LIST.id,t.LIST.name),s=i.toListIndex(t.INDEX,n.value.length,!1);s!==i.LIST_INVALID&&(n.value.splice(s-1,1,r),n._monitorUpToDate=!1)}getItemOfList(t,e){const r=e.target.lookupOrCreateList(t.LIST.id,t.LIST.name),n=i.toListIndex(t.INDEX,r.value.length,!1);return n===i.LIST_INVALID?"":r.value[n-1]}getItemNumOfList(t,e){const r=t.ITEM,n=e.target.lookupOrCreateList(t.LIST.id,t.LIST.name);for(let t=0;t<n.value.length;t++)if(0===i.compare(n.value[t],r))return t+1;return 0}lengthOfList(t,e){return e.target.lookupOrCreateList(t.LIST.id,t.LIST.name).value.length}listContainsItem(t,e){const r=t.ITEM,n=e.target.lookupOrCreateList(t.LIST.id,t.LIST.name);if(n.value.indexOf(r)>=0)return!0;for(let t=0;t<n.value.length;t++)if(0===i.compare(n.value[t],r))return!0;return!1}static get LIST_ITEM_LIMIT(){return 2e5}}t.exports=n},937:function(t,e){t.exports=class{constructor(t){this.runtime=t}getPrimitives(){return{procedures_definition:this.definition,procedures_call:this.call,argument_reporter_string_number:this.argumentReporterStringNumber,argument_reporter_boolean:this.argumentReporterBoolean}}definition(){}call(t,e){if(!e.stackFrame.executed){const r=t.mutation.proccode,i=e.getProcedureParamNamesIdsAndDefaults(r);if(null===i)return;const[n,s,o]=i;e.initParams();for(let r=0;r<s.length;r++)t.hasOwnProperty(s[r])?e.pushParam(n[r],t[s[r]]):e.pushParam(n[r],o[r]);e.stackFrame.executed=!0,e.startProcedure(r)}}argumentReporterStringNumber(t,e){const r=e.getParam(t.VALUE);return null===r?0:r}argumentReporterBoolean(t,e){const r=e.getParam(t.VALUE);return null===r?0:r}}},938:function(t,e){const r=function(t,e,r){const i=r?[t.getTargetById(r)]:t.targets,n=[];for(let t=0;t<i.length;t++){const r=i[t].sprite[e];for(let t=0;t<r.length;t++){const e=r[t].asset;n.push({fileName:`${e.assetId}.${e.dataFormat}`,fileContent:e.data})}}return n};t.exports={serializeSounds:function(t,e){return r(t,"sounds",e)},serializeCostumes:function(t,e){return r(t,"costumes",e)}}}}]);